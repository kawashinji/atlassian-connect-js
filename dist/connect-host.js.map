{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/base-64/base64.js","node_modules/jsuri/Uri.js","node_modules/utf8/utf8.js","src/common/base64.js","src/common/dollar.js","src/common/dom-events.js","src/common/events.js","src/common/jwt.js","src/common/ui-params.js","src/common/uri.js","src/common/xdm-rpc.js","src/host/addons.js","src/host/analytics.js","src/host/content.js","src/host/create.js","src/host/dialog/api.js","src/host/dialog/binder.js","src/host/dialog/button.js","src/host/dialog/factory.js","src/host/dialog/rpc.js","src/host/dollar.js","src/host/env.js","src/host/index.js","src/host/inline-dialog/binder.js","src/host/inline-dialog/rpc.js","src/host/inline-dialog/simple.js","src/host/jwt-keep-alive.js","src/host/loading-indicator.js","src/host/messages/api.js","src/host/messages/rpc.js","src/host/propagate/rpc.js","src/host/resize.js","src/host/rpc.js","src/host/status-helper.js","src/host/util.js"],"names":[],"mappings":"AAAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACrKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;sBCpPmB,SAAS;;;;oBACX,MAAM;;;;qBAER;AACb,QAAM,EAAE,gBAAU,MAAM,EAAE;AACxB,WAAO,oBAAO,MAAM,CAAC,kBAAK,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;GAC3C;AACD,QAAM,EAAE,gBAAU,MAAM,EAAE;AACxB,WAAO,kBAAK,MAAM,CAAC,oBAAO,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;GAC3C;CACF;;;;;;;;;ACVD,IAAI,CAAC,CAAC;AACN,IAAI,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,MAAM,EAAE;AAC9B,GAAC,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;CAC/B,MAAM;AACL,GAAC,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;CACjC;;qBAEc,CAAC;;ACPhB,YAAY,CAAC;;;;;;;;AAKb,IAAI,CAAC,GAAG,MAAM,CAAC;AACf,IAAI,GAAG,GAAG,AAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,IAAM,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,AAAC,IAAI,YAAY,EAAE,CAAC;;AAEjF,IAAM,sBAAsB,GAAG,CAC7B,OAAO,CACR,CAAC;;AAEF,IAAM,yBAAyB,GAAG,CAChC,SAAS,EACT,OAAO,CACR,CAAC;;AAEF,IAAM,gBAAgB,GAAG,CACvB,EAAE;CACH,CAAC;;qBAEc;;AAEd,eAAa,EAAb,aAAa;AACb,cAAY,EAAZ,YAAY;;;AAGZ,+BAA6B,EAA7B,6BAA6B;AAC7B,sBAAoB,EAAE,sBAAsB;AAC5C,yBAAuB,EAAE,yBAAyB;AAClD,kBAAgB,EAAhB,gBAAgB;AAChB,aAAW,EAAX,WAAW;CACZ;;;;;;;;AAQD,SAAS,aAAa,CAAC,UAAU,EAAE,QAAQ,EAAE;AAC3C,wBAAsB,CAAC,OAAO,CAAC,UAAU,UAAU,EAAE;AACnD,YAAQ,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE;AACjD,UAAI,CAAC,CAAC,UAAU,KAAK,UAAU,EAAE;AAC/B,eAAO;OACR;AACD,cAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,IAAI,EAAE,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;KACrD,CAAC,CAAC;GACJ,CAAC,CAAC;AACH,2BAAyB,CAAC,OAAO,CAAC,UAAU,aAAa,EAAE;AACzD,YAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE,UAAU,CAAC,EAAE;AACpD,UAAI,CAAC,CAAC,UAAU,KAAK,UAAU,EAAE;AAC/B,eAAO;OACR;;AAED,UAAI,gBAAgB,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE;AAC/B,gBAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,IAAI,EAAE,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC;OACxD;KACF,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ;;;;;;;;;;AAUD,SAAS,YAAY,CAAC,UAAU,EAAE,SAAS,EAAE,SAAS,EAAE;AACtD,MAAI,KAAK,GAAG,WAAW,CAAC,UAAU,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;AAC1D,MAAI,CAAC,KAAK,EAAE;AACV,WAAO;GACR;;AAED,eAAa,CAAC,KAAK,CAAC,CAAC;CACtB;;;;;;;;;AASD,SAAS,kBAAkB,CAAC,UAAU,EAAE;AACtC,SAAO;AACL,WAAO,EAAE,IAAI;AACb,cAAU,EAAE,IAAI;AAChB,UAAM,EAAE,UAAU,CAAC,MAAM;AACzB,WAAO,EAAE,UAAU,CAAC,OAAO;AAC3B,YAAQ,EAAE,UAAU,CAAC,QAAQ;AAC7B,UAAM,EAAE,UAAU,CAAC,MAAM;AACzB,WAAO,EAAE,UAAU,CAAC,OAAO;GAC5B,CAAC;CACH;;;;;;;;;AASD,SAAS,qBAAqB,CAAC,aAAa,EAAE;AAC5C,SAAO;AACL,WAAO,EAAE,IAAI;AACb,cAAU,EAAE,IAAI;AAChB,OAAG,EAAE,aAAa,CAAC,GAAG;AACtB,QAAI,EAAE,aAAa,CAAC,IAAI;AACxB,WAAO,EAAE,aAAa,CAAC,OAAO;AAC9B,WAAO,EAAE,aAAa,CAAC,OAAO;AAC9B,YAAQ,EAAE,aAAa,CAAC,QAAQ;AAChC,UAAM,EAAE,aAAa,CAAC,MAAM;AAC5B,WAAO,EAAE,aAAa,CAAC,OAAO;AAC9B,UAAM,EAAE,IAAI;GACb,CAAC;CACH;;;;;;;;;;;;;;AAcD,SAAS,WAAW,CAAC,UAAU,EAAE,SAAS,EAAE,SAAS,EAAE;AACrD,WAAS,CAAC,IAAI,GAAG,MAAM,CAAC;;AAExB,MAAI,KAAK,YAAA,CAAC;AACV,MAAI,sBAAsB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE;AAClD,QAAI,OAAO,MAAM,CAAC,KAAK,KAAK,UAAU,EAAE;AACtC,WAAK,GAAG,IAAI,UAAU,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;KAC9C,MACI;;;AAGH,WAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;AAC3C,WAAK,CAAC,cAAc,CAAC,SAAS,EAC1B,SAAS,CAAC,OAAO,EAAE,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,IAAI,EACvD,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EACb,SAAS,CAAC,OAAO,EAAE,SAAS,CAAC,MAAM,EAAE,SAAS,CAAC,QAAQ,EACvD,SAAS,CAAC,OAAO,EAAE,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KAChD;GACF,MACI,IAAI,yBAAyB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE;AAC1D,QAAI,OAAO,MAAM,CAAC,KAAK,KAAK,UAAU,EAAE;AACtC,WAAK,GAAG,IAAI,aAAa,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;KACjD,MACI;;;AAGH,WAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;AAC9C,WAAK,CAAC,iBAAiB,CAAC,SAAS,EAC7B,SAAS,CAAC,OAAO,EAAE,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,IAAI,EACvD,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,6BAA6B,CAAC,SAAS,CAAC,EAC1D,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;KAC9B;GACF,MACI;AACH,OAAG,CAAC,QAAQ,GAAG,SAAS,GAAG,gBAAgB,CAAC,CAAC;GAC9C;;AAED,MAAI,KAAK,EAAE;AACT,SAAK,CAAC,UAAU,GAAG,UAAU,CAAC;GAC/B;AACD,SAAO,KAAK,CAAC;CACd;;;;;;;;;AASD,SAAS,aAAa,CAAC,KAAK,EAAE;AAC5B,UAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;;AAEnC,MAAI,GAAG,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;;;AAGjC,QAAI,OAAO,GAAG,GAAG,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;AACpC,QAAI,OAAO,CAAC,MAAM,GAAG,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,EAAE;AACpC,aAAO,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;KACjC;GACF;CACF;;;;;;;;;AASD,SAAS,6BAA6B,CAAC,SAAS,EAAE;AAChD,MAAI,MAAM,GAAG,EAAE,CAAC;AAChB,MAAI,SAAS,CAAC,QAAQ,EAAE;AACtB,UAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;GACtB;AACD,MAAI,SAAS,CAAC,OAAO,EAAE;AACrB,UAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;GACrB;AACD,MAAI,SAAS,CAAC,OAAO,EAAE;AACrB,UAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;GACrB;AACD,MAAI,SAAS,CAAC,MAAM,EAAE;AACpB,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACpB;AACD,SAAO,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;CACzB;;;;;;;;;AASD,SAAS,gBAAgB,CAAC,OAAO,EAAE;AACjC,SAAO,gBAAgB,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;CAC/C;;;;;;;;;;;;sBCpOa,UAAU;;;;AAExB,IAAI,CAAC,GAAG,MAAM,CAAC;AACf,IAAI,GAAG,GAAG,AAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,IAAM,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,AAAC,IAAK,YAAY,EAAE,AAAC,CAAC;;;;;;;;;;AAUnF,SAAS,MAAM,CAAC,GAAG,EAAE,MAAM,EAAE;AAC3B,MAAI,CAAC,IAAI,GAAG,GAAG,CAAC;AAChB,MAAI,CAAC,OAAO,GAAG,MAAM,CAAC;AACtB,MAAI,CAAC,OAAO,GAAG,EAAE,CAAC;AAClB,MAAI,CAAC,IAAI,GAAG,EAAE,CAAC;CAChB;;AAED,IAAI,KAAK,GAAG,MAAM,CAAC,SAAS,CAAC;;;;;;;;;AAS7B,KAAK,CAAC,EAAE,GAAG,UAAU,IAAI,EAAE,QAAQ,EAAE;AACnC,MAAI,IAAI,IAAI,QAAQ,EAAE;AACpB,QAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;GACtC;AACD,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;AASF,KAAK,CAAC,IAAI,GAAG,UAAU,IAAI,EAAE,QAAQ,EAAE;AACrC,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI,WAAW,GAAG,SAAd,WAAW,GAAe;AAC5B,QAAI,CAAC,GAAG,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;AAC5B,YAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;GACjC,CAAC;AACF,MAAI,CAAC,EAAE,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;AAC3B,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;AAQF,KAAK,CAAC,KAAK,GAAG,UAAU,QAAQ,EAAE;AAChC,MAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACzB,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;AASF,KAAK,CAAC,GAAG,GAAG,UAAU,IAAI,EAAE,QAAQ,EAAE;AACpC,MAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC7B,MAAI,GAAG,EAAE;AACP,QAAI,CAAC,GAAG,oBAAE,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;AACjC,QAAI,CAAC,IAAI,CAAC,EAAE;AACV,SAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;KAClB;AACD,QAAI,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE;AACpB,aAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;KAC3B;GACF;AACD,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;AASF,KAAK,CAAC,MAAM,GAAG,UAAU,IAAI,EAAE;AAC7B,MAAI,IAAI,EAAE;AACR,WAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;GAC3B,MAAM;AACL,QAAI,CAAC,OAAO,GAAG,EAAE,CAAC;GACnB;AACD,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;AAQF,KAAK,CAAC,MAAM,GAAG,UAAU,QAAQ,EAAE;AACjC,MAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;AACpB,MAAI,CAAC,GAAG,oBAAE,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;AACjC,MAAI,CAAC,IAAI,CAAC,EAAE;AACV,OAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;GAClB;AACD,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;;;AAYF,KAAK,CAAC,IAAI,GAAG,UAAU,IAAI,EAAE;AAC3B,SAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC;CAC5D,CAAC;;;;;;;;;;;AAWF,KAAK,CAAC,MAAM,GAAG,UAAU,IAAI,EAAE;AAC7B,SAAO;AACL,QAAI,EAAE,IAAI;AACV,QAAI,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;AACjC,SAAK,EAAE,EAAE;AACT,UAAM,EAAE;AACN,SAAG,EAAE,IAAI,CAAC,IAAI;AACd,YAAM,EAAE,IAAI,CAAC,OAAO;KACrB;GACF,CAAC;CACH,CAAC;;;;;;;;;;;;AAYF,KAAK,CAAC,UAAU,GAAG,UAAU,KAAK,EAAE;AAClC,MAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACpC,MAAI,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;AACxC,MAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;AAC3C,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;AASF,KAAK,CAAC,UAAU,GAAG,UAAU,IAAI,EAAE;AACjC,SAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;CACtD,CAAC;;;AAGF,SAAS,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE;AAC7B,OAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AACzC,QAAI;AACF,eAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAChC,CAAC,OAAO,CAAC,EAAE;AACV,SAAG,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;KAChC;GACF;CACF;;qBAEc,EAAC,MAAM,EAAE,MAAM,EAAC;;;;;;;;;;;;sBC9LZ,UAAU;;;;AAE7B,SAAS,cAAc,CAAC,GAAG,EAAE;AAC3B,SAAO,cAAc,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;CACnC;;AAED,SAAS,cAAc,CAAC,GAAG,EAAE;;AAE3B,MAAI,IAAI,KAAK,GAAG,IAAI,EAAE,KAAK,GAAG,EAAE;AAC9B,UAAM,qDAAqD,CAAE;GAC9D;;AAED,MAAI,gBAAgB,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACxC,MAAI,iBAAiB,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,gBAAgB,GAAG,CAAC,CAAC,CAAC;;AAE/D,MAAI,gBAAgB,GAAG,CAAC,IAAI,iBAAiB,IAAI,gBAAgB,EAAE;AACjE,UAAM,sDAAsD,CAAE;GAC/D;;AAED,MAAI,aAAa,GAAG,GAAG,CAAC,SAAS,CAAC,gBAAgB,GAAG,CAAC,EAAE,iBAAiB,CAAC,CAAC;;AAE3E,MAAI,IAAI,KAAK,aAAa,IAAI,EAAE,KAAK,aAAa,EAAE;AAClD,UAAM,oEAAoE,CAAE;GAC7E;;AAED,MAAI,YAAY,GAAG,oBAAO,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;AAC7D,SAAO,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;CACjC;;AAED,SAAS,YAAY,CAAC,SAAS,EAAE,IAAI,EAAE;AACrC,MAAI,IAAI,KAAK,SAAS,EAAE;AACtB,QAAI,GAAG,EAAE,CAAC;GACX;AACD,MAAI,MAAM,GAAG,cAAc,CAAC,SAAS,CAAC,CAAC;AACvC,MAAI,OAAO,GAAG,CAAC,CAAC;AAChB,MAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;;AAExC,MAAI,MAAM,IAAI,MAAM,CAAC,GAAG,EAAE;AACxB,WAAO,GAAG,MAAM,CAAC,GAAG,CAAC;GACtB;;AAED,MAAI,AAAC,OAAO,GAAG,GAAG,GAAI,IAAI,EAAE;AAC1B,WAAO,IAAI,CAAC;GACb;;AAED,SAAO,KAAK,CAAC;CAEd;;qBAGc;AACb,gBAAc,EAAd,cAAc;AACd,gBAAc,EAAd,cAAc;AACd,cAAY,EAAZ,YAAY;CACb;;;;;;;;;;;;sBCtDkB,UAAU;;;;mBACb,OAAO;;;;;;;;;;qBAOR;;;;AAIb,QAAM,EAAE,gBAAU,OAAO,EAAE;AACzB,QAAI,OAAO,EAAE;AACX,UAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AAClC,aAAO,oBAAO,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;KACxC;GACF;;;;AAID,SAAO,EAAE,iBAAU,GAAG,EAAE;AACtB,QAAI,MAAM,GAAG,IAAI,iBAAI,IAAI,CAAC,GAAG,CAAC,CAAC,kBAAkB,CAAC,WAAW,CAAC,CAAC;AAC/D,WAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;GAC5B;;;;AAID,gBAAc,EAAE,wBAAU,CAAC,EAAE,KAAK,EAAE;AAClC,KAAC,GAAG,CAAC,IAAI,MAAM,CAAC;AAChB,QAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;;AAElC,QAAI,CAAC,KAAK,EAAE;AACV,aAAO,OAAO,CAAC;KAChB;AACD,WAAO,AAAC,OAAO,GAAI,OAAO,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;GAC/C;;;;AAID,QAAM,EAAE,gBAAU,MAAM,EAAE;AACxB,QAAI,GAAG,GAAG,EAAE,CAAC;AACb,QAAI,MAAM,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AAC/B,UAAI;AACF,WAAG,GAAG,IAAI,CAAC,KAAK,CAAC,oBAAO,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;OACtD,CAAC,OAAO,CAAC,EAAE;AACV,YAAI,OAAO,IAAI,OAAO,CAAC,GAAG,EAAE;AAC1B,iBAAO,CAAC,GAAG,CAAC,gCAAgC,EAAE,MAAM,CAAC,CAAC;SACvD;OACF;KACF;AACD,WAAO,GAAG,CAAC;GACZ;CACF;;;;;;;;;;;;qBCrDe,OAAO;;;;qBAER,EAAC,IAAI,oBAAK,EAAC;;;;;;;;;;;;sBCFP,UAAU;;;;mBACb,OAAO;;;;mBACP,OAAO;;;;wBACF,aAAa;;;;;AAGlC,IAAI,KAAK,GAAG,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4Bd,SAAS,MAAM,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE;;AAEnC,MAAI,IAAI,CAAC;AACT,MAAI,EAAE,CAAC;AACP,MAAI,MAAM,CAAC;AACX,MAAI,YAAY,CAAC;AACjB,MAAI,OAAO,CAAC;AACZ,MAAI,KAAK,CAAC;AACV,MAAI,QAAQ,CAAC;AACb,MAAI,SAAS,CAAC;AACd,MAAI,QAAQ,CAAC;AACb,MAAI,CAAC,GAAG,MAAM,CAAC;AACf,MAAI,GAAG,GAAG,CAAC,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;AAChC,MAAI,MAAM,GAAG,QAAQ,CAAC,KAAK,IAAI,EAAE,CAAC;AAClC,MAAI,OAAO,GAAG,QAAQ,CAAC,MAAM,IAAI,EAAE,CAAC;AACpC,MAAI,WAAW,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;;;AAGlC,MAAI,KAAK,GAAG,CAAA,YAAY;AACtB,QAAI,SAAS,GAAG,EAAE,CAAC;AACnB,WAAO;;AAEL,SAAG,EAAE,aAAU,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE;AAC9B,iBAAS,CAAC,GAAG,CAAC,GAAG;AACf,cAAI,EAAE,IAAI,IAAI,IAAI;AAClB,cAAI,EAAE,IAAI,IAAI,IAAI;AAClB,eAAK,EAAE,CAAC,CAAC,IAAI;SACd,CAAC;OACH;;AAED,YAAM,EAAE,gBAAU,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE;AAChC,YAAI,OAAO,CAAC;AACZ,YAAI,SAAS,CAAC,GAAG,CAAC,EAAE;AAClB,cAAI,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE;;AAExB,qBAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;AAC1B,mBAAO,GAAG,IAAI,CAAC;WAChB,MAAM;;AAEL,mBAAO,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,KAAK,IAAI,IAAI,KAAK,MAAM,CAAC;WACpD;AACD,iBAAO,SAAS,CAAC,GAAG,CAAC,CAAC;SACvB;AACD,eAAO,OAAO,CAAC;OAChB;KACF,CAAC;GACH,CAAA,EAAE,CAAC;;;;;;;;;;;;;;;;;AAiBJ,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;;;;;AAKtB,KAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;;AAEzF,QAAI,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC;AAClC,UAAM,GAAG,MAAM,CAAC,aAAa,CAAC;AAC9B,YAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,oBAAoB,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;AACrF,aAAS,GAAG,MAAM,CAAC,SAAS,CAAC;AAC7B,YAAQ,GAAG,SAAS,CAAC;AACrB,gBAAY,GAAG,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;AACvD,WAAO,GAAG,MAAM,CAAC,OAAO,CAAC;;AAEzB,SAAK,GAAG;AACN,YAAM,EAAE,IAAI;AACZ,YAAM,EAAE,MAAM;AACd,cAAQ,EAAE,MAAM,CAAC,QAAQ;AACzB,aAAO,EAAE,mBAAY;AACnB,cAAM,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;AAElC,cAAM,EAAE,CAAC;;AAET,YAAI,IAAI,CAAC,MAAM,EAAE;AACf,WAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,CAAC;AACxB,iBAAO,IAAI,CAAC,MAAM,CAAC;SACpB;OACF;AACD,cAAQ,EAAE,oBAAY;;AAEpB,eAAO,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,eAAe,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;OAC1D;KACF,CAAC;AACF,KAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,mBAAmB,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;GAClD,MAAM;;AAEL,UAAM,GAAG,CAAC,CAAC,MAAM,CAAC;AAClB,YAAQ,GAAG,OAAO,CAAC;;;AAGnB,QAAI,QAAQ,GAAG,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AACjC,aAAS,GAAG,QAAQ,GAAG,iBAAI,cAAc,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC,GAAG,EAAE,oBAAoB,CAAC,CAAC;;;;;AAKvF,QAAI,IAAI,KAAK,SAAS,EAAE;AACtB,eAAS,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;KAC3B;;AAED,YAAQ,GAAG,QAAQ,CAAC;AACpB,gBAAY,GAAG,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;AACjD,WAAO,GAAG,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;;AAE9B,SAAK,GAAG;AACN,YAAM,EAAE,KAAK;AACb,cAAQ,EAAE,oBAAY;;AAEpB,eAAO,IAAI,CAAC;OACb;KACF,CAAC;GACH;;AAED,IAAE,GAAG,QAAQ,GAAG,GAAG,IAAI,KAAK,IAAI,CAAC,CAAA,AAAC,CAAC;;;AAGnC,MAAI,GAAG,CAAC,CAAC,MAAM,CAAC;AACd,MAAE,EAAE,EAAE;AACN,gBAAY,EAAE,YAAY;AAC1B,WAAO,EAAE,OAAO;AAChB,YAAQ,EAAE,QAAQ;GACnB,EAAE,KAAK,CAAC,CAAC;;;AAGV,WAAS,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE;AAChC,QAAI;AACF,YAAM,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC;AAChC,SAAC,EAAE,OAAO;AACV,SAAC,EAAE,GAAG;AACN,SAAC,EAAE,IAAI;AACP,SAAC,EAAE,OAAO;OACX,CAAC,EAAE,YAAY,CAAC,CAAC;KACnB,CAAC,OAAO,EAAE,EAAE;AACX,SAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;KACjB;GACF;;;AAGD,WAAS,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE;;AAEjD,QAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,UAAU,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;;AAE9D,SAAK,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;;;;AAI3B,QAAI,CAAC,GAAG,EAAE,SAAS,EAAE,EAAC,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,IAAI,EAAC,CAAC,CAAC;GAChD;;AAED,WAAS,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE;AAC9B,QAAI,CAAC,GAAG,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;GAC5B;;AAED,WAAS,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE;AAC9B,QAAI,CAAC,GAAG,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;GAC5B;;;AAGD,WAAS,OAAO,CAAC,CAAC,EAAE;AAClB,QAAI;;AAEF,UAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;AACjC,UAAI,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC;AACpB,UAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC;AACzB,UAAI,KAAK,GAAG,OAAO,CAAC,CAAC,CAAC;AACtB,UAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC;;;AAGzB,UAAI,CAAC,CAAC,MAAM,KAAK,MAAM,IAAI,CAAC,CAAC,MAAM,CAAC,WAAW,EAAE,KAAK,YAAY,IAAI,QAAQ,KAAK,OAAO,EAAE;AAC1F,cAAM,GAAG,CAAC,CAAC,MAAM,CAAC;OACnB;;;AAGD,UAAI,CAAC,CAAC,MAAM,KAAK,MAAM,IAAI,CAAC,CAAC,MAAM,CAAC,WAAW,EAAE,KAAK,YAAY,IAAI,QAAQ,KAAK,OAAO,EAAE;AAC1F,eAAO;OACR;;AAED,UAAI,KAAK,KAAK,SAAS,EAAE;;AAEvB,YAAI,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC;AACtB,YAAI,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC;AACtB,YAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AACzB,YAAI,IAAI,CAAC;AACT,YAAI,IAAI,CAAC;AACT,YAAI,KAAK,CAAC;AACV,YAAI,KAAK,EAAE;;;AAGT,cAAI,GAAG,UAAU,OAAO,EAAE;AACxB,oBAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;WACxB,CAAC;AACF,cAAI,GAAG,UAAU,OAAO,EAAE;AACxB,oBAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;WACxB,CAAC;;;;;AAKF,eAAK,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA,GAAI,KAAK,CAAC,MAAM,CAAC;AAChD,cAAI,OAAO,GAAG,MAAM,CAAC;AACrB,cAAI,IAAI,CAAC,MAAM,KAAK,IAAI,EAAE;AACxB,mBAAO,GAAG,IAAI,CAAC;AACf,gBAAI,OAAO,CAAC,SAAS,EAAE;AACrB,qBAAO,CAAC,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;aAC3C;WACF,MAAM;AACL,mBAAO,CAAC,MAAM,GAAG,KAAK,CAAC;WACxB;AACD,cAAI;AACF,gBAAI,KAAK,EAAE;;AAET,mBAAK,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;aACjD,MAAM;;AAEL,kBAAI,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC;aAClC;WACF,CAAC,OAAO,EAAE,EAAE;;AAEX,gBAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;AACjB,oBAAQ,CAAC,EAAE,CAAC,CAAC;WACd;SACF,MAAM;;AAEL,eAAK,CAAC,oBAAoB,EAAE,OAAO,CAAC,CAAC;SACtC;OACF,MAAM,IAAI,KAAK,KAAK,MAAM,IAAI,KAAK,KAAK,MAAM,EAAE;;AAE/C,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAE;;AAEvC,eAAK,CAAC,qBAAqB,EAAE,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;SACpD;OACF;KACF,CAAC,OAAO,EAAE,EAAE;AACX,SAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;KACjB;GACF;;;AAGD,WAAS,MAAM,CAAC,UAAU,EAAE;;;AAG1B,WAAO,YAAY;AACjB,UAAI,IAAI,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACpC,UAAI,IAAI,CAAC;AACT,UAAI,IAAI,CAAC;;AAET,eAAS,KAAK,GAAG;AACf,YAAI,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,EAAE;AACvC,iBAAO,IAAI,CAAC,GAAG,EAAE,CAAC;SACnB;OACF;;AAED,UAAI,GAAG,KAAK,EAAE,CAAC;AACf,UAAI,GAAG,KAAK,EAAE,CAAC;AACf,UAAI,CAAC,IAAI,EAAE;;AAET,YAAI,GAAG,IAAI,CAAC;AACZ,YAAI,GAAG,SAAS,CAAC;OAClB;AACD,iBAAW,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;KAC3C,CAAC;GACH;;;;AAID,GAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,UAAU,EAAE,CAAC,EAAE;;AAEvC,QAAI,OAAO,UAAU,KAAK,QAAQ,EAAE;AAClC,gBAAU,GAAG,CAAC,CAAC;KAChB;AACD,QAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;GACvC,CAAC,CAAC;;;AAGH,MAAI,GAAG,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,oBAAO,MAAM,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;;AAEjE,KAAG,CAAC,KAAK,CAAC,YAAY;;AAEpB,QAAI,KAAK,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AAC5C,QAAI,KAAK,GAAG,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,EAAE,CAAC;AAC5C,QAAI,QAAQ,GAAG,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC;AAChC,QAAI,AAAC,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,KAAK,IAAI,CAAC,EAAE,IAChE,CAAC,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,GAAG,KAAK,QAAQ,AAAC,EAAE;;AAEtD,WAAK,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;;AAEvB,WAAK,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;AAC5B,aAAO,KAAK,CAAC,KAAK,CAAC;AACnB,WAAK,CAAC,aAAa,IAAI,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,OAAO,CAAA,AAAC,GAAG,SAAS,EAAE,KAAK,CAAC,CAAC;AAC3E,iBAAW,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;KAChC;GACF,CAAC,CAAC;;AAEH,QAAM,CAAC,MAAM,GAAG,UAAU,KAAK,EAAE;;AAE/B,WAAO,KAAK,CAAC,KAAK,CAAC;AACnB,QAAI,IAAI,CAAC,MAAM,EAAE;;;;AAIf,WAAK,CAAC,MAAM,GAAG;AACb,eAAO,EAAE,IAAI,CAAC,EAAE,IAAI,EAAE;AACtB,WAAG,EAAE,IAAI,CAAC,QAAQ;AAClB,cAAM,EAAE,IAAI,CAAC,YAAY,IAAI,YAAY;OAC1C,CAAC;KACH;AACD,SAAK,CAAC,eAAe,IAAI,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,OAAO,CAAA,AAAC,GAAG,SAAS,EAAE,KAAK,CAAC,CAAC;;AAE7E,OAAG,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;GACvB,CAAC;;;AAGF,WAAS,kBAAkB,CAAC,CAAC,EAAE;AAC7B,QAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;;AAEnB,aAAO,CAAC,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;KAChD,MAAM;;AAEL,YAAM,EAAE,CAAC;KACV;GACF;;;AAGD,WAAS,IAAI,GAAG;AACd,KAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC;GAC/C;;;AAGD,WAAS,MAAM,GAAG;AAChB,KAAC,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC;GACjD;;;AAGD,WAAS,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE;AACxB,WAAO,IAAI,iBAAI,IAAI,CAAC,GAAG,CAAC,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;GACnD;;;AAGD,WAAS,UAAU,CAAC,GAAG,EAAE;AACvB,WAAO,IAAI,iBAAI,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;GACnC;;;AAGD,WAAS,KAAK,CAAC,IAAI,EAAE,MAAM,EAAE;AAC3B,QAAI,GAAG,GAAG,IAAI,iBAAI,IAAI,CAAC,IAAI,CAAC,CAAC;AAC7B,KAAC,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,CAAC,EAAE,CAAC,EAAE;AAC7B,SAAG,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;KACzB,CAAC,CAAC;AACH,WAAO,GAAG,CAAC,QAAQ,EAAE,CAAC;GACvB;;;;;;;AAOD,WAAS,YAAY,CAAC,MAAM,EAAE;AAC5B,QAAI,CAAC,MAAM,CAAC,SAAS,EAAE;AACrB,YAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;KACrD;AACD,QAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAC9C,QAAI,EAAE,GAAG,UAAU,GAAG,MAAM,CAAC,SAAS,GAAG,WAAW,CAAC;AACrD,QAAI,UAAU,GAAG,EAAE,CAAC;;AAEpB,QAAI,MAAM,CAAC,QAAQ,EAAE;AACnB,gBAAU,GAAG,sBAAS,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;KAC/C;AACD,KAAC,CAAC,MAAM,CAAC,MAAM,EAAE,EAAC,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,EAAC,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;;AAE7E,UAAM,CAAC,YAAY,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;AACvC,KAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC5D,KAAC,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;AACtC,UAAM,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC;AAC3B,WAAO,MAAM,CAAC;GACf;;AAED,WAAS,MAAM,CAAC,EAAE,EAAE;AAClB,WAAO,EAAE,CAAC,OAAO,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC;GACpC;;AAED,WAAS,KAAK,GAAG;AACf,QAAI,MAAM,CAAC,KAAK,EAAE;AAChB,SAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;KAC3D;GACF;;AAED,WAAS,GAAG,GAAG;AACb,QAAI,GAAG,GAAG,CAAC,CAAC,GAAG,IAAK,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,AAAC,CAAC;AACxC,QAAI,GAAG,EAAE;AACP,SAAG,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;KACzB;GACF;;AAED,WAAS,QAAQ,GAAG;;AAElB,QAAI,KAAK,GAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,AAAC,CAAC;AACnC,QAAI,KAAK,EAAE;AACT,WAAK,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;KAC3B;GACF;;;AAGD,MAAI,EAAE,CAAC;;AAEP,SAAO,IAAI,CAAC;CACb;;;;qBAIc,MAAM;;;;;;;;;;;;sBCzcP,UAAU;;;;mBACR,OAAO;;;;;;;AAKvB,IAAI,SAAS,GAAG,EAAE,CAAC;;;;;qBAKJ,YAAY;AACzB,MAAI,IAAI,GAAG;AACT,cAAU,EAAA,oBAAC,KAAK,EAAE;AAChB,0BAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE;AACzD,eAAO,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;OAC/B,CAAC,CAAC;KACJ;AACD,UAAM,EAAA,gBAAC,GAAG,EAAE;AACV,UAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;AAC9C,UAAI,OAAO,EAAE;AACX,eAAO,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;OACtC;AACD,aAAO,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;AACvC,aAAO,IAAI,CAAC;KACb;AACD,QAAI,EAAA,cAAC,MAAM,EAAE,GAAG,EAAE;AAChB,UAAI,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;AAC5B,iBAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;OAC9B;AACD,UAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG;AAC9C,WAAG,EAAE,GAAG,CAAC,MAAM;AACf,gBAAQ,EAAA,oBAAG;AACT,cAAI,KAAK,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AAC5C,cAAI,KAAK,GAAG,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,EAAE,CAAC;AAC5C,cAAI,QAAQ,GAAG,GAAG,CAAC,EAAE,GAAG,QAAQ,CAAC;AACjC,cAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;;AAEpB,iBAAK,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;AACvB,gBAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;WACxB;SACF;OACF,CAAC;AACF,aAAO,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;;;AAGpC,aAAO,CAAC,GAAG,CAAC,EAAE,CAAC,mBAAmB,EAAE,YAAY;AAC9C,YAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;OAClB,CAAC,CAAC;KACJ;GACF,CAAC;AACF,SAAO,IAAI,CAAC;CACb;;;;;;;;;;;;;sBCpDa,UAAU;;;;;;;;;AAMxB,IAAI,qBAAqB,GAAG,CAC1B,QAAQ,EACR,MAAM,CACP,CAAC;;;;;;;AAOF,IAAI,SAAS,GAAG,KAAK,CAAC;;;;;;;AAOtB,IAAI,cAAc,GAAG,GAAG,CAAC;;AAEzB,SAAS,IAAI,GAAG;AACd,SAAO,MAAM,CAAC,WAAW,IAAI,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;CACvG;;AAED,SAAS,SAAS,CAAC,QAAQ,EAAE,SAAS,EAAE;AACtC,MAAI,OAAO,GAAG,EAAE,CAAC;AACjB,MAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACzB,MAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,MAAI,CAAC,iBAAiB,GAAG;AACvB,SAAK,EAAE,iBAAY;AACjB,aAAO,CAAC,YAAY,GAAG,IAAI,EAAE,CAAC;KAC/B;AACD,OAAG,EAAE,eAAY;AACf,UAAI,KAAK,GAAG,IAAI,EAAE,GAAG,OAAO,CAAC,YAAY,CAAC;AAC1C,WAAK,CAAC,KAAK,CAAC,yBAAyB,EAAE;AACrC,gBAAQ,EAAE,QAAQ;AAClB,iBAAS,EAAE,SAAS;AACpB,aAAK,EAAE,KAAK,GAAG,SAAS,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,AAAC,KAAK,GAAI,cAAc,CAAC;OACrE,CAAC,CAAC;AACH,aAAO,OAAO,CAAC,YAAY,CAAC;KAC7B;AACD,WAAO,EAAE,mBAAY;AACnB,WAAK,CAAC,KAAK,CAAC,4BAA4B,EAAE;AACxC,gBAAQ,EAAE,QAAQ;AAClB,iBAAS,EAAE,SAAS;OACrB,CAAC,CAAC;;AAEH,UAAI,CAAC,GAAG,EAAE,CAAC;KACZ;;AAED,UAAM,EAAE,kBAAY;AAClB,WAAK,CAAC,KAAK,CAAC,2BAA2B,EAAE;AACvC,gBAAQ,EAAE,QAAQ;AAClB,iBAAS,EAAE,SAAS;OACrB,CAAC,CAAC;KACJ;GACF,CAAC;CAEH;;AAED,IAAI,KAAK,GAAG,SAAS,CAAC,SAAS,CAAC;;AAEhC,KAAK,CAAC,MAAM,GAAG,YAAY;AACzB,SAAO,IAAI,CAAC,QAAQ,GAAG,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;CAC7C,CAAC;;AAEF,KAAK,CAAC,KAAK,GAAG,UAAU,IAAI,EAAE,IAAI,EAAE;AAClC,MAAI,YAAY,GAAG,gBAAgB,GAAG,IAAI,CAAC;AAC3C,MAAI,GAAG,CAAC,SAAS,EAAE;AACjB,OAAG,CAAC,SAAS,CAAC,6BAA6B,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;GACjE,MAAM,IAAI,GAAG,CAAC,OAAO,EAAE;;AAEtB,OAAG,CAAC,OAAO,CAAC,gBAAgB,EAAE;AAC5B,UAAI,EAAE,YAAY;AAClB,UAAI,EAAE,IAAI;KACX,CAAC,CAAC;GACJ,MAAM;AACL,WAAO,KAAK,CAAC;GACd;;AAED,SAAO,IAAI,CAAC;CACb,CAAC;;AAEF,KAAK,CAAC,iBAAiB,GAAG,UAAU,IAAI,EAAE;AACxC,MAAI,oBAAE,OAAO,CAAC,IAAI,EAAE,qBAAqB,CAAC,KAAK,CAAC,CAAC,EAAE;AACjD,WAAO,KAAK,CAAC;GACd;AACD,MAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE;AAChC,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI,CAAC,QAAQ;AACvB,aAAS,EAAE,IAAI,CAAC,SAAS;GAC1B,CAAC,CAAC;CACJ,CAAC;;qBAEa;AACb,KAAG,EAAA,aAAC,QAAQ,EAAE,SAAS,EAAE;AACvB,WAAO,IAAI,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;GAC3C;CACF;;;;;;;;;;;;sBCvGa,UAAU;;;;yBACR,eAAe;;;;;;;;AAM/B,SAAS,mBAAmB,CAAC,MAAM,EAAE;AACnC,MAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACpC,MAAI,CAAC,GAAG,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC;AACnE,SAAO,oBAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;CACpC;AACD,SAAS,mBAAmB,CAAC,MAAM,EAAE;AACnC,MAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACpC,MAAI,CAAC,GAAG,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC;AACnE,SAAO,oBAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;CACpC;;AAED,SAAS,oBAAoB,CAAC,MAAM,EAAE;AACpC,MAAI,SAAS,GAAG,mBAAmB,CAAC,MAAM,CAAC,CAAC;AAC5C,MAAI,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,kBAAkB,CAAC,GAAG,cAAc,GAAG,QAAQ,CAAC;AAC3E,SAAO,MAAM,CAAC,GAAG,CAAC,IAAI,GAAG,SAAS,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;CACtD;;AAED,SAAS,cAAc,CAAC,GAAG,EAAE;AAC3B,MAAI,KAAK,GAAG,IAAI,uBAAI,IAAI,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC;AACzC,MAAI,GAAG,GAAG,EAAE,CAAC;AACb,sBAAE,IAAI,CAAC,KAAK,EAAE,UAAU,GAAG,EAAE,KAAK,EAAE;AAClC,OAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;GAC1B,CAAC,CAAC;AACH,SAAO,GAAG,CAAC;CACZ;;AAED,SAAS,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE;;AAEhD,WAAS,eAAe,CAAC,KAAK,EAAE;AAC9B,SAAK,CAAC,cAAc,EAAE,CAAC;AACvB,QAAI,GAAG,GAAG,yBAAE,KAAK,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5C,QAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC5B,QAAI,GAAG,GAAG,IAAI,uBAAI,IAAI,CAAC,IAAI,CAAC,CAAC;AAC7B,QAAI,OAAO,GAAG;AACZ,YAAM,EAAE,GAAG;AACX,YAAM,EAAE,GAAG,CAAC,IAAI,EAAE;AAClB,WAAK,EAAE,GAAG,CAAC,kBAAkB,CAAC,OAAO,CAAC;AACtC,YAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,QAAQ,CAAC;AACxC,QAAE,EAAE,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC;AAChC,SAAG,EAAE,mBAAmB,CAAC,GAAG,CAAC;AAC7B,oBAAc,EAAE,cAAc,CAAC,IAAI,CAAC;KACrC,CAAC;AACF,YAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GACrC;;AAED,2BAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;CAE1D;;qBAEc;AACb,cAAY,EAAZ,YAAY;AACZ,sBAAoB,EAApB,oBAAoB;AACpB,qBAAmB,EAAnB,mBAAmB;AACnB,qBAAmB,EAAnB,mBAAmB;CACpB;;;;;;;;;;;;sBC7Da,UAAU;;;;yBACF,aAAa;;;;mBACnB,OAAO;;;;8BACF,qBAAqB;;;;oBACzB,QAAQ;;;;AAEzB,IAAI,KAAK,GAAG,MAAM,CAAC,qBAAqB,IAAI,UAAU,CAAC,EAAE;AACvD,YAAU,CAAC,CAAC,EAAC,EAAE,CAAC,CAAC;CAClB,CAAC;;AAEF,SAAS,UAAU,CAAC,EAAE,EAAE;AACtB,MAAI,CAAC,EAAE,EAAE;AACP,UAAM,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;GACjC;AACD,SAAO,yBAAE,QAAQ,CAAC,cAAc,CAAC,WAAW,GAAG,EAAE,CAAC,CAAC,CAAC;CACrD;;;;;;;;;;;;;;;;;;;;;;;AAuBD,SAAS,MAAM,CAAC,OAAO,EAAE;AACvB,MAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,EAAE;AACxC,WAAO,CAAC,QAAQ,GAAG,4BAAS,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;GAClD;;AAED,MAAI,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;AACpB,MAAI,SAAS,GAAG,WAAW,GAAG,EAAE,CAAC;AACjC,MAAI,SAAS,GAAG,UAAU,GAAG,EAAE,CAAC;AAChC,MAAI,SAAS,GAAG,OAAO,CAAC,CAAC,IAAI,MAAM,CAAC;AACpC,MAAI,UAAU,GAAG,OAAO,CAAC,CAAC,IAAI,GAAG,CAAC;;AAElC,MAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,EAAE;AACxC,WAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;GACvB;;AAED,MAAI,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE;AACrB,WAAO,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC;GACnC;;AAED,MAAI,UAAU,GAAG;AACf,UAAM,EAAE,OAAO,CAAC,GAAG;AACnB,aAAS,EAAE,OAAO,CAAC,GAAG;AACtB,aAAS,EAAE,SAAS;AACpB,WAAO,EAAE,SAAS;AAClB,SAAK,EAAE,EAAC,KAAK,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAC;AAC7C,YAAQ,EAAE,OAAO,CAAC,QAAQ;GAC3B,CAAC;;AAEF,MAAI,OAAO,CAAC,UAAU,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;AACjD,WAAO,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;GACzD;;AAED,mBAAI,MAAM,CAAC;AACT,QAAI,EAAE,cAAU,IAAI,EAAE,GAAG,EAAE;AACzB,SAAG,CAAC,SAAS,GAAG,uBAAU,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;AAChD,SAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;AACxC,SAAG,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,CAAC;KAC7C;GACF,CAAC,CAAC;;AAEH,mBAAI,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;CAE/B;;qBAEc,UAAU,OAAO,EAAE;;AAEhC,MAAI,cAAc,GAAG,CAAC,CAAC;AACvB,WAAS,QAAQ,GAAG;;AAElB,QAAI,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,CAAC,IAAI,cAAc,GAAG,EAAE,EAAE;AAC9D,gBAAU,CAAC,YAAY;AACrB,sBAAc,EAAE,CAAC;AACjB,gBAAQ,EAAE,CAAC;OACZ,EAAE,EAAE,CAAC,CAAC;AACP,aAAO;KACR;;;AAGD,UAAM,CAAC,OAAO,CAAC,CAAC;GACjB;;AAED,MAAI,GAAG,CAAC,CAAC,CAAC,OAAO,EAAE;;;;AAIjB,SAAK,CAAC,QAAQ,CAAC,CAAC;GACjB,MAAM;AACL,6BAAE,QAAQ,CAAC,CAAC;GACb;CAEF;;AAAA,CAAC;;;;;;;;;;;;uBC5GiB,WAAW;;;;sBACL,UAAU;;;;4BACV,kBAAkB;;;;sBAC7B,WAAW;;;;AAEzB,IAAI,OAAO,GAAG,yBAAE,MAAM,CAAC,CAAC;AACxB,IAAI,KAAK,GAAG,CAAC,CAAC;AACd,IAAI,MAAM,CAAC;AACX,IAAI,MAAM,CAAC;AACX,IAAI,QAAQ,CAAC;;AAEb,IAAI,OAAO,GAAG;AACZ,QAAM,EAAE,oBAAa,MAAM,CAAC;AAC1B,QAAI,EAAE,WAAW;GAClB,CAAC;AACF,QAAM,EAAE,oBAAa,MAAM,CAAC;AAC1B,QAAI,EAAE,WAAW;GAClB,CAAC;CACH,CAAC;;AAEF,SAAS,gBAAgB,CAAC,CAAC,EAAE;AAC3B,MAAI,CAAC,CAAC,OAAO,KAAK,EAAE,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE;AAC7C,UAAM,CAAC,IAAI,EAAE,CAAC;AACd,6BAAE,QAAQ,CAAC,CAAC,MAAM,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;GACjD;CACF,CAAC;;AAEF,SAAS,mBAAmB,CAAC,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE;AACxD,MAAI,GAAG,GAAG,yBAAE,GAAG,GAAG,OAAO,CAAC,EAAE,CAAC,CAAC;AAC9B,MAAI,YAAY,GAAG,CAAC,gBAAgB,CAAC,CAAC;;AAEtC,MAAI,UAAU,EAAE;AACd,gBAAY,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;GAChD;;AAED,MAAI,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE;AACpB,OAAG,GAAG,yBAAE,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC;AACzB,QAAE,EAAE,OAAO,CAAC,EAAE;AACd,eAAS,EAAE,OAAO,CAAC,MAAM;AACzB,aAAO,EAAE,OAAO,CAAC,OAAO;AACxB,UAAI,EAAE,OAAO,CAAC,IAAI;AAClB,kBAAY,EAAE,YAAY;AAC1B,kBAAY,EAAE,IAAI;AAClB,yBAAmB,EAAE,IAAI;AACzB,WAAK,EAAE,IAAI;KACZ,CAAC,CAAC,CAAC;GACL,MAAM;AACL,OAAG,GAAG,yBAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAChB,OAAG,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAC1D,QAAI,YAAY,EAAE;AAChB,SAAG,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;KACtC;GACF;;AAED,MAAI,UAAU,EAAE;AACd,OAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,IAAI,EAAE,CAAC;GACnC,MAAM;AACL,WAAO,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AAC3C,WAAO,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;;AAE3C,QAAI,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;AACrD,UAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC;AAC/B,UAAM,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,EAAE,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACtD,UAAM,CAAC,IAAI,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC;GAE3C;;AAED,WAAS,OAAO,CAAC,MAAM,EAAE;;AAEvB,QAAI,MAAM,CAAC,SAAS,EAAE,EAAE;AACtB,YAAM,CAAC,GAAG,CAAC,OAAO,CAAC,iBAAiB,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;KACxD;GACF;;AAED,sBAAE,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,EAAE,MAAM,EAAE;AACnC,UAAM,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY;AAC3B,aAAO,CAAC,MAAM,CAAC,CAAC;KACjB,CAAC,CAAC;GACJ,CAAC,CAAC;;AAEH,SAAO,GAAG,CAAC;CACZ;;AAED,SAAS,oBAAoB,CAAC,UAAU,EAAE,OAAO,EAAE;AACjD,YAAU,CAAC,MAAM,CAAC,oBAAoB,GAAG,OAAO,CAAC,EAAE,GAAG,4CAA4C,CAAC,CAAC;CACrG;;AAGD,SAAS,cAAc,CAAC,KAAK,EAAE,QAAQ,EAAE;AACvC,MAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;AAC7B,QAAI,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;AACtD,SAAK,GAAG,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;AAC5B,QAAI,OAAO,EAAE;AACX,WAAK,GAAG,KAAK,GAAG,GAAG,GAAG,QAAQ,CAAC;KAChC;GACF;AACD,SAAO,KAAK,CAAC;CACd;;AAED,SAAS,WAAW,GAAG;AACrB,MAAI,MAAM,EAAE;;;AAGV,UAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAChB,OAAO,CAAC,mBAAmB,CAAC,CAC5B,UAAU,CAAC,mBAAmB,CAAC,CAC/B,MAAM,EAAE,CAAC;;AAEd,UAAM,GAAG,IAAI,CAAC;GACf;AACD,QAAM,CAAC,IAAI,EAAE,CAAC;CACf;;qBAEc;AACb,IAAE,EAAE,QAAQ;;AAEZ,WAAS,EAAA,mBAAC,IAAI,EAAE;AACd,QAAI,OAAO,GAAG,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,IAAI,CAAC;AAC/D,WAAO,AAAC,IAAI,IAAM,OAAO,AAAC,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC;GACtD;;;;;;;;;;;;;AAaD,QAAM,EAAA,gBAAC,OAAO,EAAE,oBAAoB,EAAE;AACpC,QAAI,cAAc,GAAG;;AAEnB,WAAK,EAAE,KAAK;AACZ,YAAM,EAAE,KAAK;KACd,CAAC;AACF,QAAI,QAAQ,GAAG,OAAO,CAAC,EAAE,IAAI,YAAY,IAAI,KAAK,IAAI,CAAC,CAAA,AAAC,CAAC;AACzD,QAAI,aAAa,GAAG,oBAAE,MAAM,CAAC,IAAI,EAAE,EAAC,EAAE,EAAE,QAAQ,EAAC,EAAE,cAAc,EAAE,OAAO,EAAE,EAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,IAAI,EAAE,aAAa,EAAC,IAAI,EAAC,EAAC,CAAC,CAAC;AAC9H,QAAI,aAAa,CAAC;;;AAGlB,QAAI,aAAa,CAAC,KAAK,KAAK,MAAM,IAAI,aAAa,CAAC,MAAM,KAAK,MAAM,EAAE;AACrE,mBAAa,CAAC,IAAI,GAAG,SAAS,CAAC;KAChC;;AAED,iBAAa,CAAC,CAAC,GAAG,cAAc,CAAC,aAAa,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,CAAC,CAAC;AACvE,iBAAa,CAAC,CAAC,GAAG,cAAc,CAAC,aAAa,CAAC,MAAM,EAAE,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC;;AAEzE,UAAM,GAAG,yBAAE,SAAS,CAAC,CAChB,QAAQ,CAAC,qCAAqC,CAAC,CAC/C,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,OAAO,CAAC,EAAE,CAAC,CAC9B,IAAI,CAAC,iBAAiB,EAAE,WAAW,CAAC,CAAC;;AAE1C,QAAI,OAAO,CAAC,MAAM,EAAE;AAClB,mBAAa,GAAG,mBAAmB,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;KAC5D,MAAM;AACL,mBAAa,GAAG,mBAAmB,CAAC,aAAa,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;KAClE;;AAED,QAAI,OAAO,CAAC,IAAI,EAAE;AAChB,mBAAa,CAAC,CAAC,GAAG,MAAM,CAAC;AACzB,mBAAa,CAAC,CAAC,GAAG,MAAM,CAAC;KAC1B,MAAM;AACL,SAAG,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;AACtE,mBAAa,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC;KACjD;;AAED,iBAAa,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC1D,UAAM,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;;AAEpC,UAAM,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;;AAE/B,6BAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;;AAE5C,wBAAE,IAAI,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,MAAM,EAAE;AACtC,YAAM,CAAC,KAAK,CAAC,YAAY;AACvB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;OACvB,CAAC,CAAC;KACJ,CAAC,CAAC;;AAEH,wBAAoB,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;;AAE5C,QAAI,oBAAoB,KAAK,KAAK,EAAE;AAClC,YAAM,CAAC,MAAM,CAAC,0BAAa,oBAAoB,EAAE,CAAC,CAAC;KACpD;;;AAGD,QAAI,OAAO,CAAC,GAAG,EAAE;AACf,+BAAO,aAAa,CAAC,CAAC;KACvB;;;;AAID,iBAAa,CAAC,EAAE,CAAC,kBAAkB,EAAE,QAAQ,EAAE,YAAY;AACzD,UAAI,CAAC,KAAK,EAAE,CAAC;KACd,CAAC,CAAC;;AAEH,QAAI,YAAY,GAAG,yBAAE,GAAG,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACrD,QAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;AAC7B,YAAM,CAAC,IAAI,EAAE,CAAC;KACf;;AAED,WAAO,MAAM,CAAC;GAEf;;AAED,OAAK,EAAE,WAAW;CACnB;;;;;;;;;;;;uBCjNmB,YAAY;;;;mBACb,OAAO;;;;uBACA,WAAW;;;;sBACvB,WAAW;;;;qBAEV,YAAY;AACzB,MAAI,MAAM,GAAG,OAAO,CAAC;AACrB,MAAI,QAAQ,GAAG,YAAY,CAAC;;AAE5B,WAAS,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE;AAC/B,QAAI,cAAc,GAAG,qBAAQ,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAClE,QAAI,SAAS,GAAG,qBAAQ,mBAAmB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAC5D,QAAI,QAAQ,GAAG,qBAAQ,mBAAmB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;;AAE3D,wBAAE,MAAM,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;;AAElC,QAAI,CAAC,OAAO,CAAC,EAAE,EAAE;AACf,aAAO,CAAC,EAAE,GAAG,SAAS,CAAC;KACxB;;AAED,QAAI,CAAC,OAAO,CAAC,SAAS,EAAE;AACtB,aAAO,CAAC,SAAS,GAAG,OAAO,CAAC,EAAE,CAAC;KAChC;;;AAGD,QAAI,OAAO,OAAO,CAAC,MAAM,KAAK,QAAQ,EAAE;AACtC,aAAO,CAAC,MAAM,GAAG,AAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,KAAK,OAAO,GAAI,KAAK,GAAG,IAAI,CAAC;KAC5E;;;AAGD,QAAI,OAAO,CAAC,MAAM,KAAK,SAAS,EAAE;AAChC,aAAO,CAAC,MAAM,GAAG,IAAI,CAAC;KACvB;;AAED,8BAAc;AACZ,SAAG,EAAE,QAAQ;AACb,eAAS,EAAE,SAAS;KACrB,EAAE,OAAO,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;GACrC;;AAED,uBAAQ,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;CAClD;;;;;;;;;;;;;sBCzCa,WAAW;;;;AAEzB,SAAS,MAAM,CAAC,OAAO,EAAE;AACvB,MAAI,CAAC,GAAG,GAAG,yBAAE,YAAY,CAAC,CACrB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAClB,QAAQ,CAAC,wBAAwB,GAAG,OAAO,CAAC,IAAI,CAAC,CACjD,QAAQ,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;;AAEzC,MAAI,CAAC,SAAS,GAAG,YAAY;AAC3B,WAAO,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,MAAM,CAAA,AAAC,CAAC;GACrD,CAAC;;AAEF,MAAI,CAAC,UAAU,GAAG,UAAU,OAAO,EAAE;;AAEnC,QAAI,OAAO,CAAC,SAAS,KAAK,IAAI,EAAE;AAC9B,aAAO,KAAK,CAAC;KACd;AACD,QAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,OAAO,CAAC,CAAC;AACzC,WAAO,IAAI,CAAC;GACb,CAAC;;AAEF,MAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;AAEtB,MAAI,CAAC,KAAK,GAAG,UAAU,QAAQ,EAAE;AAC/B,QAAI,QAAQ,EAAE;AACZ,UAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;AACnC,UAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;KAC5C,MAAM;AACL,UAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;KACrB;GACF,CAAC;;AAEF,MAAI,CAAC,QAAQ,GAAG,UAAU,MAAM,EAAE;AAChC,QAAI,IAAI,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,CAAC;AACpC,WAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;GACrE,CAAC;;AAEF,MAAI,CAAC,OAAO,GAAG,UAAU,IAAI,EAAE;AAC7B,QAAI,IAAI,EAAE;AACR,UAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACrB;GACF,CAAC;CAEH;;qBAEc;AACb,QAAM,EAAA,gBAAC,OAAO,EAAE;AACd,WAAO,IAAI,MAAM,CAAC;AAChB,UAAI,EAAE,SAAS;AACf,UAAI,EAAE,QAAQ;AACd,uBAAiB,EAAE,kBAAkB;AACrC,aAAO,EAAE,OAAO;KACjB,CAAC,CAAC;GACJ;;AAED,QAAM,EAAA,gBAAC,OAAO,EAAE;AACd,WAAO,IAAI,MAAM,CAAC;AAChB,UAAI,EAAE,MAAM;AACZ,UAAI,EAAE,QAAQ;AACd,eAAS,EAAE,IAAI;AACf,uBAAiB,EAAE,kBAAkB;AACrC,aAAO,EAAE,OAAO;KACjB,CAAC,CAAC;GACJ;CACF;;;;;;;;;;;;mBChEkB,OAAO;;;;sBACZ,WAAW;;;;;;;;;;;;;qBASV,UAAU,OAAO,EAAE,aAAa,EAAE,cAAc,EAAE;AAC/D,MAAI,OAAO,CAAC;AACZ,MAAI,SAAS,CAAC;AACd,MAAI,QAAQ,GAAG,oBAAE,MAAM,CAAC,EAAC,QAAQ,EAAE,CAAC,EAAC,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAEzD,mBAAO,MAAM,CAAC;AACZ,MAAE,EAAE,OAAO,CAAC,EAAE;AACd,MAAE,EAAE,OAAO,CAAC,SAAS,IAAI,OAAO,CAAC,GAAG;AACpC,UAAM,EAAE,aAAa,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM;AAC9C,UAAM,EAAE,aAAa,CAAC,MAAM;AAC5B,SAAK,EAAE,aAAa,CAAC,KAAK;AAC1B,UAAM,EAAE,aAAa,CAAC,MAAM;AAC5B,QAAI,EAAE,aAAa,CAAC,IAAI;AACxB,cAAU,EAAE,aAAa,CAAC,UAAU;AACpC,cAAU,EAAE,aAAa,CAAC,UAAU;GACrC,EAAE,KAAK,CAAC,CAAC;;AAEV,WAAS,GAAG,yBAAE,sBAAsB,CAAC,CAAC;AACtC,MAAI,OAAO,CAAC,GAAG,EAAE;AACf,UAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;GAC1D;;AAED,SAAO,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,mBAAmB,CAAC;AACvD,YAAQ,EAAE,OAAO,CAAC,GAAG;AACrB,aAAS,EAAE,OAAO,CAAC,SAAS;AAC5B,kBAAc,EAAE,cAAc;AAC9B,YAAQ,EAAE,QAAQ;GACnB,CAAC,CAAC;;AAEH,SAAO,CACF,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,QAAI,UAAU,GAAG,yBAAE,IAAI,CAAC,CAAC;AACzB,cAAU,CAAC,QAAQ,CAAC,qBAAqB,CAAC,CAAC;AAC3C,aAAS,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;GACnC,CAAC,CACD,IAAI,CAAC,UAAU,GAAG,EAAE,MAAM,EAAE,EAAE,EAAE;AAC/B,QAAI,KAAK,GAAG,yBAAE,qBAAqB,CAAC,CAAC,IAAI,CAAC,wDAAwD,CAAC,CAAC;AACpG,QAAI,GAAG,GAAG,MAAM,IAAI,EAAE,GAAG,IAAI,GAAG,EAAE,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAA,AAAC,CAAC;AACpD,aAAS,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;AACvE,aAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACnC,aAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AACxC,OAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;GACd,CAAC,CAAC;;AAEP,0BAAc;CACf;;;;;;;;;;;;;mBCvDkB,OAAO;;;;uBACA,WAAW;;;;sBACvB,WAAW;;;;qBAEV,YAAY;AACzB,SAAO;AACL,SAAK,EAAE,CAAC,eAAe,CAAC;;AAExB,QAAI,EAAA,cAAC,KAAK,EAAE,GAAG,EAAE;;AAEf,UAAI,KAAK,CAAC,GAAG,KAAK,GAAG,EAAE;AACrB,WAAG,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;OAC9B;;AAED,UAAI,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE;AACzB,YAAI,OAAO,GAAG,iBAAO,SAAS,EAAE,CAAC;AACjC,YAAI,OAAO,EAAE;AACX,8BAAE,IAAI,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,MAAM,EAAE;AACtC,kBAAM,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE;AAClC,kBAAI,GAAG,CAAC,QAAQ,EAAE,IAAI,GAAG,CAAC,mBAAmB,EAAE;AAC7C,mBAAG,CAAC,aAAa,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;eACnC,MAAM;AACL,wBAAQ,CAAC,IAAI,CAAC,CAAC;eAChB;aACF,CAAC,CAAC;WACJ,CAAC,CAAC;SACJ;OACF;KAEF;;AAED,aAAS,EAAE;AACT,yBAAmB,EAAA,+BAAG;AACpB,YAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;OACjC;;AAED,4BAAsB,EAAA,gCAAC,IAAI,EAAE,OAAO,EAAE;AACpC,yBAAO,SAAS,CAAC,IAAI,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;OAC5C;;AAED,2BAAqB,EAAA,+BAAC,IAAI,EAAE,QAAQ,EAAE;AACpC,YAAI,MAAM,GAAG,iBAAO,SAAS,CAAC,IAAI,CAAC,CAAC;AACpC,gBAAQ,CAAC,MAAM,GAAG,MAAM,CAAC,SAAS,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC;OAChD;;AAED,kBAAY,EAAA,sBAAC,aAAa,EAAE;AAC1B,YAAI,UAAU,GAAG;AACf,aAAG,EAAE,IAAI,CAAC,QAAQ;SACnB,CAAC;;;AAGF,YAAI,aAAa,CAAC,GAAG,EAAE;AACrB,oBAAU,CAAC,SAAS,GAAG,aAAa,CAAC,GAAG,CAAC;SAC1C,MAAM,IAAI,aAAa,CAAC,GAAG,EAAE;AAC5B,gBAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;SACrE;;AAED,YAAI,yBAAE,uBAAuB,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;AAC3C,gBAAM,IAAI,KAAK,CAAC,oDAAoD,CAAC,CAAC;SACvE;;AAED,kCAAc,UAAU,EAAE,aAAa,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;OAE/D;AACD,iBAAW,EAAA,uBAAG;AACZ,yBAAO,KAAK,EAAE,CAAC;OAChB;KACF;GACF,CAAC;CACH;;;;;;;;;;;;;;;qBChEc,GAAG,CAAC,CAAC;;;;;;;;;;qBCLL,YAAY;AACzB,SAAO;AACL,aAAS,EAAE;AACT,iBAAW,EAAE,uBAAY;AACvB,eAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;OAC7B;KACF;GACF,CAAC;CACH;;;;;;;;;;;;;sBCRkB,UAAU;;;;uBACT,WAAW;;;;sBACZ,UAAU;;;;yBACV,cAAc;;;;4BACR,iBAAiB;;;;yBACpB,cAAc;;;;mBACpB,OAAO;;;;+BACE,qBAAqB;;;;kCACf,wBAAwB;;;;gCAC1B,qBAAqB;;;;2BAC7B,gBAAgB;;;;sBAClB,UAAU;;;;mBACb,OAAO;;;;4BACE,iBAAiB;;;;8BACrB,qBAAqB;;;;yBAC1B,eAAe;;;;4BACR,iBAAiB;;;;;;;;;;AAQxC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE;AACf,QAAM,CAAC,GAAG,GAAG,EAAE,CAAC;CACjB;;AAED,GAAG,CAAC,MAAM,2BAAc,CAAC;AACzB,GAAG,CAAC,MAAM,iCAAoB,CAAC;;AAE/B,iBAAI,MAAM,qBAAQ,CAAC;AACnB,iBAAI,MAAM,wBAAW,CAAC;AACtB,iBAAI,MAAM,kBAAK,CAAC;AAChB,iBAAI,MAAM,8BAAc,CAAC;AACzB,iBAAI,MAAM,+BAAkB,CAAC;AAC7B,iBAAI,MAAM,0BAAU,CAAC;AACrB,iBAAI,MAAM,qBAAQ,CAAC;AACnB,iBAAI,MAAM,2BAAY,CAAC;;qBAER;AACb,QAAM,EAAE,iBAAI,MAAM;AAClB,MAAI,EAAE,iBAAI,IAAI;AACd,UAAQ,6BAAA;AACR,QAAM,qBAAA;AACN,YAAU,wBAAK;AACf,eAAa,2BAAc;AAC3B,eAAa,sBAAS;AACtB,QAAM,wBAAQ;CACf;;;;;;;;;;;;uBCjDyB,YAAY;;;;sBACP,UAAU;;;;sBAC3B,WAAW;;;;qBAEV,YAAY;AACzB,MAAI,mBAAmB,GAAG,mBAAmB,CAAC;AAC9C,MAAI,MAAM,GAAG,0BAA0B,CAAC;;AAExC,WAAS,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE;AAC1C,QAAI,cAAc,GAAG,qBAAc,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AACxE,wBAAE,MAAM,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;AAClC,QAAI,OAAO,CAAC,OAAO,KAAK,MAAM,IAAI,SAAS,KAAK,OAAO,EAAE;AACvD,aAAO;KACR;;;AAGD,QAAI,OAAO,CAAC,OAAO,KAAK,IAAI,IAAI,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACjE,aAAO;KACR;AACD,6BAAmB,IAAI,EAAE,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;GAC1C;;AAED,uBAAc,YAAY,CAAC,MAAM,EAAE,mBAAmB,EAAE,QAAQ,CAAC,CAAC;CACnE;;;;;;;;;;;;;sBCvBa,WAAW;;;;AAEzB,SAAS,eAAe,CAAC,QAAQ,EAAE;AACjC,SAAO,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;CAC3D;;AAED,SAAS,gBAAgB,CAAC,QAAQ,EAAE;AAClC,iBAAe,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;CAClC;;AAED,SAAS,kBAAkB,CAAC,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE;AACnD,UAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC;AAChC,SAAK,EAAE,KAAK;AACZ,UAAM,EAAE,MAAM;GACf,CAAC,CAAC;AACH,qBAAmB,CAAC,QAAQ,CAAC,CAAC;CAC/B;;AAED,SAAS,mBAAmB,CAAC,QAAQ,EAAE;AACrC,iBAAe,CAAC,QAAQ,CAAC,CAAC,OAAO,EAAE,CAAC;CACrC;;AAED,SAAS,iBAAgB,CAAC,QAAQ,EAAE;AAClC,iBAAe,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;CAClC;;qBAEc,YAAY;AACzB,SAAO;AACL,QAAI,EAAA,cAAC,KAAK,EAAE,GAAG,EAAE;AACf,UAAI,GAAG,CAAC,QAAQ,CAAC,cAAc,EAAE;AAC/B,iCAAE,GAAG,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC,EAAE,UAAU,EAAE;AAC5E,4BAAkB,CAAC,yBAAE,GAAG,CAAC,MAAM,CAAC,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;SACxE,CAAC,CAAC;OACJ;KACF;AACD,aAAS,EAAE;AACT,sBAAgB,EAAA,4BAAG;AACjB,yBAAgB,CAAC,yBAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;OAClC;KACF;GACF,CAAC;CACH;;;;;;;;;;;;;sBCzCa,WAAW;;;;uBACC,YAAY;;;;qBAEvB,UAAU,UAAU,EAAE,OAAO,EAAE;AAC5C,MAAI,aAAa,CAAC;;;AAGlB,MAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE;AAC7C,WAAO;GACR;;AAED,MAAI,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,kBAAkB,CAAC,GAAG,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;AACzH,MAAI,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAChC,MAAI,CAAC,MAAM,EAAE;AACX,WAAO;GACR;;AAED,WAAS,mBAAmB,CAAC,OAAO,EAAE,OAAO,EAAE,gBAAgB,EAAE;AAC/D,WAAO,GAAG,yBAAE,OAAO,CAAC,CAAC;AACrB,WAAO,CAAC,IAAI,CAAC,cAAc,EAAE,aAAa,CAAC,CAAC;AAC5C,QAAI,SAAS,GAAG,qBAAc,mBAAmB,CAAC,OAAO,CAAC,CAAC;AAC3D,QAAI,SAAS,GAAG,qBAAc,mBAAmB,CAAC,OAAO,CAAC,CAAC;AAC3D,QAAI,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,mBAAmB,CAAC;AAC3D,cAAQ,EAAE,SAAS;AACnB,eAAS,EAAT,SAAS;AACT,oBAAc,EAAE,IAAI;AACpB,oBAAc,EAAE,OAAO,CAAC,cAAc;AACtC,cAAQ,EAAE;AACR,sBAAc,EAAE,IAAI;OACrB;KACF,CAAC,CAAC;;AAEH,WAAO,CACF,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,aAAO,CAAC,KAAK,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;AAE7B,UAAI,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM,EAAE;AACnC,eAAO,CAAC,GAAG,CAAC;AACV,eAAK,EAAE,OAAO,CAAC,KAAK;AACpB,gBAAM,EAAE,OAAO,CAAC,MAAM;SACvB,CAAC,CAAC;OACJ;KACF,CAAC,CACD,IAAI,CAAC,UAAU,GAAG,EAAE,MAAM,EAAE,EAAE,EAAE;AAC/B,UAAI,KAAK,GAAG,yBAAE,qBAAqB,CAAC,CAAC,IAAI,CAAC,wDAAwD,CAAC,CAAC;AACpG,aAAO,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;AACrE,aAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACrC,UAAI,GAAG,GAAG,MAAM,IAAI,EAAE,GAAG,IAAI,GAAG,EAAE,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAA,AAAC,CAAC;AACpD,aAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACjC,SAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACd,CAAC,CACD,MAAM,CAAC,YAAY;AAClB,sBAAgB,EAAE,CAAC;KACpB,CAAC,CAAC;GACR;;AAED,MAAI,uBAAuB,GAAG,2BAA2B,GAAG,MAAM,CAAC;;AAEnE,eAAa,GAAG,yBAAE,QAAQ,CAAC,cAAc,CAAC,gBAAgB,GAAG,uBAAuB,CAAC,CAAC,CAAC;;AAEvF,MAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE;AAC9B,iBAAa,CAAC,MAAM,EAAE,CAAC;GACxB;;;AAGD,eAAa,GAAG,GAAG,CAAC,YAAY,CAC5B,OAAO,CAAC,MAAM;;AAEd,yBAAuB,EACvB,mBAAmB,EACnB,OAAO,CACV,CAAC;;AAEF,SAAO;AACL,MAAE,EAAE,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC;;AAE5B,QAAI,EAAA,gBAAG;AACL,mBAAa,CAAC,IAAI,EAAE,CAAC;KACtB;;AAED,QAAI,EAAA,gBAAG;AACL,mBAAa,CAAC,IAAI,EAAE,CAAC;KACtB;GACF,CAAC;CACH;;;;;;;;;;;;;sBCpFa,UAAU;;;;yBACR,eAAe;;;;AAE/B,SAAS,SAAS,CAAC,MAAM,EAAE;AACzB,MAAI,OAAO,GAAG,oBAAE,QAAQ,CAAC,UAAU,KAAK,EAAE;AACxC,QAAI,cAAc,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,mBAAmB,CAAC;AAClE,cAAQ,EAAE,MAAM,CAAC,QAAQ;AACzB,eAAS,EAAE,MAAM,CAAC,SAAS;AAC3B,oBAAc,EAAE,MAAM,CAAC,cAAc;AACrC,cAAQ,EAAE,MAAM,CAAC,QAAQ;AACzB,WAAK,EAAE,MAAM,CAAC,KAAK;AACnB,YAAM,EAAE,MAAM,CAAC,MAAM;AACrB,gBAAU,EAAE,MAAM;KACnB,CAAC,CAAC;;AAEH,kBAAc,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE;AAClC,UAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AAC9B,WAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;KAC3B,CAAC,CAAC;GACJ,CAAC,CAAC;;AAEH,SAAO,OAAO,CAAC;CAChB;;qBAEc;AACb,WAAS,EAAT,SAAS;AACT,WAAS,EAAE,uBAAI,YAAY;CAC5B;;;;;;;;;;;;sBC3Ba,UAAU;;;;mBACR,OAAO;;;;4BACE,iBAAiB;;;;qBAE3B,YAAY;AACzB,SAAO;AACL,QAAI,EAAA,cAAC,KAAK,EAAE,GAAG,EAAE;AACf,UAAI,KAAK,GAAG,yBAAE,GAAG,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;AACnD,gCAAa,iBAAiB,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;;AAEzC,WAAK,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC,KAAK,CAAC,YAAY;AAC/D,kCAAa,mBAAmB,CAAC,KAAK,CAAC,CAAC;AACxC,YAAI,GAAG,CAAC,SAAS,IAAI,GAAG,CAAC,SAAS,CAAC,iBAAiB,EAAE;AACpD,aAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC;SAC1C;OACF,CAAC,CAAC;;AAEH,SAAG,CAAC,OAAO,GAAG,UAAU,CAAC,YAAY;AACnC,WAAG,CAAC,OAAO,GAAG,IAAI,CAAC;AACnB,kCAAa,qBAAqB,CAAC,KAAK,CAAC,CAAC;;AAE1C,YAAI,GAAG,CAAC,QAAQ,EAAE,IAAI,GAAG,CAAC,SAAS,IAAI,GAAG,CAAC,SAAS,CAAC,iBAAiB,EAAE;AACtE,aAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,OAAO,EAAE,CAAC;SAC3C;OACF,EAAE,KAAK,CAAC,CAAC;KACX;;AAED,aAAS,EAAE;AACT,UAAI,EAAA,gBAAG;AACL,YAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,iBAAiB,EAAE;AACtD,cAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,GAAG,EAAE,CAAC;SACxC;AACD,YAAI,KAAK,GAAG,yBAAE,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;AACpD,kCAAa,gBAAgB,CAAC,KAAK,CAAC,CAAC;;AAErC,oBAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;AAE3B,aAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;OACnD;KACF;GACF,CAAC;CACH;;;;;;;;;;;;;sBCzCa,WAAW;;;;AAEzB,IAAI,cAAc,GAAG,sBAAsB,CAAC;AAC5C,IAAI,aAAa,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;;AAE/E,SAAS,iBAAiB,CAAC,KAAK,EAAE;AAChC,SAAO,KAAK,CAAC,MAAM,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC;CACpD;;AAED,SAAS,aAAa,GAAG;AACvB,MAAI,MAAM,GAAG,yBAAE,GAAG,GAAG,cAAc,CAAC,CAAC;;AAErC,MAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AACrB,UAAM,GAAG,yBAAE,WAAW,GAAG,cAAc,GAAG,MAAM,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;GACpE;AACD,SAAO,MAAM,CAAC;CACf;;AAED,SAAS,oBAAoB,CAAC,OAAO,EAAE;AACrC,MAAI,CAAC,CAAC;AACN,MAAI,GAAG,CAAC;AACR,MAAI,IAAI,GAAG,EAAE,CAAC;AACd,MAAI,OAAO,GAAG,CAAC,WAAW,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,EAAE,IAAI,CAAC,CAAC;;AAElE,OAAK,CAAC,IAAI,OAAO,EAAE;AACjB,OAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AACjB,QAAI,GAAG,IAAI,OAAO,EAAE;AAClB,UAAI,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;KAC1B;GACF;;AAED,SAAO,IAAI,CAAC;CACb;;qBAEc;AACb,aAAW,EAAA,qBAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE;AAC1C,QAAI,MAAM,GAAG,aAAa,EAAE,CAAC;;AAE7B,WAAO,GAAG,oBAAoB,CAAC,OAAO,CAAC,CAAC;AACxC,wBAAE,MAAM,CAAC,OAAO,EAAE;AAChB,WAAK,EAAE,KAAK;AACZ,UAAI,EAAE,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC;KAC/B,CAAC,CAAC;;AAEH,QAAI,oBAAE,OAAO,CAAC,IAAI,EAAE,aAAa,CAAC,GAAG,CAAC,EAAE;AACtC,YAAM,iCAAiC,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACpE;AACD,QAAI,iBAAiB,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE;AACjC,SAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;;;AAGpC,YAAM,CAAC,GAAG,CAAC,aAAa,EAAE,GAAG,GAAG,MAAM,CAAC,UAAU,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;KACjE;GACF;;AAED,cAAY,EAAA,sBAAC,EAAE,EAAE;AACf,QAAI,iBAAiB,CAAC,EAAE,CAAC,EAAE;AACzB,+BAAE,GAAG,GAAG,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC;KACtB;GACF;CACF;;;;;;;;;;;;mBC5DoB,OAAO;;;;qBAEb,YAAY;AACzB,SAAO;AACL,aAAS,EAAE;AACT,iBAAW,EAAA,qBAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE;AACtC,eAAO,iBAAS,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;OACzD;;AAED,kBAAY,EAAA,sBAAC,EAAE,EAAE;AACf,eAAO,iBAAS,YAAY,CAAC,EAAE,CAAC,CAAC;OAClC;KACF;GACF,CAAC;CACH;;;;;;;;;;;;;iCCdkB,4BAA4B;;;;;;;;;qBAMhC,YAAY;AACzB,cAAY,CAAC;;AAEb,SAAO;AACL,QAAI,EAAE,cAAU,KAAK,EAAE,GAAG,EAAE;AAC1B,UAAI,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE;AAC5B,uCAAO,aAAa,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,iBAAiB,CAAC,CAAC;OAC1D;KACF;AACD,aAAS,EAAE;AACT,qBAAe,EAAE,+BAAO,YAAY;KACrC;AACD,SAAK,EAAE,CAAC,mBAAmB,CAAC;GAC7B,CAAC;CACH;;;;;;;;;;;;;sBCpBa,UAAU;;;;mBACR,OAAO;;;;qBAER,YAAY;AACzB,MAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,IAAI,oBAAE,QAAQ,CAAC;AAC1C,SAAO;AACL,QAAI,EAAA,cAAC,MAAM,EAAE,GAAG,EAAE;AAChB,SAAG,CAAC,MAAM,GAAG,QAAQ,CAAC,SAAS,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE;AACtD,SAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC;AACjB,eAAK,EAAE,KAAK;AACZ,gBAAM,EAAE,MAAM;SACf,CAAC,CAAC;AACH,YAAI,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;AACpD,aAAK,CAAC,OAAO,CAAC,SAAS,EAAE;AACvB,eAAK,EAAE,KAAK;AACZ,gBAAM,EAAE,MAAM;SACf,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ;;AAED,aAAS,EAAE;AACT,YAAM,EAAA,gBAAC,KAAK,EAAE,MAAM,EAAE;AACpB,YAAI,CAAC,MAAM,sBAAI,KAAK,EAAE,MAAM,CAAC,CAAC;OAC/B;;AAED,kBAAY,EAAE,QAAQ,CAAC,YAAY;AACjC,iBAAS,aAAa,CAAC,MAAM,EAAE;AAC7B,cAAI,MAAM,GAAG,yBAAE,QAAQ,CAAC,CAAC,MAAM,EAAE,GAAG,yBAAE,eAAe,CAAC,CAAC,WAAW,EAAE,GAAG,yBAAE,SAAS,CAAC,CAAC,WAAW,EAAE,GAAG,EAAE,CAAC;AACvG,mCAAE,MAAM,CAAC,CAAC,GAAG,CAAC;AACZ,iBAAK,EAAE,MAAM;AACb,kBAAM,EAAE,MAAM,GAAG,IAAI;WACtB,CAAC,CAAC;SACJ;;AAED,YAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE;;AAE3B,mCAAE,IAAI,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,wBAAwB,CAAC,CAAC;AAClD,mCAAE,MAAM,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAY;AACjC,yBAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;WAC5B,CAAC,CAAC;AACH,uBAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC5B,MAAM;;;AAGL,mCAAE,IAAI,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,6BAA6B,CAAC,CAAC;SACxD;OACF,CAAC;KACH;GACF,CAAC;CACH;;;;;;;;;;;;;sBCjDa,UAAU;;;;4BACL,mBAAmB;;;;4BACb,kBAAkB;;;;yBAC3B,eAAe;;;;AAE/B,IAAI,IAAI,GAAG,oBAAE,IAAI,CAAC;AAClB,IAAI,OAAM,GAAG,oBAAE,MAAM,CAAC;AACtB,IAAI,IAAI,GAAG,oBAAE,UAAU,CAAC;AACxB,IAAI,aAAa,GAAG,EAAE,CAAC;AACvB,IAAI,IAAI,GAAG,EAAE,CAAC;AACd,IAAI,KAAK,GAAG,EAAE,CAAC;AACf,IAAI,SAAS,GAAG,EAAE,CAAC;AACnB,IAAI,KAAK,GAAG,EAAE,CAAC;;qBAEA;AACb,QAAM,EAAA,gBAAC,MAAM,EAAE;AACb,QAAI,IAAI,CAAC,MAAM,CAAC,EAAE;AAChB,YAAM,GAAG,MAAM,EAAE,CAAC;KACnB;;AAED,WAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;AAC1B,WAAM,CAAC,SAAS,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;AACpC,SAAK,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;;AAEzC,QAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;;AAEvB,QAAI,IAAI,CAAC,IAAI,CAAC,EAAE;AACd,WAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAClB;;AAED,WAAO,MAAM,CAAC,IAAI,CAAC;GACpB;;;;AAID,MAAI,EAAA,cAAC,OAAO,EAAE,SAAS,EAAE;AACvB,QAAI,SAAS,GAAG,IAAI,uBAAI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AAC/C,QAAI,SAAS,GAAG,SAAS,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;AACpD,QAAI,OAAO,CAAC;;AAEZ,WAAO,GAAG,OAAO,IAAI,EAAE,CAAC;;AAExB,QAAI,CAAC,IAAI,EAAE,UAAU,MAAM,EAAE;AAC3B,WAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACpB,CAAC,CAAC;;;AAGH,QAAI,SAAS,IAAI,0BAAa,SAAS,CAAC,SAAS,CAAC,EAAE;AAClD,aAAO,GAAG,0BAAa,SAAS,CAAC;AAC/B,gBAAQ,EAAE,SAAS,CAAC,SAAS;AAC7B,iBAAS,EAAE,OAAO,CAAC,EAAE;AACrB,sBAAc,EAAE,OAAO,CAAC,cAAc,IAAI,EAAE;AAC5C,gBAAQ,EAAE,SAAS,CAAC,QAAQ;AAC5B,aAAK,EAAE,SAAS,CAAC,KAAK,CAAC,KAAK;AAC5B,cAAM,EAAE,SAAS,CAAC,KAAK,CAAC,MAAM;OAC/B,CAAC,CAAC;KACJ;;AAED,wBAAE,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,UAAU,GAAG,EAAE;;AAEpC,UAAI,GAAG,EAAE;AACP,iBAAS,CAAC,MAAM,GAAG,GAAG,CAAC;OACxB;;AAED,UAAI,GAAG,GAAG,mDAAc,SAAS,EAAE,EAAC,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,oBAAE,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,EAAC,CAAC,CAAC;;AAEpF,mBAAa,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;AAC5B,UAAI,CAAC,KAAK,EAAE,UAAU,CAAC,EAAE,IAAI,EAAE;AAC7B,YAAI;AACF,cAAI,CAAC,OAAM,CAAC,EAAE,EAAE,OAAO,CAAC,EAAE,GAAG,CAAC,CAAC;SAChC,CAAC,OAAO,EAAE,EAAE;AACX,iBAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;SACjB;OACF,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ;CACF;;;;;;;;;;;;sBC5Ea,UAAU;;;;;;;;AAMxB,IAAI,QAAQ,GAAG;AACb,SAAO,EAAE;AACP,mBAAe,EAAE,oDAAoD;GACtE;AACD,gBAAc,EAAE;AACd,mBAAe,EAAE,kHAAkH;GACpI;;AAED,cAAY,EAAE;AACZ,mBAAe,EAAE,wBAAwB;GAC1C;CACF,CAAC;;AAEF,SAAS,YAAY,CAAC,KAAK,EAAE;;AAE3B,MAAI,KAAK,CAAC,IAAI,CAAC,oBAAoB,CAAC,EAAE;AACpC,gBAAY,CAAC,KAAK,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;AAC/C,SAAK,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC;GACxC;AACD,OAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;CAC7C;;AAED,SAAS,UAAU,CAAC,KAAK,EAAE,MAAM,EAAE;AACjC,cAAY,CAAC,KAAK,CAAC,CAAC;AACpB,OAAK,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;AACrD,OAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;AAC9C,OAAK,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;;AAElD,YAAU,CAAC,YAAY;AACrB,QAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,EAAE,MAAM,GAAG,MAAM,CAAC,CAAC;AAC5D,QAAI,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,IAAI,EAAE;AAClC,aAAO,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,EAAE,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC,EAAC,CAAC,CAAC;KAC7F;GACF,EAAE,EAAE,CAAC,CAAC;CACR;;;AAGD,SAAS,gBAAgB,CAAC,KAAK,EAAE;AAC/B,cAAY,CAAC,KAAK,CAAC,CAAC;CACrB;;AAED,SAAS,iBAAiB,CAAC,KAAK,EAAE,KAAK,EAAE;AACvC,MAAI,CAAC,KAAK,EAAE;AACV,cAAU,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;GAC9B,MAAM;;AAEL,QAAI,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,SAAS,CAAC,EAAE,KAAK,CAAC,CAAC;AACvE,SAAK,CAAC,IAAI,CAAC,oBAAoB,EAAE,KAAK,CAAC,CAAC;GACzC;CACF;;AAED,SAAS,qBAAqB,CAAC,KAAK,EAAE;AACpC,YAAU,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;CACnC;;AAED,SAAS,mBAAmB,CAAC,KAAK,EAAE;AAClC,YAAU,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;CACjC;;AAED,SAAS,oBAAoB,GAAG;AAC9B,MAAI,CAAC,CAAC;AACN,MAAI,KAAK,GAAG,yBAAE,0BAA0B,CAAC,CAAC;;AAE1C,OAAK,CAAC,IAAI,QAAQ,EAAE;AAClB,QAAI,MAAM,GAAG,yBAAE,iBAAiB,GAAG,CAAC,GAAG,uBAAuB,CAAC,CAAC;AAChE,UAAM,CAAC,MAAM,CAAC,SAAS,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,eAAe,GAAG,UAAU,CAAC,CAAC;AACpE,SAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;GACtB;AACD,SAAO,KAAK,CAAC;CACd;;qBAEc;AACb,sBAAoB,EAApB,oBAAoB;AACpB,mBAAiB,EAAjB,iBAAiB;AACjB,uBAAqB,EAArB,qBAAqB;AACrB,qBAAmB,EAAnB,mBAAmB;AACnB,kBAAgB,EAAhB,gBAAgB;CACjB;;;;;;;;;ACnFD,SAAS,cAAc,CAAC,CAAC,EAAE;AACzB,MAAI,CAAC,CAAC,EAAE;AACN,UAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;GAC1C;AACD,SAAO,CAAC,CAAC,OAAO,CAAC,sCAAsC,EAAE,MAAM,CAAC,CAAC;CAClE;;qBAEc,EAAC,cAAc,EAAd,cAAc,EAAC","file":"connect-host.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */\n;(function(root) {\n\n\t// Detect free variables `exports`.\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`.\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code, and use\n\t// it as `root`.\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar InvalidCharacterError = function(message) {\n\t\tthis.message = message;\n\t};\n\tInvalidCharacterError.prototype = new Error;\n\tInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n\tvar error = function(message) {\n\t\t// Note: the error messages used throughout this file match those used by\n\t\t// the native `atob`/`btoa` implementation in Chromium.\n\t\tthrow new InvalidCharacterError(message);\n\t};\n\n\tvar TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t// http://whatwg.org/html/common-microsyntaxes.html#space-character\n\tvar REGEX_SPACE_CHARACTERS = /[\\t\\n\\f\\r ]/g;\n\n\t// `decode` is designed to be fully compatible with `atob` as described in the\n\t// HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob\n\t// The optimized base64-decoding algorithm used is based on @atk’s excellent\n\t// implementation. https://gist.github.com/atk/1020396\n\tvar decode = function(input) {\n\t\tinput = String(input)\n\t\t\t.replace(REGEX_SPACE_CHARACTERS, '');\n\t\tvar length = input.length;\n\t\tif (length % 4 == 0) {\n\t\t\tinput = input.replace(/==?$/, '');\n\t\t\tlength = input.length;\n\t\t}\n\t\tif (\n\t\t\tlength % 4 == 1 ||\n\t\t\t// http://whatwg.org/C#alphanumeric-ascii-characters\n\t\t\t/[^+a-zA-Z0-9/]/.test(input)\n\t\t) {\n\t\t\terror(\n\t\t\t\t'Invalid character: the string to be decoded is not correctly encoded.'\n\t\t\t);\n\t\t}\n\t\tvar bitCounter = 0;\n\t\tvar bitStorage;\n\t\tvar buffer;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\twhile (++position < length) {\n\t\t\tbuffer = TABLE.indexOf(input.charAt(position));\n\t\t\tbitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;\n\t\t\t// Unless this is the first of a group of 4 characters…\n\t\t\tif (bitCounter++ % 4) {\n\t\t\t\t// …convert the first 8 bits to a single ASCII character.\n\t\t\t\toutput += String.fromCharCode(\n\t\t\t\t\t0xFF & bitStorage >> (-2 * bitCounter & 6)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t};\n\n\t// `encode` is designed to be fully compatible with `btoa` as described in the\n\t// HTML Standard: http://whatwg.org/html/webappapis.html#dom-windowbase64-btoa\n\tvar encode = function(input) {\n\t\tinput = String(input);\n\t\tif (/[^\\0-\\xFF]/.test(input)) {\n\t\t\t// Note: no need to special-case astral symbols here, as surrogates are\n\t\t\t// matched, and the input is supposed to only contain ASCII anyway.\n\t\t\terror(\n\t\t\t\t'The string to be encoded contains characters outside of the ' +\n\t\t\t\t'Latin1 range.'\n\t\t\t);\n\t\t}\n\t\tvar padding = input.length % 3;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\tvar a;\n\t\tvar b;\n\t\tvar c;\n\t\tvar d;\n\t\tvar buffer;\n\t\t// Make sure any padding is handled outside of the loop.\n\t\tvar length = input.length - padding;\n\n\t\twhile (++position < length) {\n\t\t\t// Read three bytes, i.e. 24 bits.\n\t\t\ta = input.charCodeAt(position) << 16;\n\t\t\tb = input.charCodeAt(++position) << 8;\n\t\t\tc = input.charCodeAt(++position);\n\t\t\tbuffer = a + b + c;\n\t\t\t// Turn the 24 bits into four chunks of 6 bits each, and append the\n\t\t\t// matching character for each of them to the output.\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 18 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 12 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 6 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer & 0x3F)\n\t\t\t);\n\t\t}\n\n\t\tif (padding == 2) {\n\t\t\ta = input.charCodeAt(position) << 8;\n\t\t\tb = input.charCodeAt(++position);\n\t\t\tbuffer = a + b;\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 10) +\n\t\t\t\tTABLE.charAt((buffer >> 4) & 0x3F) +\n\t\t\t\tTABLE.charAt((buffer << 2) & 0x3F) +\n\t\t\t\t'='\n\t\t\t);\n\t\t} else if (padding == 1) {\n\t\t\tbuffer = input.charCodeAt(position);\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 2) +\n\t\t\t\tTABLE.charAt((buffer << 4) & 0x3F) +\n\t\t\t\t'=='\n\t\t\t);\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tvar base64 = {\n\t\t'encode': encode,\n\t\t'decode': decode,\n\t\t'version': '0.1.0'\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn base64;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = base64;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (var key in base64) {\n\t\t\t\tbase64.hasOwnProperty(key) && (freeExports[key] = base64[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.base64 = base64;\n\t}\n\n}(this));\n","/*!\n * jsUri\n * https://github.com/derek-watson/jsUri\n *\n * Copyright 2013, Derek Watson\n * Released under the MIT license.\n *\n * Includes parseUri regular expressions\n * http://blog.stevenlevithan.com/archives/parseuri\n * Copyright 2007, Steven Levithan\n * Released under the MIT license.\n */\n\n /*globals define, module */\n\n(function(global) {\n\n  var re = {\n    starts_with_slashes: /^\\/+/,\n    ends_with_slashes: /\\/+$/,\n    pluses: /\\+/g,\n    query_separator: /[&;]/,\n    uri_parser: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*)(?::([^:@]*))?)?@)?(\\[[0-9a-fA-F:.]+\\]|[^:\\/?#]*)(?::(\\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n  };\n\n  /**\n   * Define forEach for older js environments\n   * @see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach#Compatibility\n   */\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function(callback, thisArg) {\n      var T, k;\n\n      if (this == null) {\n        throw new TypeError(' this is null or not defined');\n      }\n\n      var O = Object(this);\n      var len = O.length >>> 0;\n\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + ' is not a function');\n      }\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      }\n\n      k = 0;\n\n      while (k < len) {\n        var kValue;\n        if (k in O) {\n          kValue = O[k];\n          callback.call(T, kValue, k, O);\n        }\n        k++;\n      }\n    };\n  }\n\n  /**\n   * unescape a query param value\n   * @param  {string} s encoded value\n   * @return {string}   decoded value\n   */\n  function decode(s) {\n    if (s) {\n        s = s.toString().replace(re.pluses, '%20');\n        s = decodeURIComponent(s);\n    }\n    return s;\n  }\n\n  /**\n   * Breaks a uri string down into its individual parts\n   * @param  {string} str uri\n   * @return {object}     parts\n   */\n  function parseUri(str) {\n    var parser = re.uri_parser;\n    var parserKeys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\", \"host\", \"port\", \"isColonUri\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\n    var m = parser.exec(str || '');\n    var parts = {};\n\n    parserKeys.forEach(function(key, i) {\n      parts[key] = m[i] || '';\n    });\n\n    return parts;\n  }\n\n  /**\n   * Breaks a query string down into an array of key/value pairs\n   * @param  {string} str query\n   * @return {array}      array of arrays (key/value pairs)\n   */\n  function parseQuery(str) {\n    var i, ps, p, n, k, v, l;\n    var pairs = [];\n\n    if (typeof(str) === 'undefined' || str === null || str === '') {\n      return pairs;\n    }\n\n    if (str.indexOf('?') === 0) {\n      str = str.substring(1);\n    }\n\n    ps = str.toString().split(re.query_separator);\n\n    for (i = 0, l = ps.length; i < l; i++) {\n      p = ps[i];\n      n = p.indexOf('=');\n\n      if (n !== 0) {\n        k = decode(p.substring(0, n));\n        v = decode(p.substring(n + 1));\n        pairs.push(n === -1 ? [p, null] : [k, v]);\n      }\n\n    }\n    return pairs;\n  }\n\n  /**\n   * Creates a new Uri object\n   * @constructor\n   * @param {string} str\n   */\n  function Uri(str) {\n    this.uriParts = parseUri(str);\n    this.queryPairs = parseQuery(this.uriParts.query);\n    this.hasAuthorityPrefixUserPref = null;\n  }\n\n  /**\n   * Define getter/setter methods\n   */\n  ['protocol', 'userInfo', 'host', 'port', 'path', 'anchor'].forEach(function(key) {\n    Uri.prototype[key] = function(val) {\n      if (typeof val !== 'undefined') {\n        this.uriParts[key] = val;\n      }\n      return this.uriParts[key];\n    };\n  });\n\n  /**\n   * if there is no protocol, the leading // can be enabled or disabled\n   * @param  {Boolean}  val\n   * @return {Boolean}\n   */\n  Uri.prototype.hasAuthorityPrefix = function(val) {\n    if (typeof val !== 'undefined') {\n      this.hasAuthorityPrefixUserPref = val;\n    }\n\n    if (this.hasAuthorityPrefixUserPref === null) {\n      return (this.uriParts.source.indexOf('//') !== -1);\n    } else {\n      return this.hasAuthorityPrefixUserPref;\n    }\n  };\n\n  Uri.prototype.isColonUri = function (val) {\n    if (typeof val !== 'undefined') {\n      this.uriParts.isColonUri = !!val;\n    } else {\n      return !!this.uriParts.isColonUri;\n    }\n  };\n\n  /**\n   * Serializes the internal state of the query pairs\n   * @param  {string} [val]   set a new query string\n   * @return {string}         query string\n   */\n  Uri.prototype.query = function(val) {\n    var s = '', i, param, l;\n\n    if (typeof val !== 'undefined') {\n      this.queryPairs = parseQuery(val);\n    }\n\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (s.length > 0) {\n        s += '&';\n      }\n      if (param[1] === null) {\n        s += param[0];\n      } else {\n        s += param[0];\n        s += '=';\n        if (typeof param[1] !== 'undefined') {\n          s += encodeURIComponent(param[1]);\n        }\n      }\n    }\n    return s.length > 0 ? '?' + s : s;\n  };\n\n  /**\n   * returns the first query param value found for the key\n   * @param  {string} key query key\n   * @return {string}     first value found for key\n   */\n  Uri.prototype.getQueryParamValue = function (key) {\n    var param, i, l;\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (key === param[0]) {\n        return param[1];\n      }\n    }\n  };\n\n  /**\n   * returns an array of query param values for the key\n   * @param  {string} key query key\n   * @return {array}      array of values\n   */\n  Uri.prototype.getQueryParamValues = function (key) {\n    var arr = [], i, param, l;\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (key === param[0]) {\n        arr.push(param[1]);\n      }\n    }\n    return arr;\n  };\n\n  /**\n   * removes query parameters\n   * @param  {string} key     remove values for key\n   * @param  {val}    [val]   remove a specific value, otherwise removes all\n   * @return {Uri}            returns self for fluent chaining\n   */\n  Uri.prototype.deleteQueryParam = function (key, val) {\n    var arr = [], i, param, keyMatchesFilter, valMatchesFilter, l;\n\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n\n      param = this.queryPairs[i];\n      keyMatchesFilter = decode(param[0]) === decode(key);\n      valMatchesFilter = param[1] === val;\n\n      if ((arguments.length === 1 && !keyMatchesFilter) || (arguments.length === 2 && (!keyMatchesFilter || !valMatchesFilter))) {\n        arr.push(param);\n      }\n    }\n\n    this.queryPairs = arr;\n\n    return this;\n  };\n\n  /**\n   * adds a query parameter\n   * @param  {string}  key        add values for key\n   * @param  {string}  val        value to add\n   * @param  {integer} [index]    specific index to add the value at\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.addQueryParam = function (key, val, index) {\n    if (arguments.length === 3 && index !== -1) {\n      index = Math.min(index, this.queryPairs.length);\n      this.queryPairs.splice(index, 0, [key, val]);\n    } else if (arguments.length > 0) {\n      this.queryPairs.push([key, val]);\n    }\n    return this;\n  };\n\n  /**\n   * test for the existence of a query parameter\n   * @param  {string}  key        add values for key\n   * @param  {string}  val        value to add\n   * @param  {integer} [index]    specific index to add the value at\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.hasQueryParam = function (key) {\n    var i, len = this.queryPairs.length;\n    for (i = 0; i < len; i++) {\n      if (this.queryPairs[i][0] == key)\n        return true;\n    }\n    return false;\n  };\n\n  /**\n   * replaces query param values\n   * @param  {string} key         key to replace value for\n   * @param  {string} newVal      new value\n   * @param  {string} [oldVal]    replace only one specific value (otherwise replaces all)\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.replaceQueryParam = function (key, newVal, oldVal) {\n    var index = -1, len = this.queryPairs.length, i, param;\n\n    if (arguments.length === 3) {\n      for (i = 0; i < len; i++) {\n        param = this.queryPairs[i];\n        if (decode(param[0]) === decode(key) && decodeURIComponent(param[1]) === decode(oldVal)) {\n          index = i;\n          break;\n        }\n      }\n      if (index >= 0) {\n        this.deleteQueryParam(key, decode(oldVal)).addQueryParam(key, newVal, index);\n      }\n    } else {\n      for (i = 0; i < len; i++) {\n        param = this.queryPairs[i];\n        if (decode(param[0]) === decode(key)) {\n          index = i;\n          break;\n        }\n      }\n      this.deleteQueryParam(key);\n      this.addQueryParam(key, newVal, index);\n    }\n    return this;\n  };\n\n  /**\n   * Define fluent setter methods (setProtocol, setHasAuthorityPrefix, etc)\n   */\n  ['protocol', 'hasAuthorityPrefix', 'isColonUri', 'userInfo', 'host', 'port', 'path', 'query', 'anchor'].forEach(function(key) {\n    var method = 'set' + key.charAt(0).toUpperCase() + key.slice(1);\n    Uri.prototype[method] = function(val) {\n      this[key](val);\n      return this;\n    };\n  });\n\n  /**\n   * Scheme name, colon and doubleslash, as required\n   * @return {string} http:// or possibly just //\n   */\n  Uri.prototype.scheme = function() {\n    var s = '';\n\n    if (this.protocol()) {\n      s += this.protocol();\n      if (this.protocol().indexOf(':') !== this.protocol().length - 1) {\n        s += ':';\n      }\n      s += '//';\n    } else {\n      if (this.hasAuthorityPrefix() && this.host()) {\n        s += '//';\n      }\n    }\n\n    return s;\n  };\n\n  /**\n   * Same as Mozilla nsIURI.prePath\n   * @return {string} scheme://user:password@host:port\n   * @see  https://developer.mozilla.org/en/nsIURI\n   */\n  Uri.prototype.origin = function() {\n    var s = this.scheme();\n\n    if (this.userInfo() && this.host()) {\n      s += this.userInfo();\n      if (this.userInfo().indexOf('@') !== this.userInfo().length - 1) {\n        s += '@';\n      }\n    }\n\n    if (this.host()) {\n      s += this.host();\n      if (this.port() || (this.path() && this.path().substr(0, 1).match(/[0-9]/))) {\n        s += ':' + this.port();\n      }\n    }\n\n    return s;\n  };\n\n  /**\n   * Adds a trailing slash to the path\n   */\n  Uri.prototype.addTrailingSlash = function() {\n    var path = this.path() || '';\n\n    if (path.substr(-1) !== '/') {\n      this.path(path + '/');\n    }\n\n    return this;\n  };\n\n  /**\n   * Serializes the internal state of the Uri object\n   * @return {string}\n   */\n  Uri.prototype.toString = function() {\n    var path, s = this.origin();\n\n    if (this.isColonUri()) {\n      if (this.path()) {\n        s += ':'+this.path();\n      }\n    } else if (this.path()) {\n      path = this.path();\n      if (!(re.ends_with_slashes.test(s) || re.starts_with_slashes.test(path))) {\n        s += '/';\n      } else {\n        if (s) {\n          s.replace(re.ends_with_slashes, '/');\n        }\n        path = path.replace(re.starts_with_slashes, '/');\n      }\n      s += path;\n    } else {\n      if (this.host() && (this.query().toString() || this.anchor())) {\n        s += '/';\n      }\n    }\n    if (this.query().toString()) {\n      s += this.query().toString();\n    }\n\n    if (this.anchor()) {\n      if (this.anchor().indexOf('#') !== 0) {\n        s += '#';\n      }\n      s += this.anchor();\n    }\n\n    return s;\n  };\n\n  /**\n   * Clone a Uri object\n   * @return {Uri} duplicate copy of the Uri\n   */\n  Uri.prototype.clone = function() {\n    return new Uri(this.toString());\n  };\n\n  /**\n   * export via AMD or CommonJS, otherwise leak a global\n   */\n  if (typeof define === 'function' && define.amd) {\n    define(function() {\n      return Uri;\n    });\n  } else if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = Uri;\n  } else {\n    global.Uri = Uri;\n  }\n}(this));\n","/*! https://mths.be/utf8js v2.0.0 by @mathias */\n;(function(root) {\n\n\t// Detect free variables `exports`\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code,\n\t// and use it as `root`\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar stringFromCharCode = String.fromCharCode;\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2decode(string) {\n\t\tvar output = [];\n\t\tvar counter = 0;\n\t\tvar length = string.length;\n\t\tvar value;\n\t\tvar extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2encode(array) {\n\t\tvar length = array.length;\n\t\tvar index = -1;\n\t\tvar value;\n\t\tvar output = '';\n\t\twhile (++index < length) {\n\t\t\tvalue = array[index];\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t}\n\t\treturn output;\n\t}\n\n\tfunction checkScalarValue(codePoint) {\n\t\tif (codePoint >= 0xD800 && codePoint <= 0xDFFF) {\n\t\t\tthrow Error(\n\t\t\t\t'Lone surrogate U+' + codePoint.toString(16).toUpperCase() +\n\t\t\t\t' is not a scalar value'\n\t\t\t);\n\t\t}\n\t}\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction createByte(codePoint, shift) {\n\t\treturn stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);\n\t}\n\n\tfunction encodeCodePoint(codePoint) {\n\t\tif ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence\n\t\t\treturn stringFromCharCode(codePoint);\n\t\t}\n\t\tvar symbol = '';\n\t\tif ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);\n\t\t}\n\t\telse if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence\n\t\t\tcheckScalarValue(codePoint);\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\telse if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);\n\t\t\tsymbol += createByte(codePoint, 12);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\tsymbol += stringFromCharCode((codePoint & 0x3F) | 0x80);\n\t\treturn symbol;\n\t}\n\n\tfunction utf8encode(string) {\n\t\tvar codePoints = ucs2decode(string);\n\t\tvar length = codePoints.length;\n\t\tvar index = -1;\n\t\tvar codePoint;\n\t\tvar byteString = '';\n\t\twhile (++index < length) {\n\t\t\tcodePoint = codePoints[index];\n\t\t\tbyteString += encodeCodePoint(codePoint);\n\t\t}\n\t\treturn byteString;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction readContinuationByte() {\n\t\tif (byteIndex >= byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tvar continuationByte = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\tif ((continuationByte & 0xC0) == 0x80) {\n\t\t\treturn continuationByte & 0x3F;\n\t\t}\n\n\t\t// If we end up here, it’s not a continuation byte\n\t\tthrow Error('Invalid continuation byte');\n\t}\n\n\tfunction decodeSymbol() {\n\t\tvar byte1;\n\t\tvar byte2;\n\t\tvar byte3;\n\t\tvar byte4;\n\t\tvar codePoint;\n\n\t\tif (byteIndex > byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tif (byteIndex == byteCount) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Read first byte\n\t\tbyte1 = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\t// 1-byte sequence (no continuation bytes)\n\t\tif ((byte1 & 0x80) == 0) {\n\t\t\treturn byte1;\n\t\t}\n\n\t\t// 2-byte sequence\n\t\tif ((byte1 & 0xE0) == 0xC0) {\n\t\t\tvar byte2 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x1F) << 6) | byte2;\n\t\t\tif (codePoint >= 0x80) {\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 3-byte sequence (may include unpaired surrogates)\n\t\tif ((byte1 & 0xF0) == 0xE0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;\n\t\t\tif (codePoint >= 0x0800) {\n\t\t\t\tcheckScalarValue(codePoint);\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 4-byte sequence\n\t\tif ((byte1 & 0xF8) == 0xF0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tbyte4 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 0x12) | (byte2 << 0x0C) |\n\t\t\t\t(byte3 << 0x06) | byte4;\n\t\t\tif (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\t\treturn codePoint;\n\t\t\t}\n\t\t}\n\n\t\tthrow Error('Invalid UTF-8 detected');\n\t}\n\n\tvar byteArray;\n\tvar byteCount;\n\tvar byteIndex;\n\tfunction utf8decode(byteString) {\n\t\tbyteArray = ucs2decode(byteString);\n\t\tbyteCount = byteArray.length;\n\t\tbyteIndex = 0;\n\t\tvar codePoints = [];\n\t\tvar tmp;\n\t\twhile ((tmp = decodeSymbol()) !== false) {\n\t\t\tcodePoints.push(tmp);\n\t\t}\n\t\treturn ucs2encode(codePoints);\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar utf8 = {\n\t\t'version': '2.0.0',\n\t\t'encode': utf8encode,\n\t\t'decode': utf8decode\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn utf8;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = utf8;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tvar object = {};\n\t\t\tvar hasOwnProperty = object.hasOwnProperty;\n\t\t\tfor (var key in utf8) {\n\t\t\t\thasOwnProperty.call(utf8, key) && (freeExports[key] = utf8[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.utf8 = utf8;\n\t}\n\n}(this));\n","import base64 from 'base-64';\nimport utf8 from 'utf8';\n\nexport default {\n  encode: function (string) {\n    return base64.encode(utf8.encode(string));\n  },\n  decode: function (string) {\n    return utf8.decode(base64.decode(string));\n  }\n};","var $;\nif (process.env.ENV === 'host') {\n  $ = require('../host/dollar');\n} else {\n  $ = require('../plugin/dollar');\n}\n\nexport default $;","'use strict';\n/**\n * Common methods for propagating DOM events between host/plugin iframes\n */\n\nvar w = window;\nvar log = (w.AJS && w.AJS.log) || (w.console && w.console.log) || function () {};\n\nconst SUPPORTED_MOUSE_EVENTS = [\n  'click'\n];\n\nconst SUPPORTED_KEYBOARD_EVENTS = [\n  'keydown',\n  'keyup'\n];\n\nconst ALLOWED_KEYCODES = [\n  27 // ESCAPE\n];\n\nexport default  {\n  // Public API\n  bindListeners,\n  receiveEvent,\n\n  // Visible for testing only\n  constructLegacyModifierString,\n  supportedMouseEvents: SUPPORTED_MOUSE_EVENTS,\n  supportedKeyboardEvents: SUPPORTED_KEYBOARD_EVENTS,\n  isAllowedKeyCode,\n  createEvent\n};\n\n/**\n * Bind listeners to the document to propagate events to the rpc endpoint\n *\n * @param {String} channelKey The unique key that identifies the rpc channel the listeners are bound to\n * @param {function} endpoint The rpc endpoint to send events to\n */\nfunction bindListeners(channelKey, endpoint) {\n  SUPPORTED_MOUSE_EVENTS.forEach(function (mouseEvent) {\n    document.addEventListener(mouseEvent, function (e) {\n      if (e.channelKey === channelKey) {\n        return;\n      }\n      endpoint(channelKey, e.type, sanitiseMouseEvent(e));\n    });\n  });\n  SUPPORTED_KEYBOARD_EVENTS.forEach(function (keyboardEvent) {\n    document.addEventListener(keyboardEvent, function (e) {\n      if (e.channelKey === channelKey) {\n        return;\n      }\n      // We don't want to send all keystrokes to addon pages (that would be bad)\n      if (isAllowedKeyCode(e.keyCode)) {\n        endpoint(channelKey, e.type, sanitiseKeyboardEvent(e));\n      }\n    });\n  });\n}\n\n/**\n * Receive a DOM event from the remote and dispatch to this page,\n * unless we have already seen it.\n *\n * @param {String} channelKey The channel identifier\n * @param {String} eventName The event received\n * @param {EventInit} eventData The data to attach to the event\n */\nfunction receiveEvent(channelKey, eventName, eventData) {\n  let event = createEvent(channelKey, eventName, eventData);\n  if (!event) {\n    return;\n  }\n\n  dispatchEvent(event);\n}\n\n/**\n * Return a sanitised data object that can be used to re-create\n * a synthetic click event\n *\n * @param {MouseEvent} mouseEvent The event to sanitise\n * @return {MouseEventInit} Sanitised data suitable for sending between iframes\n */\nfunction sanitiseMouseEvent(mouseEvent) {\n  return {\n    bubbles: true,\n    cancelable: true,\n    button: mouseEvent.button,\n    ctrlKey: mouseEvent.ctrlKey,\n    shiftKey: mouseEvent.shiftKey,\n    altKey: mouseEvent.altKey,\n    metaKey: mouseEvent.metaKey\n  };\n}\n\n/**\n * Return a sanitised data object that can be used to\n * re-create a synthetic keyboard event.\n *\n * @param {KeyboardEvent} keyboardEvent The event to sanitise\n * @return {KeyboardEventInit} Sanities data suitable for sending between iframes\n */\nfunction sanitiseKeyboardEvent(keyboardEvent) {\n  return {\n    bubbles: true,\n    cancelable: true,\n    key: keyboardEvent.key,\n    code: keyboardEvent.code,\n    keyCode: keyboardEvent.keyCode,\n    ctrlKey: keyboardEvent.ctrlKey,\n    shiftKey: keyboardEvent.shiftKey,\n    altKey: keyboardEvent.altKey,\n    metaKey: keyboardEvent.metaKey,\n    locale: null\n  };\n}\n\n/**\n * Create a synthetic DOM event using the provided data\n *\n * The returned event will include a param <code>channelKey</code> that can be\n * used to identify which channel the event was received on.\n *\n * @param {String} channelKey The key for the channel the event was received on\n * @param {String} eventName The name of the event to create\n * @param {KeyboardEventInit|MouseEventInit} eventData The data to create the event with\n *\n * @returns {KeyboardEvent|MouseEvent} The constructed synthetic event\n */\nfunction createEvent(channelKey, eventName, eventData) {\n  eventData.view = window;\n\n  let event;\n  if (SUPPORTED_MOUSE_EVENTS.indexOf(eventName) > -1) {\n    if (typeof window.Event === 'function') {\n      event = new MouseEvent(eventName, eventData);\n    }\n    else {\n      // To support older browsers\n      // (e.g. IE - https://msdn.microsoft.com/en-us/library/dn905219%28v=vs.85%29.aspx)\n      event = document.createEvent('MouseEvent');\n      event.initMouseEvent(eventName,\n          eventData.bubbles, eventData.cancelable, eventData.view,\n          0, 0, 0, 0, 0,\n          eventData.ctrlKey, eventData.altKey, eventData.shiftKey,\n          eventData.metaKey, eventData.button, null);\n    }\n  }\n  else if (SUPPORTED_KEYBOARD_EVENTS.indexOf(eventName) > -1) {\n    if (typeof window.Event === 'function') {\n      event = new KeyboardEvent(eventName, eventData);\n    }\n    else {\n      // To support older browsers\n      // (e.g. IE - https://msdn.microsoft.com/en-us/library/dn905219%28v=vs.85%29.aspx)\n      event = document.createEvent('KeyboardEvent');\n      event.initKeyboardEvent(eventName,\n          eventData.bubbles, eventData.cancelable, eventData.view,\n          eventData.key, 0, constructLegacyModifierString(eventData),\n          false, eventData.locale);\n    }\n  }\n  else {\n    log('Event ' + eventName + ' not supported');\n  }\n\n  if (event) {\n    event.channelKey = channelKey;\n  }\n  return event;\n}\n\n/**\n * Dispatch the given event to the current document\n *\n * Includes some AUI-specific dispatch if AUI is detected to ensure dialogs work correctly etc.\n *\n * @param event The event to dispatch\n */\nfunction dispatchEvent(event) {\n  document.body.dispatchEvent(event);\n\n  if (AJS && event.type === 'click') {\n    // If AJS is present we should fire the event on dialog curtains\n    // if they exist, to ensure AUI dialogs etc. are dismissed.\n    var blanket = AJS.$('.aui-blanket');\n    if (blanket.length > 0 && blanket[0]) {\n      blanket[0].dispatchEvent(event);\n    }\n  }\n}\n\n/**\n * Construct the legacy DOM L3 key modifier string required for pre-L4 keyboard event initialisation\n * @see https://msdn.microsoft.com/en-us/library/ff975297%28v=vs.85%29.aspx\n *\n * @param {KeyboardEventInit} eventData The data to create the modifier string from\n * @returns {String} The modifier string (e.g. \"Ctr,Shift\")\n */\nfunction constructLegacyModifierString(eventData) {\n  let result = [];\n  if (eventData.shiftKey) {\n    result.push('Shift');\n  }\n  if (eventData.ctrlKey) {\n    result.push('Ctrl');\n  }\n  if (eventData.metaKey) {\n    result.push('Meta');\n  }\n  if (eventData.altKey) {\n    result.push('Alt');\n  }\n  return result.join(',');\n}\n\n/**\n * Determine if the provided keycode is allowed to be propagated between iframes\n *\n * @param {Number} keyCode The keycode to test\n *\n * @returns {boolean} Whether the provided keycode is allowed to be propagated between iframes\n */\nfunction isAllowedKeyCode(keyCode) {\n  return ALLOWED_KEYCODES.indexOf(keyCode) > -1;\n}","import $ from './dollar';\n\nvar w = window;\nvar log = (w.AJS && w.AJS.log) || (w.console && w.console.log) || (function () {});\n\n/**\n * A simple pub/sub event bus capable of running on either side of the XDM bridge with no external\n * JS lib dependencies.\n *\n * @param {String} key The key of the event source\n * @param {String} origin The origin of the event source\n * @constructor\n */\nfunction Events(key, origin) {\n  this._key = key;\n  this._origin = origin;\n  this._events = {};\n  this._any = [];\n}\n\nvar proto = Events.prototype;\n\n/**\n * Subscribes a callback to an event name.\n *\n * @param {String} name The event name to subscribe the listener to\n * @param {Function} listener A listener callback to subscribe to the event name\n * @returns {Events} This Events instance\n */\nproto.on = function (name, listener) {\n  if (name && listener) {\n    this._listeners(name).push(listener);\n  }\n  return this;\n};\n\n/**\n * Subscribes a callback to an event name, removing the it once fired.\n *\n * @param {String} name The event name to subscribe the listener to\n * @param {Function}listener A listener callback to subscribe to the event name\n * @returns {Events} This Events instance\n */\nproto.once = function (name, listener) {\n  var self = this;\n  var interceptor = function () {\n    self.off(name, interceptor);\n    listener.apply(null, arguments);\n  };\n  this.on(name, interceptor);\n  return this;\n};\n\n/**\n * Subscribes a callback to all events, regardless of name.\n *\n * @param {Function} listener A listener callback to subscribe for any event name\n * @returns {Events} This Events instance\n */\nproto.onAny = function (listener) {\n  this._any.push(listener);\n  return this;\n};\n\n/**\n * Unsubscribes a callback to an event name.\n *\n * @param {String} name The event name to unsubscribe the listener from\n * @param {Function} listener The listener callback to unsubscribe from the event name\n * @returns {Events} This Events instance\n */\nproto.off = function (name, listener) {\n  var all = this._events[name];\n  if (all) {\n    var i = $.inArray(listener, all);\n    if (i >= 0) {\n      all.splice(i, 1);\n    }\n    if (all.length === 0) {\n      delete this._events[name];\n    }\n  }\n  return this;\n};\n\n/**\n * Unsubscribes all callbacks from an event name, or unsubscribes all event-name-specific listeners\n * if no name if given.\n *\n * @param {String} [name] The event name to unsubscribe all listeners from\n * @returns {Events} This Events instance\n */\nproto.offAll = function (name) {\n  if (name) {\n    delete this._events[name];\n  } else {\n    this._events = {};\n  }\n  return this;\n};\n\n/**\n * Unsubscribes a callback from the set of 'any' event listeners.\n *\n * @param {Function} listener A listener callback to unsubscribe from any event name\n * @returns {Events} This Events instance\n */\nproto.offAny = function (listener) {\n  var any = this._any;\n  var i = $.inArray(listener, any);\n  if (i >= 0) {\n    any.splice(i, 1);\n  }\n  return this;\n};\n\n/**\n * Emits an event on this bus, firing listeners by name as well as all 'any' listeners. Arguments following the\n * name parameter are captured and passed to listeners.  The last argument received by all listeners after the\n * unpacked arguments array will be the fired event object itself, which can be useful for reacting to event\n * metadata (e.g. the bus's namespace).\n *\n * @param {String} name The name of event to emit\n * @param {Array.<String>} args 0 or more additional data arguments to deliver with the event\n * @returns {Events} This Events instance\n */\nproto.emit = function (name) {\n  return this._emitEvent(this._event.apply(this, arguments));\n};\n\n/**\n * Creates an opaque event object from an argument list containing at least a name, and optionally additional\n * event payload arguments.\n *\n * @param {String} name The name of event to emit\n * @param {Array.<String>} args 0 or more additional data arguments to deliver with the event\n * @returns {Object} A new event object\n * @private\n */\nproto._event = function (name) {\n  return {\n    name: name,\n    args: [].slice.call(arguments, 1),\n    attrs: {},\n    source: {\n      key: this._key,\n      origin: this._origin\n    }\n  };\n};\n\n/**\n * Emits a previously-constructed event object to all listeners.\n *\n * @param {Object} event The event object to emit\n * @param {String} event.name The name of the event\n * @param {Object} event.source Metadata about the original source of the event, containing key and origin\n * @param {Array} event.args The args passed to emit, to be delivered to listeners\n * @returns {Events} This Events instance\n * @private\n */\nproto._emitEvent = function (event) {\n  var args = event.args.concat(event);\n  fire(this._listeners(event.name), args);\n  fire(this._any, [event.name].concat(args));\n  return this;\n};\n\n/**\n * Returns an array of listeners by event name, creating a new name array if none are found.\n *\n * @param {String} name The event name for which listeners should be returned\n * @returns {Array} An array of listeners; empty if none are registered\n * @private\n */\nproto._listeners = function (name) {\n  return this._events[name] = this._events[name] || [];\n};\n\n// Internal helper for firing an event to an array of listeners\nfunction fire(listeners, args) {\n  for (var i = 0; i < listeners.length; ++i) {\n    try {\n      listeners[i].apply(null, args);\n    } catch (e) {\n      log(e.stack || e.message || e);\n    }\n  }\n}\n\nexport default {Events: Events}","import base64 from './base64';\n\nfunction parseJwtIssuer(jwt) {\n  return parseJwtClaims(jwt)['iss'];\n}\n\nfunction parseJwtClaims(jwt) {\n\n  if (null === jwt || '' === jwt) {\n    throw('Invalid JWT: must be neither null nor empty-string.');\n  }\n\n  var firstPeriodIndex = jwt.indexOf('.');\n  var secondPeriodIndex = jwt.indexOf('.', firstPeriodIndex + 1);\n\n  if (firstPeriodIndex < 0 || secondPeriodIndex <= firstPeriodIndex) {\n    throw('Invalid JWT: must contain 2 period (\".\") characters.');\n  }\n\n  var encodedClaims = jwt.substring(firstPeriodIndex + 1, secondPeriodIndex);\n\n  if (null === encodedClaims || '' === encodedClaims) {\n    throw('Invalid JWT: encoded claims must be neither null nor empty-string.');\n  }\n\n  var claimsString = base64.decode.call(window, encodedClaims);\n  return JSON.parse(claimsString);\n}\n\nfunction isJwtExpired(jwtString, skew) {\n  if (skew === undefined) {\n    skew = 60; // give a minute of leeway to allow clock skew\n  }\n  var claims = parseJwtClaims(jwtString);\n  var expires = 0;\n  var now = Math.floor(Date.now() / 1000); // UTC timestamp now\n\n  if (claims && claims.exp) {\n    expires = claims.exp;\n  }\n\n  if ((expires - now) < skew) {\n    return true;\n  }\n\n  return false;\n\n}\n\n\nexport default {\n  parseJwtIssuer,\n  parseJwtClaims,\n  isJwtExpired\n}","import base64 from './base64';\nimport uri from './uri';\n/**\n * These are passed into the main host create statement and can override\n * any options inside the velocity template.\n * Additionally these are accessed by the js inside the client iframe to check if we are in a dialog.\n */\n\nexport default {\n  /**\n   * Encode options for transport\n   */\n  encode: function (options) {\n    if (options) {\n      var str = JSON.stringify(options);\n      return base64.encode.call(window, str);\n    }\n  },\n  /**\n   * return ui params from a Url\n   **/\n  fromUrl: function (url) {\n    var params = new uri.init(url).getQueryParamValue('ui-params');\n    return this.decode(params);\n  },\n  /**\n   * returns ui params from window.name\n   */\n  fromWindowName: function (w, param) {\n    w = w || window;\n    var decoded = this.decode(w.name);\n\n    if (!param) {\n      return decoded;\n    }\n    return (decoded) ? decoded[param] : undefined;\n  },\n  /**\n   * Decode a base64 encoded json string containing ui params\n   */\n  decode: function (params) {\n    var obj = {};\n    if (params && params.length > 0) {\n      try {\n        obj = JSON.parse(base64.decode.call(window, params));\n      } catch (e) {\n        if (console && console.log) {\n          console.log('Cannot decode passed ui params', params);\n        }\n      }\n    }\n    return obj;\n  }\n};","import Uri from 'jsuri';\n\nexport default {init: Uri}","import events from './events';\nimport jwt from './jwt';\nimport uri from './uri';\nimport uiParams from './ui-params';\n\n// Capture some common values and symbol aliases\nvar count = 0;\n\n/**\n * Sets up cross-iframe remote procedure calls.\n * If this is called from a parent window, iframe is created and an RPC interface for communicating with it is set up.\n * If this is called from within the iframe, an RPC interface for communicating with the parent is set up.\n *\n * Calling a remote function is done with the signature:\n *     fn(data..., doneCallback, failCallback)\n * doneCallback is called after the remote function executed successfully.\n * failCallback is called after the remote function throws an exception.\n * doneCallback and failCallback are optional.\n *\n * @param {Object} $ jquery or jquery-like utility\n * @param {Object} config Configuration parameters\n * @param {String} config.remoteKey The remote peer's add-on key (host only)\n * @param {String} config.remote The src of remote iframe (host only)\n * @param {String} config.container The id of element to which the generated iframe is appended (host only)\n * @param {Object} config.props Additional attributes to add to iframe element (host only)\n * @param {String} config.channel Channel (host only); deprecated\n * @param {Object} bindings RPC method stubs and implementations\n * @param {Object} bindings.local Local function implementations - functions that exist in the current context.\n *    XdmRpc exposes these functions so that they can be invoked by code running in the other side of the iframe.\n * @param {Array} bindings.remote Names of functions which exist on the other side of the iframe.\n *    XdmRpc creates stubs to these functions that can be invoked from the current page.\n * @returns XdmRpc instance\n * @constructor\n */\nfunction XdmRpc($, config, bindings) {\n\n  var self;\n  var id;\n  var target;\n  var remoteOrigin;\n  var channel;\n  var mixin;\n  var localKey;\n  var remoteKey;\n  var addonKey;\n  var w = window;\n  var loc = w.location.toString();\n  var locals = bindings.local || {};\n  var remotes = bindings.remote || [];\n  var localOrigin = getBaseUrl(loc);\n\n  // A hub through which all async callbacks for remote requests are parked until invoked from a response\n  var nexus = function () {\n    var callbacks = {};\n    return {\n      // Registers a callback of a given type by uid\n      add: function (uid, done, fail) {\n        callbacks[uid] = {\n          done: done || null,\n          fail: fail || null,\n          async: !!done\n        };\n      },\n      // Invokes callbacks for a response of a given type by uid if registered, then removes all handlers for the uid\n      invoke: function (type, uid, arg) {\n        var handled;\n        if (callbacks[uid]) {\n          if (callbacks[uid][type]) {\n            // If the intended callback exists, invoke it and mark the response as handled\n            callbacks[uid][type](arg);\n            handled = true;\n          } else {\n            // Only mark other calls as handled if they weren't expecting a callback and didn't fail\n            handled = !callbacks[uid].async && type !== 'fail';\n          }\n          delete callbacks[uid];\n        }\n        return handled;\n      }\n    };\n  }();\n\n  // Use the config and enviroment to construct the core of the new XdmRpc instance.\n  //\n  // Note: The xdm_e|c|p variables that appear in an iframe URL are used to pass message to the XdmRpc bridge\n  // when running inside an add-on iframe.  Their names are holdovers from easyXDM, which was used prior\n  // to building this proprietary library (which was done both to greatly reduce the total amount of JS\n  // needed to drive the postMessage-based RPC communication, and to allow us to extend its capabilities).\n  //\n  // AC-451 describes how we can reduce/improve these (and other) iframe url parameters, but until that is\n  // addressed, here's a brief description of each:\n  //\n  //  - xdm_e contains the base url of the host app; it's presence indicates that the XdmRpc is running in\n  //    an add-on iframe\n  //  - xdm_c contains a unique channel name; this is a holdover from easyXDM that was used to distinguish\n  //    postMessage events between multiple iframes with identical xdm_e values, though this may now be\n  //    redundant with the current internal implementation of the XdmRpc and should be considered for removal\n  if (!/xdm_e/.test(loc)) {\n    // Host-side constructor branch\n\n    // if there is already an iframe created. Destroy it. It's an old version.\n\n    $(document.getElementById(config.container)).find('iframe').trigger('ra.iframe.destroy');\n\n    var iframe = createIframe(config);\n    target = iframe.contentWindow;\n    localKey = param(config.remote, 'oauth_consumer_key') || param(config.remote, 'jwt');\n    remoteKey = config.remoteKey;\n    addonKey = remoteKey;\n    remoteOrigin = getBaseUrl(config.remote).toLowerCase();\n    channel = config.channel;\n    // Define the host-side mixin\n    mixin = {\n      isHost: true,\n      iframe: iframe,\n      uiParams: config.uiParams,\n      destroy: function () {\n        window.clearTimeout(self.timeout); //clear the iframe load time.\n        // Unbind postMessage handler when destroyed\n        unbind();\n        // Then remove the iframe, if it still exists\n        if (self.iframe) {\n          $(self.iframe).remove();\n          delete self.iframe;\n        }\n      },\n      isActive: function () {\n        // Host-side instances are only active as long as the iframe they communicate with still exists in the DOM\n        return $.contains(document.documentElement, self.iframe);\n      }\n    };\n    $(iframe).on('ra.iframe.destroy', mixin.destroy);\n  } else {\n    // Add-on-side constructor branch\n    target = w.parent;\n    localKey = 'local'; // Would be better to make this the add-on key, but it's not readily available at this time\n\n    // identify the add-on by unique key: first try JWT issuer claim and fall back to OAuth1 consumer key\n    var jwtParam = param(loc, 'jwt');\n    remoteKey = jwtParam ? jwt.parseJwtIssuer(jwtParam) : param(loc, 'oauth_consumer_key');\n\n    // if the authentication method is 'none' then it is valid to have no jwt and no oauth in the url\n    // but equally we don't trust this iframe as far as we can throw it, so assign it a random id\n    // in order to prevent it from talking to any other iframe\n    if (null === remoteKey) {\n      remoteKey = Math.random(); // unpredictable and unsecured, like an oauth consumer key\n    }\n\n    addonKey = localKey;\n    remoteOrigin = param(loc, 'xdm_e').toLowerCase();\n    channel = param(loc, 'xdm_c');\n    // Define the add-on-side mixin\n    mixin = {\n      isHost: false,\n      isActive: function () {\n        // Add-on-side instances are always active, as they must always have a parent window peer\n        return true;\n      }\n    };\n  }\n\n  id = addonKey + '|' + (count += 1);\n\n  // Create the actual XdmRpc instance, and apply the context-sensitive mixin\n  self = $.extend({\n    id: id,\n    remoteOrigin: remoteOrigin,\n    channel: channel,\n    addonKey: addonKey\n  }, mixin);\n\n  // Sends a message of a specific type to the remote peer via a post-message event\n  function send(sid, type, message) {\n    try {\n      target.postMessage(JSON.stringify({\n        c: channel,\n        i: sid,\n        t: type,\n        m: message\n      }), remoteOrigin);\n    } catch (ex) {\n      log(errmsg(ex));\n    }\n  }\n\n  // Sends a request with a specific remote method name, args, and optional callbacks\n  function sendRequest(methodName, args, done, fail) {\n    // Generate a random ID for this remote invocation\n    var sid = Math.floor(Math.random() * 1000000000).toString(16);\n    // Register any callbacks with the nexus so they can be invoked when a response is received\n    nexus.add(sid, done, fail);\n    // Send a request to the remote, where:\n    //  - n is the name of the remote function\n    //  - a is an array of the (hopefully) serializable, non-callback arguments to this method\n    send(sid, 'request', {n: methodName, a: args});\n  }\n\n  function sendDone(sid, message) {\n    send(sid, 'done', message);\n  }\n\n  function sendFail(sid, message) {\n    send(sid, 'fail', message);\n  }\n\n  // Handles an normalized, incoming post-message event\n  function receive(e) {\n    try {\n      // Extract message payload from the event\n      var payload = JSON.parse(e.data);\n      var pid = payload.i;\n      var pchannel = payload.c;\n      var ptype = payload.t;\n      var pmessage = payload.m;\n\n      // if the iframe has potentially been reloaded. re-attach the source contentWindow object\n      if (e.source !== target && e.origin.toLowerCase() === remoteOrigin && pchannel === channel) {\n        target = e.source;\n      }\n\n      // If the payload doesn't match our expected event signature, assume its not part of the xdm-rpc protocol\n      if (e.source !== target || e.origin.toLowerCase() !== remoteOrigin || pchannel !== channel) {\n        return;\n      }\n\n      if (ptype === 'request') {\n        // If the payload type is request, this is an incoming method invocation\n        var name = pmessage.n;\n        var args = pmessage.a;\n        var local = locals[name];\n        var done;\n        var fail;\n        var async;\n        if (local) {\n          // The message name matches a locally defined RPC method, so inspect and invoke it according\n          // Create responders for each response type\n          done = function (message) {\n            sendDone(pid, message);\n          };\n          fail = function (message) {\n            sendFail(pid, message);\n          };\n          // The local method is considered async if it accepts more arguments than the message has sent;\n          // the additional arguments are filled in with the above async responder callbacks;\n          // TODO: consider specifying args somehow in the remote stubs so that non-callback args can be\n          //       verified before sending a request to fail fast at the callsite\n          async = (args ? args.length : 0) < local.length;\n          var context = locals;\n          if (self.isHost === true) {\n            context = self;\n            if (context.analytics) {\n              context.analytics.trackBridgeMethod(name);\n            }\n          } else {\n            context.isHost = false;\n          }\n          try {\n            if (async) {\n              // If async, apply the method with the responders added to the args list\n              local.apply(context, args.concat([done, fail]));\n            } else {\n              // Otherwise, immediately respond with the result\n              done(local.apply(context, args));\n            }\n          } catch (ex) {\n            // If the invocation threw an error, invoke the fail responder callback with it\n            fail(errmsg(ex));\n            logError(ex);\n          }\n        } else {\n          // No such local rpc method name found\n          debug('Unhandled request:', payload);\n        }\n      } else if (ptype === 'done' || ptype === 'fail') {\n        // The payload is of a response type, so try to invoke the appropriate callback via the nexus registry\n        if (!nexus.invoke(ptype, pid, pmessage)) {\n          // The nexus didn't find an appropriate reponse callback to invoke\n          debug('Unhandled response:', ptype, pid, pmessage);\n        }\n      }\n    } catch (ex) {\n      log(errmsg(ex));\n    }\n  }\n\n  // Creates a bridging invocation function for a remote method\n  function bridge(methodName) {\n    // Add a method to this instance that will convert from 'rpc.method(args..., done?, fail?)'-style\n    // invocations to a postMessage event via the 'send' function\n    return function () {\n      var args = [].slice.call(arguments);\n      var done;\n      var fail;\n      // Pops the last arg off the args list if it's a function\n      function popFn() {\n        if ($.isFunction(args[args.length - 1])) {\n          return args.pop();\n        }\n      }\n      // Remove done/fail callbacks from the args list\n      fail = popFn();\n      done = popFn();\n      if (!done) {\n        // Set the done cb to the value of the fail cb if only one callback fn was given\n        done = fail;\n        fail = undefined;\n      }\n      sendRequest(methodName, args, done, fail);\n    };\n  }\n\n  // For each remote method, generate a like-named interceptor on this instance that converts invocations to\n  // post-message request events, tracking async callbacks as necessary.\n  $.each(remotes, function (methodName, v) {\n    // If remotes were specified as an array rather than a map, promote v to methodName\n    if (typeof methodName === 'number') {\n      methodName = v;\n    }\n    self[methodName] = bridge(methodName);\n  });\n\n  // Create and attach a local event emitter for bridged pub/sub\n  var bus = self.events = new events.Events(localKey, localOrigin);\n  // Attach an any-listener to forward all locally-originating events to the remote peer\n  bus.onAny(function () {\n    // The actual event object is the last argument passed to any listener\n    var event = arguments[arguments.length - 1];\n    var trace = event.trace = event.trace || {};\n    var traceKey = self.id + '|xdm';\n    if ((self.isHost && !trace[traceKey] && event.source.channel !== self.id)\n        || (!self.isHost && event.source.key === localKey)) {\n      // Only forward an event once in this listener\n      trace[traceKey] = true;\n      // Clone the event and forward without tracing info, to avoid leaking host-side iframe topology to add-ons\n      event = $.extend({}, event);\n      delete event.trace;\n      debug('Forwarding ' + (self.isHost ? 'host' : 'addon') + ' event:', event);\n      sendRequest('_event', [event]);\n    }\n  });\n  // Define our own reserved local to receive remote events\n  locals._event = function (event) {\n    // Reset/ignore any tracing info that may have come across the bridge\n    delete event.trace;\n    if (this.isHost) {\n      // When the running on the host-side, forcibly reset the event's key and origin fields, to prevent spoofing by\n      // untrusted add-ons; also include the host-side XdmRpc instance id to tag the event with this particular\n      // instance of the host/add-on relationship\n      event.source = {\n        channel: this.id || id, // Note: the term channel here != the deprecated xdm channel param\n        key: this.addonKey,\n        origin: this.remoteOrigin || remoteOrigin\n      };\n    }\n    debug('Receiving as ' + (this.isHost ? 'host' : 'addon') + ' event:', event);\n    // Emit the event on the local bus\n    bus._emitEvent(event);\n  };\n\n  // Handles incoming postMessages from this XdmRpc instance's remote peer\n  function postMessageHandler(e) {\n    if (self.isActive()) {\n      // Normalize and forward the event message to the receiver logic\n      receive(e.originalEvent ? e.originalEvent : e);\n    } else {\n      // If inactive (due to the iframe element having disappeared from the DOM), force cleanup of this callback\n      unbind();\n    }\n  }\n\n  // Starts listening for window messaging events\n  function bind() {\n    $(window).bind('message', postMessageHandler);\n  }\n\n  // Stops listening for window messaging events\n  function unbind() {\n    $(window).unbind('message', postMessageHandler);\n  }\n\n  // Crudely extracts a query param value from a url by name\n  function param(url, name) {\n    return new uri.init(url).getQueryParamValue(name);\n  }\n\n  // Determines a base url consisting of protocol+domain+port from a given url string\n  function getBaseUrl(url) {\n    return new uri.init(url).origin();\n  }\n\n  // Appends a map of query parameters to a base url\n  function toUrl(base, params) {\n    var url = new uri.init(base);\n    $.each(params, function (k, v) {\n      url.addQueryParam(k, v);\n    });\n    return url.toString();\n  }\n\n  // Creates an iframe element from a config option consisting of the following values:\n  //  - container:  the parent element of the new iframe\n  //  - remote:     the src url of the new iframe\n  //  - props:      a map of additional HTML attributes for the new iframe\n  //  - channel:    deprecated\n  function createIframe(config) {\n    if (!config.container) {\n      throw new Error('config.container must be defined');\n    }\n    var iframe = document.createElement('iframe');\n    var id = 'easyXDM_' + config.container + '_provider';\n    var windowName = '';\n\n    if (config.uiParams) {\n      windowName = uiParams.encode(config.uiParams);\n    }\n    $.extend(iframe, {id: id, name: windowName, frameBorder: '0'}, config.props);\n    //$.extend will not add the attribute rel.\n    iframe.setAttribute('rel', 'nofollow');\n    $(document.getElementById(config.container)).append(iframe);\n    $(iframe).trigger('ra.iframe.create');\n    iframe.src = config.remote;\n    return iframe;\n  }\n\n  function errmsg(ex) {\n    return ex.message || ex.toString();\n  }\n\n  function debug() {\n    if (XdmRpc.debug) {\n      log.apply(w, ['DEBUG:'].concat([].slice.call(arguments)));\n    }\n  }\n\n  function log() {\n    var log = $.log || (w.AJS && w.AJS.log);\n    if (log) {\n      log.apply(w, arguments);\n    }\n  }\n\n  function logError() {\n    // $.error seems to do the same thing as $.log in client console\n    var error = (w.AJS && w.AJS.error);\n    if (error) {\n      error.apply(w, arguments);\n    }\n  }\n\n  // Immediately start listening for events\n  bind();\n\n  return self;\n}\n\n//  XdmRpc.debug = true;\n\nexport default XdmRpc;\n\n","import $ from './dollar';\nimport rpc from './rpc';\n\n// Note that if it's desireable to publish host-level events to add-ons, this would be a good place to wire\n// up host listeners and publish to each add-on, rather than using each XdmRpc.events object directly.\n\nvar _channels = {};\n\n// Tracks all channels (iframes with an XDM bridge) for a given add-on key, managing event propagation\n// between bridges, and potentially between add-ons.\n\nexport default function () {\n  var self = {\n    _emitEvent(event) {\n      $.each(_channels[event.source.key], function (id, channel) {\n        channel.bus._emitEvent(event);\n      });\n    },\n    remove(xdm) {\n      var channel = _channels[xdm.addonKey][xdm.id];\n      if (channel) {\n        channel.bus.offAny(channel.listener);\n      }\n      delete _channels[xdm.addonKey][xdm.id];\n      return this;\n    },\n    init(config, xdm) {\n      if (!_channels[xdm.addonKey]) {\n        _channels[xdm.addonKey] = {};\n      }\n      var channel = _channels[xdm.addonKey][xdm.id] = {\n        bus: xdm.events,\n        listener() {\n          var event = arguments[arguments.length - 1];\n          var trace = event.trace = event.trace || {};\n          var traceKey = xdm.id + '|addon';\n          if (!trace[traceKey]) {\n            // Only forward an event once in this listener\n            trace[traceKey] = true;\n            self._emitEvent(event);\n          }\n        }\n      };\n      channel.bus.onAny(channel.listener); //forward add-on events.\n\n      // Remove reference to destroyed iframes such as closed dialogs.\n      channel.bus.on('ra.iframe.destroy', function () {\n        self.remove(xdm);\n      });\n    }\n  };\n  return self;\n}","import $ from './dollar';\n/**\n * Blacklist certain bridge functions from being sent to analytics\n * @const\n * @type {Array}\n */\nvar BRIDGEMETHODBLACKLIST = [\n  'resize',\n  'init'\n];\n\n/**\n * Timings beyond 20 seconds (connect's load timeout) will be clipped to an X.\n * @const\n * @type {int}\n */\nvar THRESHOLD = 20000;\n\n/**\n * Trim extra zeros from the load time.\n * @const\n * @type {int}\n */\nvar TRIMPPRECISION = 100;\n\nfunction time() {\n  return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();\n}\n\nfunction Analytics(addonKey, moduleKey) {\n  var metrics = {};\n  this.addonKey = addonKey;\n  this.moduleKey = moduleKey;\n  this.iframePerformance = {\n    start: function () {\n      metrics.startLoading = time();\n    },\n    end: function () {\n      var value = time() - metrics.startLoading;\n      proto.track('iframe.performance.load', {\n        addonKey: addonKey,\n        moduleKey: moduleKey,\n        value: value > THRESHOLD ? 'x' : Math.ceil((value) / TRIMPPRECISION)\n      });\n      delete metrics.startLoading;\n    },\n    timeout: function () {\n      proto.track('iframe.performance.timeout', {\n        addonKey: addonKey,\n        moduleKey: moduleKey\n      });\n      //track an end event during a timeout so we always have complete start / end data.\n      this.end();\n    },\n    // User clicked cancel button during loading\n    cancel: function () {\n      proto.track('iframe.performance.cancel', {\n        addonKey: addonKey,\n        moduleKey: moduleKey\n      });\n    }\n  };\n\n}\n\nvar proto = Analytics.prototype;\n\nproto.getKey = function () {\n  return this.addonKey + ':' + this.moduleKey;\n};\n\nproto.track = function (name, data) {\n  var prefixedName = 'connect.addon.' + name;\n  if (AJS.Analytics) {\n    AJS.Analytics.triggerPrivacyPolicySafeEvent(prefixedName, data);\n  } else if (AJS.trigger) {\n    // BTF fallback\n    AJS.trigger('analyticsEvent', {\n      name: prefixedName,\n      data: data\n    });\n  } else {\n    return false;\n  }\n\n  return true;\n};\n\nproto.trackBridgeMethod = function (name) {\n  if ($.inArray(name, BRIDGEMETHODBLACKLIST) !== -1) {\n    return false;\n  }\n  this.track('bridge.invokemethod', {\n    name: name,\n    addonKey: this.addonKey,\n    moduleKey: this.moduleKey\n  });\n};\n\nexport default {\n  get(addonKey, moduleKey) {\n    return new Analytics(addonKey, moduleKey);\n  }\n}","import $ from './dollar';\nimport uri from '../common/uri';\n\n/**\n * Utility methods for rendering connect addons in AUI components\n */\n\nfunction getWebItemPluginKey(target) {\n  var cssClass = target.attr('class');\n  var m = cssClass ? cssClass.match(/ap-plugin-key-([^\\s]*)/) : null;\n  return $.isArray(m) ? m[1] : false;\n}\nfunction getWebItemModuleKey(target) {\n  var cssClass = target.attr('class');\n  var m = cssClass ? cssClass.match(/ap-module-key-([^\\s]*)/) : null;\n  return $.isArray(m) ? m[1] : false;\n}\n\nfunction getOptionsForWebItem(target) {\n  var moduleKey = getWebItemModuleKey(target);\n  var type = target.hasClass('ap-inline-dialog') ? 'inlineDialog' : 'dialog';\n  return window._AP[type + 'Options'][moduleKey] || {};\n}\n\nfunction contextFromUrl(url) {\n  var pairs = new uri.init(url).queryPairs;\n  var obj = {};\n  $.each(pairs, function (key, value) {\n    obj[value[0]] = value[1];\n  });\n  return obj;\n}\n\nfunction eventHandler(action, selector, callback) {\n\n  function domEventHandler(event) {\n    event.preventDefault();\n    var $el = $(event.target).closest(selector);\n    var href = $el.attr('href');\n    var url = new uri.init(href);\n    var options = {\n      bindTo: $el,\n      header: $el.text(),\n      width: url.getQueryParamValue('width'),\n      height: url.getQueryParamValue('height'),\n      cp: url.getQueryParamValue('cp'),\n      key: getWebItemPluginKey($el),\n      productContext: contextFromUrl(href)\n    };\n    callback(href, options, event.type);\n  }\n\n  $(window.document).on(action, selector, domEventHandler);\n\n}\n\nexport default {\n  eventHandler,\n  getOptionsForWebItem,\n  getWebItemPluginKey,\n  getWebItemModuleKey\n}","import $ from './dollar';\nimport analytics from './analytics';\nimport rpc from './rpc';\nimport uiParams from '../common/ui-params';\nimport util from './util';\n\nvar defer = window.requestAnimationFrame || function (f) {\n  setTimeout(f,10);\n};\n\nfunction contentDiv(ns) {\n  if (!ns) {\n    throw new Error('ns undefined');\n  }\n  return $(document.getElementById('embedded-' + ns));\n}\n\n/**\n * @name Options\n * @class\n * @property {String}  ns            module key\n * @property {String}  src           url of the iframe\n * @property {String}  w             width of the iframe\n * @property {String}  h             height of the iframe\n * @property {String}  dlg           is a dialog (disables the resizer)\n * @property {String}  simpleDlg     deprecated, looks to be set when a confluence macro editor is being rendered as a dialog\n * @property {Boolean} general       is a page that can be resized\n * @property {String}  productCtx    context to pass back to the server (project id, space id, etc)\n * @property {String}  key           addon key from the descriptor\n * @property {String}  uid           id of the current user\n * @property {String}  ukey          user key\n * @property {String}  data.timeZone timezone of the current user\n * @property {String}  cp            context path\n */\n\n/**\n * @param {Options} options These values come from the velocity template and can be overridden using uiParams\n */\nfunction create(options) {\n  if (typeof options.uiParams !== 'object') {\n    options.uiParams = uiParams.fromUrl(options.src);\n  }\n\n  var ns = options.ns;\n  var contentId = 'embedded-' + ns;\n  var channelId = 'channel-' + ns;\n  var initWidth = options.w || '100%';\n  var initHeight = options.h || '0';\n\n  if (typeof options.uiParams !== 'object') {\n    options.uiParams = {};\n  }\n\n  if (!!options.general) {\n    options.uiParams.isGeneral = true;\n  }\n\n  var xdmOptions = {\n    remote: options.src,\n    remoteKey: options.key,\n    container: contentId,\n    channel: channelId,\n    props: {width: initWidth, height: initHeight},\n    uiParams: options.uiParams\n  };\n\n  if (options.productCtx && !options.productContext) {\n    options.productContext = JSON.parse(options.productCtx);\n  }\n\n  rpc.extend({\n    init: function (opts, xdm) {\n      xdm.analytics = analytics.get(xdm.addonKey, ns);\n      xdm.analytics.iframePerformance.start();\n      xdm.productContext = options.productContext;\n    }\n  });\n\n  rpc.init(options, xdmOptions);\n\n}\n\nexport default function (options) {\n\n  var attemptCounter = 0;\n  function doCreate() {\n    //If the element we are going to append the iframe to doesn't exist in the dom (yet). Wait for it to appear.\n    if (contentDiv(options.ns).length === 0 && attemptCounter < 10) {\n      setTimeout(function () {\n        attemptCounter++;\n        doCreate();\n      }, 50);\n      return;\n    }\n\n    // create the new iframe\n    create(options);\n  }\n\n  if (AJS.$.isReady) {\n    // if the dom is ready then this is being run during an ajax update;\n    // in that case, defer creation until the next event loop tick to ensure\n    // that updates to the desired container node's parents have completed\n    defer(doCreate);\n  } else {\n    $(doCreate);\n  }\n\n};\n","import create from '../create';\nimport dialogButton from './button';\nimport statusHelper from '../status-helper';\nimport $ from '../dollar';\n\nvar $global = $(window);\nvar idSeq = 0;\nvar $nexus;\nvar dialog;\nvar dialogId;\n\nvar buttons = {\n  submit: dialogButton.submit({\n    done: closeDialog\n  }),\n  cancel: dialogButton.cancel({\n    done: closeDialog\n  })\n};\n\nfunction keyPressListener(e) {\n  if (e.keyCode === 27 && dialog && dialog.hide) {\n    dialog.hide();\n    $(document).unbind('keydown', keyPressListener);\n  }\n};\n\nfunction createDialogElement(options, $nexus, chromeless) {\n  var $el = $('#' + options.id);\n  var extraClasses = ['ap-aui-dialog2'];\n\n  if (chromeless) {\n    extraClasses.push('ap-aui-dialog2-chromeless');\n  }\n\n  if ($el.length === 0) {\n    $el = $(aui.dialog.dialog2({\n      id: options.id,\n      titleText: options.header,\n      titleId: options.titleId,\n      size: options.size,\n      extraClasses: extraClasses,\n      removeOnHide: true,\n      footerActionContent: true,\n      modal: true\n    }));\n  } else {\n    $el = $($el[0]);\n    $el.find('.aui-dialog2-header-main').text(options.header);\n    if (extraClasses) {\n      $el.addClass(extraClasses.join(' '));\n    }\n  }\n\n  if (chromeless) {\n    $el.find('header, footer').hide();\n  } else {\n    buttons.submit.setText(options.submitText);\n    buttons.cancel.setText(options.cancelText);\n    //soy templates don't support sending objects, so make the template and bind them.\n    let footer = $el.find('.aui-dialog2-footer-actions');\n    footer.find('button').remove();\n    footer.append(buttons.submit.$el, buttons.cancel.$el);\n    $nexus.data('ra.dialog.buttons', buttons);\n\n  }\n\n  function handler(button) {\n    // ignore clicks on disabled links\n    if (button.isEnabled()) {\n      button.$el.trigger('ra.dialog.click', button.dispatch);\n    }\n  }\n\n  $.each(buttons, function (i, button) {\n    button.$el.click(function () {\n      handler(button);\n    });\n  });\n\n  return $el;\n}\n\nfunction displayDialogContent($container, options) {\n  $container.append('<div id=\"embedded-' + options.ns + '\" class=\"ap-dialog-container ap-content\"/>');\n}\n\n\nfunction parseDimension(value, viewport) {\n  if (typeof value === 'string') {\n    var percent = value.indexOf('%') === value.length - 1;\n    value = parseInt(value, 10);\n    if (percent) {\n      value = value / 100 * viewport;\n    }\n  }\n  return value;\n}\n\nfunction closeDialog() {\n  if ($nexus) {\n    // Signal the XdmRpc for the dialog's iframe to clean up\n\n    $nexus.find('iframe')\n        .trigger('ra.iframe.destroy')\n        .removeData('ra.dialog.buttons')\n        .unbind();\n    // Clear the nexus handle to allow subsequent dialogs to open\n    $nexus = null;\n  }\n  dialog.hide();\n}\n\nexport default {\n  id: dialogId,\n\n  getButton(name) {\n    var buttons = $nexus ? $nexus.data('ra.dialog.buttons') : null;\n    return (name) && (buttons) ? buttons[name] : buttons;\n  },\n\n  /**\n   * Constructs a new AUI dialog. The dialog has a single content panel containing a single iframe.\n   * The iframe's content is either created by loading [options.src] as the iframe url. Or fetching the content from the server by add-on key + module key.\n   *\n   * @param {Object} options Options to configure the behaviour and appearance of the dialog.\n   * @param {String} [options.header='Remotable Plugins Dialog Title']  Dialog header.\n   * @param {String} [options.headerClass='ap-dialog-header'] CSS class to apply to dialog header.\n   * @param {String|Number} [options.width='50%'] width of the dialog, expressed as either absolute pixels (eg 800) or percent (eg 50%)\n   * @param {String|Number} [options.height='50%'] height of the dialog, expressed as either absolute pixels (eg 600) or percent (eg 50%)\n   * @param {String} [options.id] ID attribute to assign to the dialog. Default to 'ap-dialog-n' where n is an autoincrementing id.\n   */\n  create(options, showLoadingIndicator) {\n    var defaultOptions = {\n      // These options really _should_ be provided by the caller, or else the dialog is pretty pointless\n      width: '50%',\n      height: '50%'\n    };\n    var dialogId = options.id || 'ap-dialog-' + (idSeq += 1);\n    var mergedOptions = $.extend(true, {id: dialogId}, defaultOptions, options, {uiParams: {isDialog: true, isInlineAddon:true}});\n    var dialogElement;\n\n    // patch for an old workaround where people would make 100% height / width dialogs.\n    if (mergedOptions.width === '100%' && mergedOptions.height === '100%') {\n      mergedOptions.size = 'maximum';\n    }\n\n    mergedOptions.w = parseDimension(mergedOptions.width, $global.width());\n    mergedOptions.h = parseDimension(mergedOptions.height, $global.height());\n\n    $nexus = $('<div />')\n        .addClass('ap-servlet-placeholder ap-container')\n        .attr('id', 'ap-' + options.ns)\n        .bind('ra.dialog.close', closeDialog);\n\n    if (options.chrome) {\n      dialogElement = createDialogElement(mergedOptions, $nexus);\n    } else {\n      dialogElement = createDialogElement(mergedOptions, $nexus, true);\n    }\n\n    if (options.size) {\n      mergedOptions.w = '100%';\n      mergedOptions.h = '100%';\n    } else {\n      AJS.layer(dialogElement).changeSize(mergedOptions.w, mergedOptions.h);\n      dialogElement.removeClass('aui-dialog2-medium'); // this class has a min-height so must be removed.\n    }\n\n    dialogElement.find('.aui-dialog2-content').append($nexus);\n    dialog = AJS.dialog2(dialogElement);\n\n    dialog.on('hide', closeDialog);\n    // ESC key closes the dialog\n    $(document).on('keydown', keyPressListener);\n\n    $.each(buttons, function (name, button) {\n      button.click(function () {\n        button.dispatch(true);\n      });\n    });\n\n    displayDialogContent($nexus, mergedOptions);\n\n    if (showLoadingIndicator !== false) {\n      $nexus.append(statusHelper.createStatusMessages());\n    }\n\n    //difference between a webitem and opening from js.\n    if (options.src) {\n      create(mergedOptions);\n    }\n\n    // give the dialog iframe focus so it can capture keypress events, etc.\n    // the 'iframe' selector needs to be specified, otherwise Firefox won't focus the iframe\n    dialogElement.on('ra.iframe.create', 'iframe', function () {\n      this.focus();\n    });\n\n    var existingNode = $('#' + dialogElement.attr('id'));\n    if (existingNode.length === 0) {\n      dialog.show();\n    }\n\n    return dialog;\n\n  },\n\n  close: closeDialog\n}","import content from '../content';\nimport dialog from './api';\nimport dialogFactory from './factory';\nimport $ from '../dollar';\n\nexport default function () {\n  var action = 'click';\n  var selector = '.ap-dialog';\n\n  function callback(href, options) {\n    var webItemOptions = content.getOptionsForWebItem(options.bindTo);\n    var moduleKey = content.getWebItemModuleKey(options.bindTo);\n    var addonKey = content.getWebItemPluginKey(options.bindTo);\n\n    $.extend(options, webItemOptions);\n\n    if (!options.ns) {\n      options.ns = moduleKey;\n    }\n\n    if (!options.container) {\n      options.container = options.ns;\n    }\n\n    // webitem target options can sometimes be sent as strings.\n    if (typeof options.chrome === 'string') {\n      options.chrome = (options.chrome.toLowerCase() === 'false') ? false : true;\n    }\n\n    //default chrome to be true for backwards compatibility with webitems\n    if (options.chrome === undefined) {\n      options.chrome = true;\n    }\n\n    dialogFactory({\n      key: addonKey,\n      moduleKey: moduleKey\n    }, options, options.productContext);\n  }\n\n  content.eventHandler(action, selector, callback);\n}","import $ from '../dollar';\n\nfunction Button(options) {\n  this.$el = $('<button />')\n      .text(options.text)\n      .addClass('aui-button aui-button-' + options.type)\n      .addClass(options.additionalClasses);\n\n  this.isEnabled = function () {\n    return !(this.$el.attr('aria-disabled') === 'true');\n  };\n\n  this.setEnabled = function (enabled) {\n    //cannot disable a noDisable button\n    if (options.noDisable === true) {\n      return false;\n    }\n    this.$el.attr('aria-disabled', !enabled);\n    return true;\n  };\n\n  this.setEnabled(true);\n\n  this.click = function (listener) {\n    if (listener) {\n      this.$el.unbind('ra.dialog.click');\n      this.$el.bind('ra.dialog.click', listener);\n    } else {\n      this.dispatch(true);\n    }\n  };\n\n  this.dispatch = function (result) {\n    var name = result ? 'done' : 'fail';\n    options.actions && options.actions[name] && options.actions[name]();\n  };\n\n  this.setText = function (text) {\n    if (text) {\n      this.$el.text(text);\n    }\n  };\n\n}\n\nexport default {\n  submit(actions) {\n    return new Button({\n      type: 'primary',\n      text: 'Submit',\n      additionalClasses: 'ap-dialog-submit',\n      actions: actions\n    });\n  },\n\n  cancel(actions) {\n    return new Button({\n      type: 'link',\n      text: 'Cancel',\n      noDisable: true,\n      additionalClasses: 'ap-dialog-cancel',\n      actions: actions\n    });\n  }\n}","import dialog from './api';\nimport $ from '../dollar';\n//might rename this, it opens a dialog by first working out the url (used for javascript opening a dialog).\n/**\n * opens a dialog by sending the add-on and module keys back to the server for signing.\n * Used by dialog-pages, confluence macros and opening from javascript.\n * @param {Object} options for passing to AP.create\n * @param {Object} dialog options (width, height, etc)\n * @param {String} productContextJson pass context back to the server\n */\nexport default function (options, dialogOptions, productContext) {\n  var promise;\n  var container;\n  var uiParams = $.extend({isDialog: 1}, options.uiParams);\n\n  dialog.create({\n    id: options.id,\n    ns: options.moduleKey || options.key,\n    chrome: dialogOptions.chrome || options.chrome,\n    header: dialogOptions.header,\n    width: dialogOptions.width,\n    height: dialogOptions.height,\n    size: dialogOptions.size,\n    submitText: dialogOptions.submitText,\n    cancelText: dialogOptions.cancelText\n  }, false);\n\n  container = $('.ap-dialog-container');\n  if (options.url) {\n    throw new Error('Cannot retrieve dialog content by URL');\n  }\n\n  promise = window._AP.contentResolver.resolveByParameters({\n    addonKey: options.key,\n    moduleKey: options.moduleKey,\n    productContext: productContext,\n    uiParams: uiParams\n  });\n\n  promise\n      .done(function (data) {\n        var dialogHtml = $(data);\n        dialogHtml.addClass('ap-dialog-container');\n        container.replaceWith(dialogHtml);\n      })\n      .fail(function (xhr, status, ex) {\n        var title = $('<p class=\"title\" />').text('Unable to load add-on content. Please try again later.');\n        var msg = status + (ex ? ': ' + ex.toString() : '');\n        container.html('<div class=\"aui-message error ap-aui-message\"></div>');\n        container.find('.error').text(msg);\n        container.find('.error').prepend(title);\n        AJS.log(msg);\n      });\n\n  return dialog;\n}","import dialog from './api';\nimport dialogFactory from './factory';\nimport $ from '../dollar';\n\nexport default function () {\n  return {\n    stubs: ['dialogMessage'],\n\n    init(state, xdm) {\n      // fallback for old connect p2 plugin.\n      if (state.dlg === '1') {\n        xdm.uiParams.isDialog = true;\n      }\n\n      if (xdm.uiParams.isDialog) {\n        var buttons = dialog.getButton();\n        if (buttons) {\n          $.each(buttons, function (name, button) {\n            button.click(function (e, callback) {\n              if (xdm.isActive() && xdm.buttonListenerBound) {\n                xdm.dialogMessage(name, callback);\n              } else {\n                callback(true);\n              }\n            });\n          });\n        }\n      }\n\n    },\n\n    internals: {\n      dialogListenerBound() {\n        this.buttonListenerBound = true;\n      },\n\n      setDialogButtonEnabled(name, enabled) {\n        dialog.getButton(name).setEnabled(enabled);\n      },\n\n      isDialogButtonEnabled(name, callback) {\n        var button = dialog.getButton(name);\n        callback(button ? button.isEnabled() : void 0);\n      },\n\n      createDialog(dialogOptions) {\n        var xdmOptions = {\n          key: this.addonKey\n        };\n\n        //open by key or url. This can be simplified when opening via url is removed.\n        if (dialogOptions.key) {\n          xdmOptions.moduleKey = dialogOptions.key;\n        } else if (dialogOptions.url) {\n          throw new Error('Cannot open dialog by URL, please use module key');\n        }\n\n        if ($('.aui-dialog2 :visible').length !== 0) {\n          throw new Error('Cannot open dialog when a layer is already visible');\n        }\n\n        dialogFactory(xdmOptions, dialogOptions, this.productContext);\n\n      },\n      closeDialog() {\n        dialog.close();\n      }\n    }\n  };\n}","/**\n * The iframe-side code exposes a jquery-like implementation via _dollar.\n * This runs on the product side to provide AJS.$ under a _dollar module to provide a consistent interface\n * to code that runs on host and iframe.\n */\nexport default AJS.$;","export default function () {\n  return {\n    internals: {\n      getLocation: function () {\n        return window.location.href;\n      }\n    }\n  };\n}","import addons from './addons';\nimport content from './content';\nimport create from './create';\nimport dialog from './dialog/api';\nimport dialogBinder from './dialog/binder';\nimport dialogRpc from './dialog/rpc';\nimport env from './env';\nimport inlineDialog from './inline-dialog/rpc';\nimport inlineDialogBinder from './inline-dialog/binder';\nimport loadingIndicator from './loading-indicator';\nimport messages from './messages/rpc';\nimport resize from './resize';\nimport rpc from './rpc';\nimport statusHelper from './status-helper';\nimport uiParams from '../common/ui-params';\nimport uri from '../common/uri';\nimport propagator from './propagate/rpc';\n\n/**\n * Private namespace for host-side code.\n * @type {*|{}}\n * @private\n * @deprecated use AMD instead of global namespaces. The only thing that should be on _AP is _AP.define and _AP.require.\n */\nif (!window._AP) {\n  window._AP = {};\n}\n\nAJS.toInit(dialogBinder);\nAJS.toInit(inlineDialogBinder);\n\nrpc.extend(addons);\nrpc.extend(dialogRpc);\nrpc.extend(env);\nrpc.extend(inlineDialog);\nrpc.extend(loadingIndicator);\nrpc.extend(messages);\nrpc.extend(resize);\nrpc.extend(propagator);\n\nexport default {\n  extend: rpc.extend,\n  init: rpc.init,\n  uiParams,\n  create,\n  _uriHelper: uri,\n  _statusHelper: statusHelper,\n  webItemHelper: content,\n  dialog: dialog\n}","import webitemHelper from '../content';\nimport simpleInlineDialog from './simple';\nimport $ from '../dollar';\n\nexport default function () {\n  var inlineDialogTrigger = '.ap-inline-dialog';\n  var action = 'click mouseover mouseout';\n\n  function callback(href, options, eventType) {\n    var webItemOptions = webitemHelper.getOptionsForWebItem(options.bindTo);\n    $.extend(options, webItemOptions);\n    if (options.onHover !== 'true' && eventType !== 'click') {\n      return;\n    }\n\n    // don't repeatedly open if already visible as dozens of mouse-over events are fired in quick succession\n    if (options.onHover === true && options.bindTo.hasClass('active')) {\n      return;\n    }\n    simpleInlineDialog(href, options).show();\n  }\n\n  webitemHelper.eventHandler(action, inlineDialogTrigger, callback);\n}","import $ from '../dollar';\n\nfunction getInlineDialog($content) {\n  return $content.closest('.contents').data('inlineDialog');\n}\n\nfunction showInlineDialog($content) {\n  getInlineDialog($content).show();\n}\n\nfunction resizeInlineDialog($content, width, height) {\n  $content.closest('.contents').css({\n    width: width,\n    height: height\n  });\n  refreshInlineDialog($content);\n}\n\nfunction refreshInlineDialog($content) {\n  getInlineDialog($content).refresh();\n}\n\nfunction hideInlineDialog($content) {\n  getInlineDialog($content).hide();\n}\n\nexport default function () {\n  return {\n    init(state, xdm) {\n      if (xdm.uiParams.isInlineDialog) {\n        $(xdm.iframe).closest('.ap-container').on('resized', function (e, dimensions) {\n          resizeInlineDialog($(xdm.iframe), dimensions.width, dimensions.height);\n        });\n      }\n    },\n    internals: {\n      hideInlineDialog() {\n        hideInlineDialog($(this.iframe));\n      }\n    }\n  };\n}","import $ from '../dollar';\nimport webitemHelper from '../content';\n\nexport default function (contentUrl, options) {\n  var $inlineDialog;\n\n  // Find the web-item that was clicked, we'll be needing its ID.\n  if (!options.bindTo || !options.bindTo.jquery) {\n    return;\n  }\n\n  var webItem = options.bindTo.hasClass('ap-inline-dialog') ? options.bindTo : options.bindTo.closest('.ap-inline-dialog');\n  var itemId = webItem.attr('id');\n  if (!itemId) {\n    return;\n  }\n\n  function displayInlineDialog(content, trigger, showInlineDialog) {\n    trigger = $(trigger); // sometimes it's not jQuery. Lets make it jQuery.\n    content.data('inlineDialog', $inlineDialog);\n    var pluginKey = webitemHelper.getWebItemPluginKey(trigger);\n    var moduleKey = webitemHelper.getWebItemModuleKey(trigger);\n    var promise = window._AP.contentResolver.resolveByParameters({\n      addonKey: pluginKey,\n      moduleKey,\n      isInlineDialog: true,\n      productContext: options.productContext,\n      uiParams: {\n        isInlineDialog: true\n      }\n    });\n\n    promise\n        .done(function (data) {\n          content.empty().append(data);\n          // if target options contain width and height. set it.\n          if (options.width || options.height) {\n            content.css({\n              width: options.width,\n              height: options.height\n            });\n          }\n        })\n        .fail(function (xhr, status, ex) {\n          var title = $('<p class=\"title\" />').text('Unable to load add-on content. Please try again later.');\n          content.html('<div class=\"aui-message error ap-aui-message\"></div>');\n          content.find('.error').append(title);\n          var msg = status + (ex ? ': ' + ex.toString() : '');\n          content.find('.error').text(msg);\n          AJS.log(msg);\n        })\n        .always(function () {\n          showInlineDialog();\n        });\n  }\n\n  var dialogElementIdentifier = 'ap-inline-dialog-content-' + itemId;\n\n  $inlineDialog = $(document.getElementById('inline-dialog-' + dialogElementIdentifier));\n\n  if ($inlineDialog.length !== 0) {\n    $inlineDialog.remove();\n  }\n\n  //Create the AUI inline dialog with a unique ID.\n  $inlineDialog = AJS.InlineDialog(\n      options.bindTo,\n      //assign unique id to inline Dialog\n      dialogElementIdentifier,\n      displayInlineDialog,\n      options\n  );\n\n  return {\n    id: $inlineDialog.attr('id'),\n\n    show() {\n      $inlineDialog.show();\n    },\n\n    hide() {\n      $inlineDialog.hide();\n    }\n  };\n}","import $ from './dollar';\nimport jwt from '../common/jwt';\n\nfunction updateUrl(config) {\n  var promise = $.Deferred(function (defer) {\n    var contentPromise = window._AP.contentResolver.resolveByParameters({\n      addonKey: config.addonKey,\n      moduleKey: config.moduleKey,\n      productContext: config.productContext,\n      uiParams: config.uiParams,\n      width: config.width,\n      height: config.height,\n      classifier: 'json'\n    });\n\n    contentPromise.done(function (data) {\n      var values = JSON.parse(data);\n      defer.resolve(values.src);\n    });\n  });\n\n  return promise;\n}\n\nexport default {\n  updateUrl,\n  isExpired: jwt.isJwtExpired\n}","import $ from './dollar';\nimport rpc from './rpc';\nimport statusHelper from './status-helper';\n\nexport default function () {\n  return {\n    init(state, xdm) {\n      var $home = $(xdm.iframe).closest('.ap-container');\n      statusHelper.showLoadingStatus($home, 0);\n\n      $home.find('.ap-load-timeout a.ap-btn-cancel').click(function () {\n        statusHelper.showLoadErrorStatus($home);\n        if (xdm.analytics && xdm.analytics.iframePerformance) {\n          xdm.analytics.iframePerformance.cancel();\n        }\n      });\n\n      xdm.timeout = setTimeout(function () {\n        xdm.timeout = null;\n        statusHelper.showloadTimeoutStatus($home);\n        // if inactive, the iframe has been destroyed by the product.\n        if (xdm.isActive() && xdm.analytics && xdm.analytics.iframePerformance) {\n          xdm.analytics.iframePerformance.timeout();\n        }\n      }, 20000);\n    },\n\n    internals: {\n      init() {\n        if (this.analytics && this.analytics.iframePerformance) {\n          this.analytics.iframePerformance.end();\n        }\n        var $home = $(this.iframe).closest('.ap-container');\n        statusHelper.showLoadedStatus($home);\n\n        clearTimeout(this.timeout);\n        // Let the integration tests know the iframe has loaded.\n        $home.find('.ap-content').addClass('iframe-init');\n      }\n    }\n  };\n}","import $ from '../dollar';\n\nvar MESSAGE_BAR_ID = 'ac-message-container';\nvar MESSAGE_TYPES = ['generic', 'error', 'warning', 'success', 'info', 'hint'];\n\nfunction validateMessageId(msgId) {\n  return msgId.search(/^ap\\-message\\-[0-9]+$/) === 0;\n}\n\nfunction getMessageBar() {\n  var msgBar = $('#' + MESSAGE_BAR_ID);\n\n  if (msgBar.length < 1) {\n    msgBar = $('<div id=\"' + MESSAGE_BAR_ID + '\" />').appendTo('body');\n  }\n  return msgBar;\n}\n\nfunction filterMessageOptions(options) {\n  var i;\n  var key;\n  var copy = {};\n  var allowed = ['closeable', 'fadeout', 'delay', 'duration', 'id'];\n\n  for (i in allowed) {\n    key = allowed[i];\n    if (key in options) {\n      copy[key] = options[key];\n    }\n  }\n\n  return copy;\n}\n\nexport default {\n  showMessage(name, title, bodyHTML, options) {\n    var msgBar = getMessageBar();\n\n    options = filterMessageOptions(options);\n    $.extend(options, {\n      title: title,\n      body: AJS.escapeHtml(bodyHTML)\n    });\n\n    if ($.inArray(name, MESSAGE_TYPES) < 0) {\n      throw 'Invalid message type. Must be: ' + MESSAGE_TYPES.join(', ');\n    }\n    if (validateMessageId(options.id)) {\n      AJS.messages[name](msgBar, options);\n      // Calculate the left offset based on the content width.\n      // This ensures the message always stays in the centre of the window.\n      msgBar.css('margin-left', '-' + msgBar.innerWidth() / 2 + 'px');\n    }\n  },\n\n  clearMessage(id) {\n    if (validateMessageId(id)) {\n      $('#' + id).remove();\n    }\n  }\n}","import messages from './api';\n\nexport default function () {\n  return {\n    internals: {\n      showMessage(name, title, body, options) {\n        return messages.showMessage(name, title, body, options);\n      },\n\n      clearMessage(id) {\n        return messages.clearMessage(id);\n      }\n    }\n  };\n}","import events from '../../common/dom-events.js';\n\n/**\n * Acts as a broker to send DOM events to plugins. Events may originate in the host,\n * or be received from plugin panels.\n */\nexport default function () {\n  'use strict';\n\n  return {\n    init: function (state, xdm) {\n      if (state.uiParams.isGeneral) {\n        events.bindListeners(xdm.channel, xdm.propagateToPlugin);\n      }\n    },\n    internals: {\n      propagateToHost: events.receiveEvent\n    },\n    stubs: ['propagateToPlugin']\n  };\n}","import $ from './dollar';\nimport rpc from './rpc';\n\nexport default function () {\n  var debounce = AJS.debounce || $.debounce;\n  return {\n    init(config, xdm) {\n      xdm.resize = debounce(function resize($, width, height) {\n        $(this.iframe).css({\n          width: width,\n          height: height\n        });\n        var nexus = $(this.iframe).closest('.ap-container');\n        nexus.trigger('resized', {\n          width: width,\n          height: height\n        });\n      });\n    },\n\n    internals: {\n      resize(width, height) {\n        this.resize($, width, height);\n      },\n\n      sizeToParent: debounce(function () {\n        function resizeHandler(iframe) {\n          var height = $(document).height() - $('#header > nav').outerHeight() - $('#footer').outerHeight() - 20;\n          $(iframe).css({\n            width: '100%',\n            height: height + 'px'\n          });\n        }\n        // sizeToParent is only available for general-pages\n        if (this.uiParams.isGeneral) {\n          // This adds border between the iframe and the page footer as the connect addon has scrolling content and can't do this\n          $(this.iframe).addClass('full-size-general-page');\n          $(window).on('resize', function () {\n            resizeHandler(this.iframe);\n          });\n          resizeHandler(this.iframe);\n        } else {\n          // This is only here to support integration testing\n          // see com.atlassian.plugin.connect.test.pageobjects.RemotePage#isNotFullSize()\n          $(this.iframe).addClass('full-size-general-page-fail');\n        }\n      })\n    }\n  };\n}","import $ from './dollar';\nimport XdmRpc from '../common/xdm-rpc';\nimport jwtKeepAlive from './jwt-keep-alive';\nimport uri from '../common/uri';\n\nvar each = $.each;\nvar extend = $.extend;\nvar isFn = $.isFunction;\nvar rpcCollection = [];\nvar apis = {};\nvar stubs = [];\nvar internals = {};\nvar inits = [];\n\nexport default {\n  extend(config) {\n    if (isFn(config)) {\n      config = config();\n    }\n\n    extend(apis, config.apis);\n    extend(internals, config.internals);\n    stubs = stubs.concat(config.stubs || []);\n\n    var init = config.init;\n\n    if (isFn(init)) {\n      inits.push(init);\n    }\n\n    return config.apis;\n  },\n\n  // init connect host side\n  // options = things that go to all init functions\n  init(options, xdmConfig) {\n    var remoteUrl = new uri.init(xdmConfig.remote);\n    var remoteJwt = remoteUrl.getQueryParamValue('jwt');\n    var promise;\n\n    options = options || {};\n    // add stubs for each public api\n    each(apis, function (method) {\n      stubs.push(method);\n    });\n\n    // refresh JWT tokens as required.\n    if (remoteJwt && jwtKeepAlive.isExpired(remoteJwt)) {\n      promise = jwtKeepAlive.updateUrl({\n        addonKey: xdmConfig.remoteKey,\n        moduleKey: options.ns,\n        productContext: options.productContext || {},\n        uiParams: xdmConfig.uiParams,\n        width: xdmConfig.props.width,\n        height: xdmConfig.props.height\n      });\n    }\n\n    $.when(promise).always(function (src) {\n      // if the promise resolves to a new url. update it.\n      if (src) {\n        xdmConfig.remote = src;\n      }\n      // TODO: stop copying internals and fix references instead (fix for events going across add-ons when they shouldn't)\n      var rpc = new XdmRpc($, xdmConfig, {remote: stubs, local: $.extend({}, internals)});\n\n      rpcCollection[rpc.id] = rpc;\n      each(inits, function (_, init) {\n        try {\n          init(extend({}, options), rpc);\n        } catch (ex) {\n          console.log(ex);\n        }\n      });\n    });\n  }\n}","import $ from './dollar';\n\n/**\n * Methods for showing the status of a connect-addon (loading, time'd-out etc)\n */\n\nvar statuses = {\n  loading: {\n    descriptionHtml: '<div class=\"small-spinner\"></div>Loading add-on...'\n  },\n  'load-timeout': {\n    descriptionHtml: '<div class=\"small-spinner\"></div>Add-on is not responding. Wait or <a href=\"#\" class=\"ap-btn-cancel\">cancel</a>?'\n  },\n\n  'load-error': {\n    descriptionHtml: 'Add-on failed to load.'\n  }\n};\n\nfunction hideStatuses($home) {\n  // If there's a pending timer to show the loading status, kill it.\n  if ($home.data('loadingStatusTimer')) {\n    clearTimeout($home.data('loadingStatusTimer'));\n    $home.removeData('loadingStatusTimer');\n  }\n  $home.find('.ap-status').addClass('hidden');\n}\n\nfunction showStatus($home, status) {\n  hideStatuses($home);\n  $home.closest('.ap-container').removeClass('hidden');\n  $home.find('.ap-stats').removeClass('hidden');\n  $home.find('.ap-' + status).removeClass('hidden');\n  /* setTimout fixes bug in AUI spinner positioning */\n  setTimeout(function () {\n    var spinner = $home.find('.small-spinner', '.ap-' + status);\n    if (spinner.length && spinner.spin) {\n      spinner.spin({lines: 12, length: 3, width: 2, radius: 3, trail: 60, speed: 1.5, zIndex: 1});\n    }\n  }, 10);\n}\n\n//when an addon has loaded. Hide the status bar.\nfunction showLoadedStatus($home) {\n  hideStatuses($home);\n}\n\nfunction showLoadingStatus($home, delay) {\n  if (!delay) {\n    showStatus($home, 'loading');\n  } else {\n    // Wait a second before showing loading status.\n    var timer = setTimeout(showStatus.bind(null, $home, 'loading'), delay);\n    $home.data('loadingStatusTimer', timer);\n  }\n}\n\nfunction showloadTimeoutStatus($home) {\n  showStatus($home, 'load-timeout');\n}\n\nfunction showLoadErrorStatus($home) {\n  showStatus($home, 'load-error');\n}\n\nfunction createStatusMessages() {\n  var i;\n  var stats = $('<div class=\"ap-stats\" />');\n\n  for (i in statuses) {\n    var status = $('<div class=\"ap-' + i + ' ap-status hidden\" />');\n    status.append('<small>' + statuses[i].descriptionHtml + '</small>');\n    stats.append(status);\n  }\n  return stats;\n}\n\nexport default {\n  createStatusMessages,\n  showLoadingStatus,\n  showloadTimeoutStatus,\n  showLoadErrorStatus,\n  showLoadedStatus\n}","function escapeSelector(s) {\n  if (!s) {\n    throw new Error('No selector to escape');\n  }\n  return s.replace(/[!\"#$%&'()*+,.\\/:;<=>?@[\\\\\\]^`{|}~]/g, '\\\\$&');\n}\n\nexport default {escapeSelector}"]}