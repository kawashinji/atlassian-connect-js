{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/base-64/base64.js","node_modules/events/events.js","node_modules/jsuri/Uri.js","node_modules/utf8/utf8.js","src/host/actions/dom_event_actions.js","src/host/actions/env_actions.js","src/host/actions/event_actions.js","src/host/actions/iframe_actions.js","src/host/actions/jwt_actions.js","src/host/actions/loading_indicator_actions.js","src/host/actions/module_actions.js","src/host/actions/webitem_actions.js","src/host/components/iframe.js","src/host/components/iframe_container.js","src/host/components/inline_dialog.js","src/host/components/inline_dialog_webitem.js","src/host/components/loading_indicator.js","src/host/components/webitem.js","src/host/create.js","src/host/dialog/button.js","src/host/dialog/renderer.js","src/host/dispatchers/analytics_dispatcher.js","src/host/dispatchers/event_dispatcher.js","src/host/dollar.js","src/host/index.js","src/host/modules/dialog.js","src/host/modules/env.js","src/host/modules/events.js","src/host/modules/messages.js","src/host/underscore.js","src/host/util.js","src/host/utils/jwt.js","src/host/utils/url.js","src/host/utils/webitem.js","../simple-xdm/dist/node_modules/simple-xdm/dist/node_modules/browser-pack/_prelude.js","../simple-xdm/src/host/index.js","../simple-xdm/src/common/postmessage.js","../simple-xdm/src/common/util.js","../simple-xdm/src/host/xdmrpc.js"],"names":[],"mappings":"AAAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACrKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;2CCpP4B,8BAA8B;;;;iCACpC,sBAAsB;;;;AAE5C,MAAM,CAAC,OAAO,GAAG;AACf,kBAAgB,EAAE,0BAAS,IAAI,EAAC;AAC9B,mCAAU,mBAAmB,CAAC,IAAI,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","file":"connect-host.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */\n;(function(root) {\n\n\t// Detect free variables `exports`.\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`.\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code, and use\n\t// it as `root`.\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar InvalidCharacterError = function(message) {\n\t\tthis.message = message;\n\t};\n\tInvalidCharacterError.prototype = new Error;\n\tInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n\tvar error = function(message) {\n\t\t// Note: the error messages used throughout this file match those used by\n\t\t// the native `atob`/`btoa` implementation in Chromium.\n\t\tthrow new InvalidCharacterError(message);\n\t};\n\n\tvar TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t// http://whatwg.org/html/common-microsyntaxes.html#space-character\n\tvar REGEX_SPACE_CHARACTERS = /[\\t\\n\\f\\r ]/g;\n\n\t// `decode` is designed to be fully compatible with `atob` as described in the\n\t// HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob\n\t// The optimized base64-decoding algorithm used is based on @atks excellent\n\t// implementation. https://gist.github.com/atk/1020396\n\tvar decode = function(input) {\n\t\tinput = String(input)\n\t\t\t.replace(REGEX_SPACE_CHARACTERS, '');\n\t\tvar length = input.length;\n\t\tif (length % 4 == 0) {\n\t\t\tinput = input.replace(/==?$/, '');\n\t\t\tlength = input.length;\n\t\t}\n\t\tif (\n\t\t\tlength % 4 == 1 ||\n\t\t\t// http://whatwg.org/C#alphanumeric-ascii-characters\n\t\t\t/[^+a-zA-Z0-9/]/.test(input)\n\t\t) {\n\t\t\terror(\n\t\t\t\t'Invalid character: the string to be decoded is not correctly encoded.'\n\t\t\t);\n\t\t}\n\t\tvar bitCounter = 0;\n\t\tvar bitStorage;\n\t\tvar buffer;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\twhile (++position < length) {\n\t\t\tbuffer = TABLE.indexOf(input.charAt(position));\n\t\t\tbitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;\n\t\t\t// Unless this is the first of a group of 4 characters\n\t\t\tif (bitCounter++ % 4) {\n\t\t\t\t// convert the first 8 bits to a single ASCII character.\n\t\t\t\toutput += String.fromCharCode(\n\t\t\t\t\t0xFF & bitStorage >> (-2 * bitCounter & 6)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t};\n\n\t// `encode` is designed to be fully compatible with `btoa` as described in the\n\t// HTML Standard: http://whatwg.org/html/webappapis.html#dom-windowbase64-btoa\n\tvar encode = function(input) {\n\t\tinput = String(input);\n\t\tif (/[^\\0-\\xFF]/.test(input)) {\n\t\t\t// Note: no need to special-case astral symbols here, as surrogates are\n\t\t\t// matched, and the input is supposed to only contain ASCII anyway.\n\t\t\terror(\n\t\t\t\t'The string to be encoded contains characters outside of the ' +\n\t\t\t\t'Latin1 range.'\n\t\t\t);\n\t\t}\n\t\tvar padding = input.length % 3;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\tvar a;\n\t\tvar b;\n\t\tvar c;\n\t\tvar d;\n\t\tvar buffer;\n\t\t// Make sure any padding is handled outside of the loop.\n\t\tvar length = input.length - padding;\n\n\t\twhile (++position < length) {\n\t\t\t// Read three bytes, i.e. 24 bits.\n\t\t\ta = input.charCodeAt(position) << 16;\n\t\t\tb = input.charCodeAt(++position) << 8;\n\t\t\tc = input.charCodeAt(++position);\n\t\t\tbuffer = a + b + c;\n\t\t\t// Turn the 24 bits into four chunks of 6 bits each, and append the\n\t\t\t// matching character for each of them to the output.\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 18 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 12 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 6 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer & 0x3F)\n\t\t\t);\n\t\t}\n\n\t\tif (padding == 2) {\n\t\t\ta = input.charCodeAt(position) << 8;\n\t\t\tb = input.charCodeAt(++position);\n\t\t\tbuffer = a + b;\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 10) +\n\t\t\t\tTABLE.charAt((buffer >> 4) & 0x3F) +\n\t\t\t\tTABLE.charAt((buffer << 2) & 0x3F) +\n\t\t\t\t'='\n\t\t\t);\n\t\t} else if (padding == 1) {\n\t\t\tbuffer = input.charCodeAt(position);\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 2) +\n\t\t\t\tTABLE.charAt((buffer << 4) & 0x3F) +\n\t\t\t\t'=='\n\t\t\t);\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tvar base64 = {\n\t\t'encode': encode,\n\t\t'decode': decode,\n\t\t'version': '0.1.0'\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn base64;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = base64;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (var key in base64) {\n\t\t\t\tbase64.hasOwnProperty(key) && (freeExports[key] = base64[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.base64 = base64;\n\t}\n\n}(this));\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","/*!\n * jsUri\n * https://github.com/derek-watson/jsUri\n *\n * Copyright 2013, Derek Watson\n * Released under the MIT license.\n *\n * Includes parseUri regular expressions\n * http://blog.stevenlevithan.com/archives/parseuri\n * Copyright 2007, Steven Levithan\n * Released under the MIT license.\n */\n\n /*globals define, module */\n\n(function(global) {\n\n  var re = {\n    starts_with_slashes: /^\\/+/,\n    ends_with_slashes: /\\/+$/,\n    pluses: /\\+/g,\n    query_separator: /[&;]/,\n    uri_parser: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*)(?::([^:@]*))?)?@)?(\\[[0-9a-fA-F:.]+\\]|[^:\\/?#]*)(?::(\\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n  };\n\n  /**\n   * Define forEach for older js environments\n   * @see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach#Compatibility\n   */\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function(callback, thisArg) {\n      var T, k;\n\n      if (this == null) {\n        throw new TypeError(' this is null or not defined');\n      }\n\n      var O = Object(this);\n      var len = O.length >>> 0;\n\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + ' is not a function');\n      }\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      }\n\n      k = 0;\n\n      while (k < len) {\n        var kValue;\n        if (k in O) {\n          kValue = O[k];\n          callback.call(T, kValue, k, O);\n        }\n        k++;\n      }\n    };\n  }\n\n  /**\n   * unescape a query param value\n   * @param  {string} s encoded value\n   * @return {string}   decoded value\n   */\n  function decode(s) {\n    if (s) {\n        s = s.toString().replace(re.pluses, '%20');\n        s = decodeURIComponent(s);\n    }\n    return s;\n  }\n\n  /**\n   * Breaks a uri string down into its individual parts\n   * @param  {string} str uri\n   * @return {object}     parts\n   */\n  function parseUri(str) {\n    var parser = re.uri_parser;\n    var parserKeys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\", \"host\", \"port\", \"isColonUri\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\n    var m = parser.exec(str || '');\n    var parts = {};\n\n    parserKeys.forEach(function(key, i) {\n      parts[key] = m[i] || '';\n    });\n\n    return parts;\n  }\n\n  /**\n   * Breaks a query string down into an array of key/value pairs\n   * @param  {string} str query\n   * @return {array}      array of arrays (key/value pairs)\n   */\n  function parseQuery(str) {\n    var i, ps, p, n, k, v, l;\n    var pairs = [];\n\n    if (typeof(str) === 'undefined' || str === null || str === '') {\n      return pairs;\n    }\n\n    if (str.indexOf('?') === 0) {\n      str = str.substring(1);\n    }\n\n    ps = str.toString().split(re.query_separator);\n\n    for (i = 0, l = ps.length; i < l; i++) {\n      p = ps[i];\n      n = p.indexOf('=');\n\n      if (n !== 0) {\n        k = decode(p.substring(0, n));\n        v = decode(p.substring(n + 1));\n        pairs.push(n === -1 ? [p, null] : [k, v]);\n      }\n\n    }\n    return pairs;\n  }\n\n  /**\n   * Creates a new Uri object\n   * @constructor\n   * @param {string} str\n   */\n  function Uri(str) {\n    this.uriParts = parseUri(str);\n    this.queryPairs = parseQuery(this.uriParts.query);\n    this.hasAuthorityPrefixUserPref = null;\n  }\n\n  /**\n   * Define getter/setter methods\n   */\n  ['protocol', 'userInfo', 'host', 'port', 'path', 'anchor'].forEach(function(key) {\n    Uri.prototype[key] = function(val) {\n      if (typeof val !== 'undefined') {\n        this.uriParts[key] = val;\n      }\n      return this.uriParts[key];\n    };\n  });\n\n  /**\n   * if there is no protocol, the leading // can be enabled or disabled\n   * @param  {Boolean}  val\n   * @return {Boolean}\n   */\n  Uri.prototype.hasAuthorityPrefix = function(val) {\n    if (typeof val !== 'undefined') {\n      this.hasAuthorityPrefixUserPref = val;\n    }\n\n    if (this.hasAuthorityPrefixUserPref === null) {\n      return (this.uriParts.source.indexOf('//') !== -1);\n    } else {\n      return this.hasAuthorityPrefixUserPref;\n    }\n  };\n\n  Uri.prototype.isColonUri = function (val) {\n    if (typeof val !== 'undefined') {\n      this.uriParts.isColonUri = !!val;\n    } else {\n      return !!this.uriParts.isColonUri;\n    }\n  };\n\n  /**\n   * Serializes the internal state of the query pairs\n   * @param  {string} [val]   set a new query string\n   * @return {string}         query string\n   */\n  Uri.prototype.query = function(val) {\n    var s = '', i, param, l;\n\n    if (typeof val !== 'undefined') {\n      this.queryPairs = parseQuery(val);\n    }\n\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (s.length > 0) {\n        s += '&';\n      }\n      if (param[1] === null) {\n        s += param[0];\n      } else {\n        s += param[0];\n        s += '=';\n        if (typeof param[1] !== 'undefined') {\n          s += encodeURIComponent(param[1]);\n        }\n      }\n    }\n    return s.length > 0 ? '?' + s : s;\n  };\n\n  /**\n   * returns the first query param value found for the key\n   * @param  {string} key query key\n   * @return {string}     first value found for key\n   */\n  Uri.prototype.getQueryParamValue = function (key) {\n    var param, i, l;\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (key === param[0]) {\n        return param[1];\n      }\n    }\n  };\n\n  /**\n   * returns an array of query param values for the key\n   * @param  {string} key query key\n   * @return {array}      array of values\n   */\n  Uri.prototype.getQueryParamValues = function (key) {\n    var arr = [], i, param, l;\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n      param = this.queryPairs[i];\n      if (key === param[0]) {\n        arr.push(param[1]);\n      }\n    }\n    return arr;\n  };\n\n  /**\n   * removes query parameters\n   * @param  {string} key     remove values for key\n   * @param  {val}    [val]   remove a specific value, otherwise removes all\n   * @return {Uri}            returns self for fluent chaining\n   */\n  Uri.prototype.deleteQueryParam = function (key, val) {\n    var arr = [], i, param, keyMatchesFilter, valMatchesFilter, l;\n\n    for (i = 0, l = this.queryPairs.length; i < l; i++) {\n\n      param = this.queryPairs[i];\n      keyMatchesFilter = decode(param[0]) === decode(key);\n      valMatchesFilter = param[1] === val;\n\n      if ((arguments.length === 1 && !keyMatchesFilter) || (arguments.length === 2 && (!keyMatchesFilter || !valMatchesFilter))) {\n        arr.push(param);\n      }\n    }\n\n    this.queryPairs = arr;\n\n    return this;\n  };\n\n  /**\n   * adds a query parameter\n   * @param  {string}  key        add values for key\n   * @param  {string}  val        value to add\n   * @param  {integer} [index]    specific index to add the value at\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.addQueryParam = function (key, val, index) {\n    if (arguments.length === 3 && index !== -1) {\n      index = Math.min(index, this.queryPairs.length);\n      this.queryPairs.splice(index, 0, [key, val]);\n    } else if (arguments.length > 0) {\n      this.queryPairs.push([key, val]);\n    }\n    return this;\n  };\n\n  /**\n   * test for the existence of a query parameter\n   * @param  {string}  key        add values for key\n   * @param  {string}  val        value to add\n   * @param  {integer} [index]    specific index to add the value at\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.hasQueryParam = function (key) {\n    var i, len = this.queryPairs.length;\n    for (i = 0; i < len; i++) {\n      if (this.queryPairs[i][0] == key)\n        return true;\n    }\n    return false;\n  };\n\n  /**\n   * replaces query param values\n   * @param  {string} key         key to replace value for\n   * @param  {string} newVal      new value\n   * @param  {string} [oldVal]    replace only one specific value (otherwise replaces all)\n   * @return {Uri}                returns self for fluent chaining\n   */\n  Uri.prototype.replaceQueryParam = function (key, newVal, oldVal) {\n    var index = -1, len = this.queryPairs.length, i, param;\n\n    if (arguments.length === 3) {\n      for (i = 0; i < len; i++) {\n        param = this.queryPairs[i];\n        if (decode(param[0]) === decode(key) && decodeURIComponent(param[1]) === decode(oldVal)) {\n          index = i;\n          break;\n        }\n      }\n      if (index >= 0) {\n        this.deleteQueryParam(key, decode(oldVal)).addQueryParam(key, newVal, index);\n      }\n    } else {\n      for (i = 0; i < len; i++) {\n        param = this.queryPairs[i];\n        if (decode(param[0]) === decode(key)) {\n          index = i;\n          break;\n        }\n      }\n      this.deleteQueryParam(key);\n      this.addQueryParam(key, newVal, index);\n    }\n    return this;\n  };\n\n  /**\n   * Define fluent setter methods (setProtocol, setHasAuthorityPrefix, etc)\n   */\n  ['protocol', 'hasAuthorityPrefix', 'isColonUri', 'userInfo', 'host', 'port', 'path', 'query', 'anchor'].forEach(function(key) {\n    var method = 'set' + key.charAt(0).toUpperCase() + key.slice(1);\n    Uri.prototype[method] = function(val) {\n      this[key](val);\n      return this;\n    };\n  });\n\n  /**\n   * Scheme name, colon and doubleslash, as required\n   * @return {string} http:// or possibly just //\n   */\n  Uri.prototype.scheme = function() {\n    var s = '';\n\n    if (this.protocol()) {\n      s += this.protocol();\n      if (this.protocol().indexOf(':') !== this.protocol().length - 1) {\n        s += ':';\n      }\n      s += '//';\n    } else {\n      if (this.hasAuthorityPrefix() && this.host()) {\n        s += '//';\n      }\n    }\n\n    return s;\n  };\n\n  /**\n   * Same as Mozilla nsIURI.prePath\n   * @return {string} scheme://user:password@host:port\n   * @see  https://developer.mozilla.org/en/nsIURI\n   */\n  Uri.prototype.origin = function() {\n    var s = this.scheme();\n\n    if (this.userInfo() && this.host()) {\n      s += this.userInfo();\n      if (this.userInfo().indexOf('@') !== this.userInfo().length - 1) {\n        s += '@';\n      }\n    }\n\n    if (this.host()) {\n      s += this.host();\n      if (this.port() || (this.path() && this.path().substr(0, 1).match(/[0-9]/))) {\n        s += ':' + this.port();\n      }\n    }\n\n    return s;\n  };\n\n  /**\n   * Adds a trailing slash to the path\n   */\n  Uri.prototype.addTrailingSlash = function() {\n    var path = this.path() || '';\n\n    if (path.substr(-1) !== '/') {\n      this.path(path + '/');\n    }\n\n    return this;\n  };\n\n  /**\n   * Serializes the internal state of the Uri object\n   * @return {string}\n   */\n  Uri.prototype.toString = function() {\n    var path, s = this.origin();\n\n    if (this.isColonUri()) {\n      if (this.path()) {\n        s += ':'+this.path();\n      }\n    } else if (this.path()) {\n      path = this.path();\n      if (!(re.ends_with_slashes.test(s) || re.starts_with_slashes.test(path))) {\n        s += '/';\n      } else {\n        if (s) {\n          s.replace(re.ends_with_slashes, '/');\n        }\n        path = path.replace(re.starts_with_slashes, '/');\n      }\n      s += path;\n    } else {\n      if (this.host() && (this.query().toString() || this.anchor())) {\n        s += '/';\n      }\n    }\n    if (this.query().toString()) {\n      s += this.query().toString();\n    }\n\n    if (this.anchor()) {\n      if (this.anchor().indexOf('#') !== 0) {\n        s += '#';\n      }\n      s += this.anchor();\n    }\n\n    return s;\n  };\n\n  /**\n   * Clone a Uri object\n   * @return {Uri} duplicate copy of the Uri\n   */\n  Uri.prototype.clone = function() {\n    return new Uri(this.toString());\n  };\n\n  /**\n   * export via AMD or CommonJS, otherwise leak a global\n   */\n  if (typeof define === 'function' && define.amd) {\n    define(function() {\n      return Uri;\n    });\n  } else if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = Uri;\n  } else {\n    global.Uri = Uri;\n  }\n}(this));\n","/*! https://mths.be/utf8js v2.0.0 by @mathias */\n;(function(root) {\n\n\t// Detect free variables `exports`\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code,\n\t// and use it as `root`\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar stringFromCharCode = String.fromCharCode;\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2decode(string) {\n\t\tvar output = [];\n\t\tvar counter = 0;\n\t\tvar length = string.length;\n\t\tvar value;\n\t\tvar extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2encode(array) {\n\t\tvar length = array.length;\n\t\tvar index = -1;\n\t\tvar value;\n\t\tvar output = '';\n\t\twhile (++index < length) {\n\t\t\tvalue = array[index];\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t}\n\t\treturn output;\n\t}\n\n\tfunction checkScalarValue(codePoint) {\n\t\tif (codePoint >= 0xD800 && codePoint <= 0xDFFF) {\n\t\t\tthrow Error(\n\t\t\t\t'Lone surrogate U+' + codePoint.toString(16).toUpperCase() +\n\t\t\t\t' is not a scalar value'\n\t\t\t);\n\t\t}\n\t}\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction createByte(codePoint, shift) {\n\t\treturn stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);\n\t}\n\n\tfunction encodeCodePoint(codePoint) {\n\t\tif ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence\n\t\t\treturn stringFromCharCode(codePoint);\n\t\t}\n\t\tvar symbol = '';\n\t\tif ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);\n\t\t}\n\t\telse if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence\n\t\t\tcheckScalarValue(codePoint);\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\telse if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);\n\t\t\tsymbol += createByte(codePoint, 12);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\tsymbol += stringFromCharCode((codePoint & 0x3F) | 0x80);\n\t\treturn symbol;\n\t}\n\n\tfunction utf8encode(string) {\n\t\tvar codePoints = ucs2decode(string);\n\t\tvar length = codePoints.length;\n\t\tvar index = -1;\n\t\tvar codePoint;\n\t\tvar byteString = '';\n\t\twhile (++index < length) {\n\t\t\tcodePoint = codePoints[index];\n\t\t\tbyteString += encodeCodePoint(codePoint);\n\t\t}\n\t\treturn byteString;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction readContinuationByte() {\n\t\tif (byteIndex >= byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tvar continuationByte = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\tif ((continuationByte & 0xC0) == 0x80) {\n\t\t\treturn continuationByte & 0x3F;\n\t\t}\n\n\t\t// If we end up here, its not a continuation byte\n\t\tthrow Error('Invalid continuation byte');\n\t}\n\n\tfunction decodeSymbol() {\n\t\tvar byte1;\n\t\tvar byte2;\n\t\tvar byte3;\n\t\tvar byte4;\n\t\tvar codePoint;\n\n\t\tif (byteIndex > byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tif (byteIndex == byteCount) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Read first byte\n\t\tbyte1 = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\t// 1-byte sequence (no continuation bytes)\n\t\tif ((byte1 & 0x80) == 0) {\n\t\t\treturn byte1;\n\t\t}\n\n\t\t// 2-byte sequence\n\t\tif ((byte1 & 0xE0) == 0xC0) {\n\t\t\tvar byte2 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x1F) << 6) | byte2;\n\t\t\tif (codePoint >= 0x80) {\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 3-byte sequence (may include unpaired surrogates)\n\t\tif ((byte1 & 0xF0) == 0xE0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;\n\t\t\tif (codePoint >= 0x0800) {\n\t\t\t\tcheckScalarValue(codePoint);\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 4-byte sequence\n\t\tif ((byte1 & 0xF8) == 0xF0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tbyte4 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 0x12) | (byte2 << 0x0C) |\n\t\t\t\t(byte3 << 0x06) | byte4;\n\t\t\tif (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\t\treturn codePoint;\n\t\t\t}\n\t\t}\n\n\t\tthrow Error('Invalid UTF-8 detected');\n\t}\n\n\tvar byteArray;\n\tvar byteCount;\n\tvar byteIndex;\n\tfunction utf8decode(byteString) {\n\t\tbyteArray = ucs2decode(byteString);\n\t\tbyteCount = byteArray.length;\n\t\tbyteIndex = 0;\n\t\tvar codePoints = [];\n\t\tvar tmp;\n\t\twhile ((tmp = decodeSymbol()) !== false) {\n\t\t\tcodePoints.push(tmp);\n\t\t}\n\t\treturn ucs2encode(codePoints);\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar utf8 = {\n\t\t'version': '2.0.0',\n\t\t'encode': utf8encode,\n\t\t'decode': utf8decode\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn utf8;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = utf8;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tvar object = {};\n\t\t\tvar hasOwnProperty = object.hasOwnProperty;\n\t\t\tfor (var key in utf8) {\n\t\t\t\thasOwnProperty.call(utf8, key) && (freeExports[key] = utf8[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.utf8 = utf8;\n\t}\n\n}(this));\n","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport SimpleXDM from 'simple-xdm/dist/host';\n\nmodule.exports = {\n  registerKeyEvent: function(data){\n    SimpleXDM.registerKeyListener(data.extension_id, data.key, data.modifiers, data.callback);\n    EventDispatcher.dispatch('dom-event-register', data);\n  },\n  unregisterKeyEvent: function(data){\n    SimpleXDM.unregisterKeyListener(data.extension_id, data.key, data.modifiers, data.callback);\n    EventDispatcher.dispatch('dom-event-unregister', data);\n  }\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport util from '../util';\n\nEventDispatcher.register('iframe-resize', function(data){\n  var width = util.stringToDimension(data.width);\n  var height = util.stringToDimension(data.height);\n  data.$el.css({\n    width: width,\n    height: height\n  });\n  data.$el.trigger('resized', {width: width, height: height});\n});\n\nEventDispatcher.register('iframe-size-to-parent', function(data){\n  var height = AJS.$(document).height() - AJS.$('#header > nav').outerHeight() - AJS.$('#footer').outerHeight() - 20;\n  var $el = util.getIframeByExtensionId(data.context.extension_id);\n  EventDispatcher.dispatch('iframe-resize', {width: '100%', height: height + 'px', $el});\n});\n\nAJS.$(window).on('resize', function (e) {\n  EventDispatcher.dispatch('host-window-resize', e);\n});\n\nmodule.exports = {\n  iframeResize: function(width, height, context){\n    var $el = util.getIframeByExtensionId(context.extension_id);\n    EventDispatcher.dispatch('iframe-resize', {width, height, $el});\n  },\n  sizeToParent: function(context){\n    EventDispatcher.dispatch('iframe-size-to-parent', {context});\n  }\n}","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport SimpleXDM from 'simple-xdm/dist/host';\n\nmodule.exports = {\n  broadcast: function(type, targetSpec, event){\n    SimpleXDM.dispatch(type, targetSpec, event);\n    EventDispatcher.dispatch('event-dispatch', {\n      type: type,\n      targetSpec: targetSpec,\n      event: event\n    });\n  }\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport simpleXDM from 'simple-xdm/dist/host';\n\nmodule.exports = {\n  notifyIframeCreated: function($el, extension) {\n    EventDispatcher.dispatch('iframe-create', {$el, extension});\n  },\n  notifyIframeDestroyed: function(extension_id){\n    var extension = simpleXDM.getExtensions({\n      extension_id: extension_id\n    });\n    if(extension.length === 1){\n      extension = extension[0];\n    }\n    EventDispatcher.dispatch('iframe-destroyed', {extension});\n    simpleXDM.unregisterExtension({extension_id: extension_id});\n  }\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport _ from '../underscore';\n\nmodule.exports = {\n  registerContentResolver: function(data) {\n    EventDispatcher.dispatch('content-resolver-register-by-extension', data);\n  },\n  requestRefreshUrl: function(data){\n    if(!data.resolver) {\n      throw Error('ACJS: No content resolver supplied');\n    }\n    var promise = data.resolver.call(null, _.extend({classifier: 'json'}, data.extension));\n    promise.done(function (promiseData) {\n      var values = {};\n      if(_.isObject(promiseData)) {\n        values = promiseData;\n      } else if(_.isString(promiseData)) {\n        try{\n          values = JSON.parse(promiseData);\n        } catch(e){\n          console.error('ACJS: invalid response from content resolver');\n        }\n      }\n      EventDispatcher.dispatch('jwt-url-refreshed', {extension: data.extension, url: values.url});\n    });\n    EventDispatcher.dispatch('jwt-url-refresh-request', {data});\n  }\n\n};\n","import EventDispatcher from 'dispatchers/event_dispatcher';\n\nexport default {\n  timeout($el, extension) {\n    EventDispatcher.dispatch('iframe-bridge-timeout', {$el, extension});\n  },\n  cancelled($el, extension) {\n    EventDispatcher.dispatch('iframe-bridge-cancelled', {$el, extension});\n  }\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\n\nmodule.exports = {\n  defineCustomModule: function(name, methods){\n    var data = {};\n    if(!methods){\n      data.methods = name;\n    } else {\n      data.methods = methods;\n      data.name = name;\n    }\n    EventDispatcher.dispatch('module-define-custom', data);\n  }\n}","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport WebItemComponent from 'components/webitem';\nimport WebItemUtils from 'utils/webitem';\n\nexport default {\n  addWebItem: (potentialWebItem) => {\n\n    let webitem;\n    let existing = WebItemComponent.getWebItemsBySelector(potentialWebItem.selector);\n\n    if(existing) {\n      return false;\n    } else {\n      webitem = WebItemComponent.setWebItem(potentialWebItem);\n      EventDispatcher.dispatch('webitem-added', {webitem});\n    }\n\n  },\n\n  webitemInvoked: (webitem, event) => {\n    var $target = $(event.target);\n    var extension = {\n      addon_key: WebItemUtils.getExtensionKey($target),\n      key: WebItemUtils.getKey($target),\n      url: $target.attr('href')\n    };\n\n    EventDispatcher.dispatch('webitem-invoked:' + webitem.name, {webitem, event, extension});\n  }\n\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport IframeActions from 'actions/iframe_actions';\nimport $ from '../dollar';\nimport util from '../util';\nimport simpleXDM from 'simple-xdm/dist/host';\nimport urlUtil from 'utils/url';\n\nconst CONTAINER_CLASSES = ['ap-container'];\nconst DEFAULT_IFRAME_ATTRIBUTES = {width: '100%'};\n\nclass Iframe {\n  constructor () {\n    this._stateRegistry = {};\n  }\n\n  simpleXdmExtension(extension) {\n    var $iframe;\n    var iframeAttributes = simpleXDM.create(extension, function (extension_id) {\n      extension.id = extension_id;\n      EventDispatcher.dispatch('iframe-bridge-estabilshed', {\n        $el: $iframe,\n        extension\n      });\n    });\n    extension.id = iframeAttributes.id;\n    $iframe = this._renderIframe(iframeAttributes);\n    return {$el: $iframe, extension};\n  }\n\n  _renderIframe(attributes){\n    var attrs = $.extend({}, DEFAULT_IFRAME_ATTRIBUTES, attributes);\n    return $('<iframe />').attr(attrs);\n  }\n}\n\nvar IframeComponent = new Iframe();\n\nexport default IframeComponent;","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport $ from '../dollar';\nimport urlUtil from 'utils/url';\nimport JwtActions from 'actions/jwt_actions';\nimport IframeActions from 'actions/iframe_actions';\nimport IframeComponent from 'components/iframe';\n\nconst CONTAINER_CLASSES = ['ap-container'];\n\nclass IframeContainer {\n  constructor () {\n    this._urlContainerRegistry = {};\n    this._contentResolver = false;\n  }\n\n  setContentResolver(callback) {\n    this._contentResolver = callback;\n  }\n\n  _insertIframe($container, extension) {\n    var simpleExtension = IframeComponent.simpleXdmExtension(extension);\n    $container.append(simpleExtension.$el);\n    IframeActions.notifyIframeCreated(simpleExtension.$el, simpleExtension.extension);\n\n  }\n\n  createExtension(extension) {\n    var $iframe;\n    var $container = this._renderContainer();\n    if(urlUtil.hasJwt(extension.url) && urlUtil.isJwtExpired(extension.url)){\n      this._urlContainerRegistry[extension.id] = $container;\n      JwtActions.requestRefreshUrl({extension, resolver: this._contentResolver});\n    } else {\n      this._insertIframe($container, extension);\n    }\n\n    return $container;\n  }\n  resolverResponse(data) {\n    var extension = data.extension;\n    var $container = this._urlContainerRegistry[extension.id];\n    extension.url = data.url;\n    this._insertIframe($container, extension);\n    delete this._urlContainerRegistry[extension.id];\n  }\n\n  _renderContainer(attributes){\n    var container = $('<div />').attr(attributes || {});\n    container.addClass(CONTAINER_CLASSES.join(' '));\n    return container;\n  }\n\n}\n\nvar IframeContainerComponent = new IframeContainer();\nEventDispatcher.register('content-resolver-register-by-extension', function(data){\n  IframeContainerComponent.setContentResolver(data.callback);\n});\n\nEventDispatcher.register('jwt-url-refreshed', function(data) {\n  IframeContainerComponent.resolverResponse(data);\n});\n\nexport default IframeContainerComponent;","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport $ from '../dollar';\n\nclass InlineDialog {\n  constructor () {\n  }\n  _renderContainer(){\n    return $(\"<div />\").addClass(\"aui-inline-dialog-contents\");\n  }\n  render(attributes){\n    var $el = $('<aui-inline-dialog />');\n    $el.attr(attributes || {});\n    $el.addClass('ap-inline-dialog-container');\n    $el.append(this._renderContainer());\n    return $el;\n  }\n\n}\n\nvar InlineDialogComponent = new InlineDialog();\n\nexport default InlineDialogComponent;","import WebItemActions from 'actions/webitem_actions';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\nimport InlineDialogComponent from 'components/inline_dialog';\nimport WebItemUtils from 'utils/webitem';\nimport IframeContainer from 'components/iframe_container';\n\nconst ITEM_NAME = 'inline-dialog';\nconst SELECTOR = '.ap-inline-dialog';\nconst TRIGGERS = ['click', 'hover'];\nconst WEBITEM_UID_KEY = 'inline-dialog-target-uid';\n\nclass InlineDialogWebItem {\n  constructor(){\n    this._inlineDialogWebItemSpec = {\n      name: ITEM_NAME,\n      selector: SELECTOR,\n      triggers: TRIGGERS\n    };\n    this._inlineDialogWebItems = {};\n  }\n\n  getWebItem(){\n    return this._inlineDialogWebItemSpec;\n  }\n\n  triggered(data) {\n    console.log('triggered!', data);\n    var $target = $(data.event.target);\n    var attr = {id: $target.data(WEBITEM_UID_KEY)};\n\n    var $iframeContainer = IframeContainer.createExtension(data.extension);\n    var inlineDialog = InlineDialogComponent.render(attr);\n    // AUI modifies the dom after insertion. Thus the content must be appended afterwards.\n    inlineDialog.find(':first-child').append($iframeContainer);\n    inlineDialog.attr('open', '');\n    inlineDialog.insertAfter($target);\n  }\n\n  createIfNotExists(data) {\n    var $target = $(data.event.target);\n    var uid = $target.data(WEBITEM_UID_KEY);\n\n    if(!uid) {\n      uid = WebItemUtils.uniqueId();\n      $target.data(WEBITEM_UID_KEY, uid);\n    }\n  }\n\n}\n\nlet inlineDialogInstance = new InlineDialogWebItem();\nlet webitem = inlineDialogInstance.getWebItem();\nEventDispatcher.register('before:webitem-invoked:' + webitem.name, inlineDialogInstance.createIfNotExists);\nEventDispatcher.register('webitem-invoked:' + webitem.name, inlineDialogInstance.triggered);\nWebItemActions.addWebItem(webitem);\n\nexport default inlineDialogInstance;","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport LoadingIndicatorActions from 'actions/loading_indicator_actions';\nimport $ from '../dollar';\nimport util from '../util';\n\nconst LOADING_INDICATOR_CLASS = 'ap-status-indicator';\n\nconst LOADING_STATUSES = {\n  loading: '<div class=\"ap-loading\"><div class=\"small-spinner\"></div>Loading add-on...</div>',\n  'load-timeout': '<div class=\"ap-load-timeout><div class=\"small-spinner\"></div>Add-on is not responding. Wait or <a href=\"#\" class=\"ap-btn-cancel\">cancel</a>?</div>',\n  'load-error': 'Add-on failed to load.'\n};\n\nconst LOADING_TIMEOUT = 12000;\n\nclass LoadingIndicator {\n  constructor () {\n    this._stateRegistry = {};\n  }\n\n  _loadingContainer($iframeContainer){\n    return $iframeContainer.find('.' + LOADING_INDICATOR_CLASS);\n  }\n\n  show($iframeContainer, extension) {\n    this._stateRegistry[extension.id] = setTimeout(() => {\n      LoadingIndicatorActions.timeout($iframeContainer, extension);\n    }, LOADING_TIMEOUT);\n    var container = this._loadingContainer($iframeContainer);\n    if(!container.length) {\n      container = $('<div />').addClass(LOADING_INDICATOR_CLASS);\n      container.appendTo($iframeContainer);\n    }\n    container.append(LOADING_STATUSES.loading);\n    var spinner = container.find('.small-spinner');\n    if (spinner.length && spinner.spin) {\n      spinner.spin({lines: 12, length: 3, width: 2, radius: 3, trail: 60, speed: 1.5, zIndex: 1});\n    }\n    return container;\n  }\n\n  hide($iframeContainer, extensionId){\n    clearTimeout(this._stateRegistry[extensionId]);\n    delete this._stateRegistry[extensionId];\n    this._loadingContainer($iframeContainer).hide();\n  }\n\n  cancelled($iframeContainer, extensionId){\n    var status = LOADING_STATUSES['load-error'];\n    this._loadingContainer($iframeContainer).empty().text(status);\n  }\n\n  timeout($iframeContainer, extensionId){\n    var status = $(LOADING_STATUSES['load-timeout']);\n    var container = this._loadingContainer($iframeContainer);\n    container.empty().append(status);\n    $('a.ap-btn-cancel', container).click(function () {\n      LoadingIndicatorActions.cancelled($iframeContainer, extensionId);\n    });\n    delete this._stateRegistry[extensionId];\n    return container;\n  }\n}\n\nvar LoadingComponent = new LoadingIndicator();\n\nEventDispatcher.register('iframe-create', (data) => {\n  LoadingComponent.show(data.$el, data.extension);\n});\nEventDispatcher.register('iframe-bridge-estabilshed', (data) => {\n  LoadingComponent.hide(data.$el, data.extension.id);\n});\nEventDispatcher.register('iframe-bridge-timeout', (data) => {\n  LoadingComponent.timeout(data.$el, data.extension.id);\n});\nEventDispatcher.register('iframe-bridge-cancelled', (data) => {\n  LoadingComponent.cancelled(data.$el, data.extension.id);\n});\n\nexport default LoadingComponent;","import $ from '../dollar';\nimport _ from '../underscore';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\nimport WebItemActions from 'actions/webitem_actions';\nimport WebItemUtils from 'utils/webitem';\nimport InlineDialogWebitem from 'components/inline_dialog_webitem';\nclass WebItem {\n\n  constructor() {\n    this._webitems = {};\n  }\n\n  getWebItemsBySelector(selector) {\n    _.find(this._webitems, function(obj) {\n      if(obj.selector){\n        return obj.selector.trim() === selector.trim();\n      }\n      return false;\n    });\n  }\n\n  setWebItem(potentialWebItem) {\n    return this._webitems[potentialWebItem.name] = {\n      name: potentialWebItem.name,\n      selector: potentialWebItem.selector,\n      triggers: potentialWebItem.triggers\n    };\n\n  }\n\n  _removeTriggers(webitem) {\n    var onTriggers = WebItemUtils.sanitizeTriggers(webitem.triggers);\n    $(() => {\n      $('body').off(onTriggers, webitem.selector, this._webitems[webitem.name]._on);\n    });\n    delete this._webitems[webitem.name]._on;\n  }\n\n  _addTriggers (webitem) {\n    var onTriggers = WebItemUtils.sanitizeTriggers(webitem.triggers);\n    webitem._on = (e) => {\n      console.log('webitem on', webitem, onTriggers);\n      WebItemActions.webitemInvoked(webitem, e);\n      e.preventDefault();\n    };\n    $(() => {\n      $('body').on(onTriggers, webitem.selector, webitem._on);\n    });\n  }\n\n}\n\nvar webItemInstance = new WebItem();\n\nEventDispatcher.register('webitem-added', (data) => {\n  console.log('triggered webitem-added', data);\n  webItemInstance._addTriggers(data.webitem);\n});\n\nmodule.exports = webItemInstance;","import $ from './dollar';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\nimport IframeContainerComponent from 'components/iframe_container';\n\nfunction create(extension) {\n  var simpleXdmExtension = {\n    addon_key: extension.addon_key,\n    key: extension.key,\n    url: extension.url,\n    options: extension.options\n  };\n  return IframeContainerComponent.createExtension(simpleXdmExtension);\n\n  // return IframeComponent.simpleXdmExtension(simpleXdmExtension);\n\n}\n\nmodule.exports = create;","import $ from '../dollar';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\n\nfunction buttonClick(e){\n  EventDispatcher.dispatch('dialog-button-click', $(e.target));\n}\n\nfunction Button(options) {\n  this.$el = $('<button />')\n      .text(options.text)\n      .addClass('aui-button aui-button-' + options.type)\n      .addClass(options.additionalClasses)\n      .data('options',options)\n      .click(buttonClick);\n\n  this.isEnabled = function () {\n    return !(this.$el.attr('aria-disabled') === 'true');\n  };\n\n  this.setEnabled = function (enabled) {\n    //cannot disable a noDisable button\n    if (options.noDisable === true) {\n      return false;\n    }\n    this.$el.attr('aria-disabled', !enabled);\n    return true;\n  };\n\n  this.setEnabled(true);\n\n  this.setText = function (text) {\n    if (text) {\n      this.$el.text(text);\n    }\n  };\n\n}\n\nexport default {\n  render (text, options){\n    var defaults = {\n      type: 'link',\n      additionalClasses: 'ap-dialog-button'\n    };\n\n    return new Button($.extend({text}, defaults, options));\n  }\n}","import $ from '../dollar';\nimport button from './button';\n\nfunction createDialogElement(content, options, chromeless) {\n  var extraClasses = ['ap-aui-dialog2'];\n\n  if (chromeless) {\n    extraClasses.push('ap-aui-dialog2-chromeless');\n  }\n\n  var $el = $(aui.dialog.dialog2({\n    id: options.id,\n    titleText: options.header,\n    titleId: options.titleId,\n    size: options.size,\n    extraClasses: extraClasses,\n    removeOnHide: true,\n    footerActionContent: '<button>a</button><button>b</button>',\n    modal: true\n  }));\n  $el.find('.aui-dialog2-content').append(content);\n\n  if (chromeless) {\n    $el.find('header, footer').hide();\n  } else {\n    var submit = button.render(options.submitText || 'submit', {type: 'primary'});\n    var cancel = button.render(options.cancelText || 'cancel');\n\n    // buttons.submit.setText(options.submitText);\n    // buttons.cancel.setText(options.cancelText);\n    //soy templates don't support sending objects, so make the template and bind them.\n    let footer = $el.find('.aui-dialog2-footer-actions');\n    footer.find('button').remove();\n    footer.append(submit.$el, cancel.$el);\n    // $nexus.data('ra.dialog.buttons', buttons);\n  }\n\n  // function handler(button) {\n  //   // ignore clicks on disabled links\n  //   if (button.isEnabled()) {\n  //     button.$el.trigger('ra.dialog.click', button.dispatch);\n  //   }\n  // }\n\n  // $.each(buttons, function (i, button) {\n  //   button.$el.click(function () {\n  //     handler(button);\n  //   });\n  // });\n\n  return $el;\n}\n\nmodule.exports = {\n  render: createDialogElement\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\n\nconst EVENT_NAME_PREFIX = 'connect.addon.';\n\n/**\n * Timings beyond 20 seconds (connect's load timeout) will be clipped to an X.\n * @const\n * @type {int}\n */\nconst LOADING_TIME_THRESHOLD = 20000;\n\n/**\n * Trim extra zeros from the load time.\n * @const\n * @type {int}\n */\nconst LOADING_TIME_TRIMP_PRECISION = 100;\n\n\nclass AnalyticsDispatcher {\n\n  constructor() {\n    this._addons = {};\n  }\n\n  _track(name, data) {\n    var w = window;\n    var prefixedName = EVENT_NAME_PREFIX + name;\n\n    if(w.AJS.Analytics){\n      w.AJS.Analytics.triggerPrivacyPolicySafeEvent(prefixedName, data);\n    } else if(w.AJS.trigger) {\n      // BTF fallback\n      AJS.trigger('analyticsEvent', {\n        name: prefixedName,\n        data: data\n      });\n    } else {\n      return false;\n    }\n    return true;\n  }\n\n  _time() {\n    return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();\n  }\n\n  trackLoadingStarted(extension) {\n    extension.startLoading = this._time();\n    this._addons[extension.id] = extension;\n  }\n\n  trackLoadingEnded(extension) {\n    var value = this._time() - this._addons[extension.id].startLoading;\n    this._track('iframe.performance.load', {\n      addonKey: extension.addon_key,\n      moduleKey: extension.key,\n      value: value > LOADING_TIME_THRESHOLD ? 'x' : Math.ceil((value) / LOADING_TIME_TRIMP_PRECISION)\n    });\n  }\n\n  trackLoadingTimeout(extension) {\n    this._track('iframe.performance.timeout', {\n      addonKey: extension.addon_key,\n      moduleKey: extension.key\n    });\n    //track an end event during a timeout so we always have complete start / end data.\n    this.trackLoadingEnded(extension);\n  }\n\n  trackLoadingCancel(extension) {\n    this._track('iframe.performance.cancel', {\n      addonKey: extension.addon_key,\n      moduleKey: extension.key\n    });\n  }\n\n  dispatch(name, data) {\n    this._track(name, data);\n  }\n}\n\nvar analytics = new AnalyticsDispatcher();\nEventDispatcher.register('iframe-create', function(data) {\n  analytics.trackLoadingStarted(data.extension);\n});\nEventDispatcher.register('iframe-bridge-estabilshed', function(data) {\n  analytics.trackLoadingEnded(data.extension);\n});\nEventDispatcher.register('iframe-bridge-timeout', function (data) {\n  analytics.trackLoadingTimeout(data.extension);\n});\nEventDispatcher.register('iframe-bridge-cancelled', function(data) {\n  analytics.trackLoadingCancel(data.extension);\n});\n\nmodule.exports = analytics;","/**\n* pub/sub for extension state (created, destroyed, initialized)\n* taken from hipchat webcore\n**/\nimport _ from '../underscore';\nimport {EventEmitter} from 'events';\n\nclass EventDispatcher extends EventEmitter {\n\n  constructor() {\n    super();\n    this.setMaxListeners(20);\n  }\n\n  dispatch(action, ...args) {\n    this.emit.apply(this, ['before:' + action].concat(args));\n    this.emit.apply(this, arguments);\n    this.emit.apply(this, ['after:' + action].concat(args));\n  }\n\n  registerOnce(action, callback) {\n    if (_.isString(action)) {\n      this.once(action, callback);\n    } else if (_.isObject(action)) {\n      _.keys(action).forEach((val, key) => {\n        this.once(key, val);\n      }, this);\n    }\n  }\n\n  register(action, callback) {\n    if (_.isString(action)) {\n      this.on(action, callback);\n    } else if (_.isObject(action)) {\n      _.keys(action).forEach((val, key) => {\n        this.on(key, val);\n      }, this);\n    }\n  }\n\n  unregister(action, callback) {\n    if (_.isString(action)) {\n      this.removeListener(action, callback);\n    } else if (_.isObject(action)) {\n      _.keys(action).forEach((val, key) => {\n        this.removeListener(key, val);\n      }, this);\n    }\n  }\n}\n\nmodule.exports = new EventDispatcher();","/**\n * The iframe-side code exposes a jquery-like implementation via _dollar.\n * This runs on the product side to provide AJS.$ under a _dollar module to provide a consistent interface\n * to code that runs on host and iframe.\n */\nexport default AJS.$;","import AnalyticsDispatcher from 'dispatchers/analytics_dispatcher';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\nimport simpleXDM from 'simple-xdm/dist/host';\nimport jwtActions from 'actions/jwt_actions';\nimport events from './modules/events';\nimport create from './create';\nimport dialog from './modules/dialog';\nimport env from './modules/env';\nimport loadingIndicator from './components/loading_indicator';\nimport messages from './modules/messages';\nimport ModuleActions from 'actions/module_actions';\nimport DomEventActions from 'actions/dom_event_actions';\nimport _ from 'underscore';\nimport EventActions from 'actions/event_actions';\nimport IframeActions from 'actions/iframe_actions';\nimport WebItemComponent from 'components/webitem';\n// import propagator from './propagate/rpc';\n\n/**\n * Private namespace for host-side code.\n * @type {*|{}}\n * @private\n * @deprecated use AMD instead of global namespaces. The only thing that should be on _AP is _AP.define and _AP.require.\n */\nif (!window._AP) {\n  window._AP = {};\n}\n\nsimpleXDM.defineModule('messages', messages);\nsimpleXDM.defineModule('dialog', dialog);\nsimpleXDM.defineModule('env', env);\nsimpleXDM.defineModule('events', events);\n\n// rpc.extend(propagator);\n\nEventDispatcher.register(\"module-define-custom\", function(data){\n  simpleXDM.defineModule(data.name, data.methods);\n});\n\nsimpleXDM.registerRequestNotifier(function(data){\n  AnalyticsDispatcher.dispatch('bridge.invokemethod', {\n    module: data.module,\n    fn: data.fn,\n    addonKey: data.addon_key,\n    moduleKey: data.key\n  });\n});\n\nexport default {\n  onKeyEvent: (extension_id, key, modifiers, callback) => {\n    DomEventActions.registerKeyEvent({extension_id, key, modifiers, callback});\n  },\n  offKeyEvent: (extension_id, key, modifiers, callback) => {\n    DomEventActions.unregisterKeyEvent({extension_id, key, modifiers, callback});\n  },\n  onIframeEstablished: (callback) => {\n    EventDispatcher.register(\"after:iframe-bridge-estabilshed\", function(data) {\n      callback.call(null, {\n        $el: data.$el,\n        extension: _.pick(data.extension, [\"id\", \"addon_key\", \"id\", \"key\", \"options\", \"url\"])\n      });\n    });\n  },\n  destroy: function(extension_id){\n    IframeActions.notifyIframeDestroyed({extension_id: extension_id});\n  },\n  registerContentResolver: {\n    resolveByExtension: (callback) => {\n      jwtActions.registerContentResolver({callback: callback});\n    }\n  },\n  defineModule: (name, methods) => {\n    ModuleActions.defineCustomModule(name, methods);\n  },\n  broadcastEvent: (type, targetSpec, event) => {\n    EventActions.broadcast(type, targetSpec, event);\n  },\n  create\n};","import EventDispatcher from 'dispatchers/event_dispatcher';\nimport dialogRenderer from '../dialog/renderer';\nimport create from '../create';\n\nfunction isConnectDialog($el) {\n  return ($el && $el.hasClass('ap-aui-dialog2'));\n}\n\nfunction keyPressListener(e) {\n  var topLayer;\n  if(e.keyCode === 27) {\n    topLayer = AJS.LayerManager.global.getTopLayer();\n    if(isConnectDialog(topLayer)) {\n      getActiveDialog().hide();\n    }\n  }\n}\n\n// $(document).on('keydown', keyPressListener);\n\nEventDispatcher.on('dialog-button-click', function($el){\n  var buttonOptions = $el.data('options');\n  console.log('button options?', buttonOptions, $el);\n  getActiveDialog().hide();\n});\n\nfunction getActiveDialog(){\n  return AJS.dialog2(AJS.LayerManager.global.getTopLayer());\n}\n\nfunction closeDialog(data){\n  EventDispatcher.dispatch('dialog-close', data);\n}\n\nfunction dialogIframe(options, context) {\n  return create({\n    addon_key: context.extension.addon_key,\n    key: options.key,\n    // url: options.url\n    url: 'http://cwhittington:8000/iframe-dialog-content.html'\n  });\n}\n\nmodule.exports = {\n  create: function(options, callback) {\n    var iframe = dialogIframe(options, callback._context);\n    var dialogDOM = dialogRenderer.render(iframe, options, options.chrome);\n\n    var dialog = AJS.dialog2(dialogDOM);\n    dialog.show();\n    EventDispatcher.dispatch('dialog-open', {\n      $el: iframe,\n      $dialog: dialog\n    });\n\n    dialog.on('hide', closeDialog);\n  },\n  close: function(data){\n    closeDialog();\n  },\n  isDialog: true,\n  onDialogMessage: function (message, listener) {\n\n  },\n  getButton: function(name, callback){\n    callback({\n      name: name\n      // bind: function(){\n      //   console.log('called!');\n      // },\n      // disable: function(){}\n    });\n  }\n};","import $ from '../dollar';\nimport EnvActions from 'actions/env_actions';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\nimport util from '../util';\n\nvar debounce = AJS.debounce || $.debounce;\n\nexport default {\n  getLocation: function (callback) {\n    callback(window.location.href);\n  },\n  resize: debounce(function(width, height, callback) {\n    EnvActions.iframeResize(width, height, callback._context);\n  }),\n\n  sizeToParent: debounce(function (callback) {\n    // sizeToParent is only available for general-pages\n    if (callback._context.extension.options.isFullPage) {\n      // This adds border between the iframe and the page footer as the connect addon has scrolling content and can't do this\n      util.getIframeByExtensionId(callback._context.extension_id).addClass('full-size-general-page');\n      EventDispatcher.register('host-window-resize', (data) => {\n        EnvActions.sizeToParent(callback._context);\n      });\n      EnvActions.sizeToParent(callback._context);\n    } else {\n      // This is only here to support integration testing\n      // see com.atlassian.plugin.connect.test.pageobjects.RemotePage#isNotFullSize()\n      $(this.iframe).addClass('full-size-general-page-fail');\n    }\n  })\n};","import $ from '../dollar';\nimport _ from '../underscore';\nimport EventDispatcher from 'dispatchers/event_dispatcher';\n\n// Note that if it's desireable to publish host-level events to add-ons, this would be a good place to wire\n// up host listeners and publish to each add-on, rather than using each XdmRpc.events object directly.\n\nvar _channels = {};\n\n// create holding object under _channels.\nEventDispatcher.register('iframe-bridge-estabilshed', (data) => {\n  if(!_.isObject(_channels[data.extension.addon_key])) {\n    _channels[data.extension.addon_key] = {\n      _any: []\n    };\n  }\n\n  if(!_.isObject(_channels[data.extension.addon_key][data.extension.id])) {\n    _channels[data.extension.addon_key][data.extension.id] = {};\n  }\n});\n\nexport default {\n  emit: function(name, ...args) {\n    var callback = _.last(args);\n    args = _.first(args, -1);\n\n    let extensions = _channels[callback._context.extension.addon_key];\n    let extensionIds = _.without(_.keys(extensions), '_any');\n    let events = [].concat(extensions._any);\n\n    extensionIds.forEach((extensionId) => {\n      var listeners = extensions[extensionId][name];\n      if(_.isArray(listeners)) {\n        events = events.concat(listeners);\n      }\n    }, this);\n\n    events.forEach((event) => {\n      try {\n        event.apply(null, args);\n      } catch (e) {\n        console.error(e.stack || e.message || e);\n      }\n    }, this);\n  },\n  off: function(name, callback) {\n    var all =  _channels[callback._context.extension.addon_key][callback._context.extension_id][name];\n    if (all) {\n      var i = $.inArray(callback, all);\n      if (i >= 0) {\n        all.splice(i, 1);\n      }\n    }\n  },\n  offAll: function(name){\n\n  },\n  offAny: function(name){\n\n  },\n  on: function (name, callback){\n    var addonKey = callback._context.extension.addon_key;\n    var extensionId = callback._context.extension_id;\n\n    if(!_.isArray(_channels[addonKey][extensionId][name])) {\n      _channels[addonKey][extensionId][name] = [];\n    }\n    _channels[addonKey][extensionId][name].push(callback);\n  },\n  onAny: function(callback){\n    _channels[addonKey]._any.push(callback);\n  },\n  once: function (name, callback){\n    var interceptor = () => {\n      this.off(name, interceptor);\n      callback.apply(null, arguments);\n    };\n    interceptor._context = callback._context;\n    this.on(name, interceptor);\n  }\n\n};","import $ from '../dollar';\nimport _ from '../underscore';\n\nvar MESSAGE_BAR_ID = 'ac-message-container';\nvar MESSAGE_TYPES = ['generic', 'error', 'warning', 'success', 'info', 'hint'];\nvar messageId = 0;\n\nfunction validateMessageId(msgId) {\n  return msgId.search(/^ap\\-message\\-[0-9]+$/) === 0;\n}\n\nfunction getMessageBar() {\n  var msgBar = $('#' + MESSAGE_BAR_ID);\n\n  if (msgBar.length < 1) {\n    msgBar = $('<div id=\"' + MESSAGE_BAR_ID + '\" />').appendTo('body');\n  }\n  return msgBar;\n}\n\nfunction filterMessageOptions(options) {\n  var i;\n  var key;\n  var copy = {};\n  var allowed = ['closeable', 'fadeout', 'delay', 'duration', 'id'];\n  if(_.isObject(options)){\n    for (i in allowed) {\n      key = allowed[i];\n      if (key in options) {\n        copy[key] = options[key];\n      }\n    }\n  }\n  return copy;\n}\n\nfunction showMessage(name, title, bodyHTML, options) {\n  var msgBar = getMessageBar();\n  options = filterMessageOptions(options);\n  $.extend(options, {\n    title: title,\n    body: AJS.escapeHtml(bodyHTML)\n  });\n\n  if ($.inArray(name, MESSAGE_TYPES) < 0) {\n    throw 'Invalid message type. Must be: ' + MESSAGE_TYPES.join(', ');\n  }\n  if (validateMessageId(options.id)) {\n    AJS.messages[name](msgBar, options);\n    // Calculate the left offset based on the content width.\n    // This ensures the message always stays in the centre of the window.\n    msgBar.css('margin-left', '-' + msgBar.innerWidth() / 2 + 'px');\n  }\n}\n\nvar toExport = {\n  clear(id) {\n    if (validateMessageId(id)) {\n      $('#' + id).remove();\n    }\n  }\n};\n\nMESSAGE_TYPES.forEach((messageType) => {\n  toExport[messageType] = function(title, body, options, callback) {\n    if(options._context) {\n      options = {};\n    }\n    messageId++;\n    options.id = 'ap-message-' + messageId;\n    return showMessage(messageType, title, body, options);\n  };\n}, this);\n\n\nexport default toExport;","// AUI includes underscore and exposes it globally.\nexport default window._;","import _ from './underscore';\n\nfunction escapeSelector(s) {\n  if (!s) {\n    throw new Error('No selector to escape');\n  }\n  return s.replace(/[!\"#$%&'()*+,.\\/:;<=>?@[\\\\\\]^`{|}~]/g, '\\\\$&');\n}\n\nfunction stringToDimension(value) {\n  var percent = false;\n  var unit = 'px';\n\n  if(_.isString(value)) {\n    percent = value.indexOf('%') === value.length - 1;\n    value = parseInt(value, 10);\n    if (percent) {\n      unit = '%';\n    }\n  }\n\n  if(!isNaN(value)) {\n    return value + unit;\n  }\n}\n\nfunction getIframeByExtensionId(id) {\n  return AJS.$('iframe#' + escapeSelector(id));\n}\n\nexport default {\n  escapeSelector,\n  stringToDimension,\n  getIframeByExtensionId\n};","import base64 from 'base-64';\nimport utf8 from 'utf8';\n\nfunction parseJwtIssuer(jwt) {\n  return parseJwtClaims(jwt)['iss'];\n}\n\nfunction parseJwtClaims(jwt) {\n\n  if (null === jwt || '' === jwt) {\n    throw('Invalid JWT: must be neither null nor empty-string.');\n  }\n\n  var firstPeriodIndex = jwt.indexOf('.');\n  var secondPeriodIndex = jwt.indexOf('.', firstPeriodIndex + 1);\n\n  if (firstPeriodIndex < 0 || secondPeriodIndex <= firstPeriodIndex) {\n    throw('Invalid JWT: must contain 2 period (\".\") characters.');\n  }\n\n  var encodedClaims = jwt.substring(firstPeriodIndex + 1, secondPeriodIndex);\n\n  if (null === encodedClaims || '' === encodedClaims) {\n    throw('Invalid JWT: encoded claims must be neither null nor empty-string.');\n  }\n\n  var claimsString = utf8.decode(base64.decode.call(window, encodedClaims));\n  return JSON.parse(claimsString);\n}\n\nfunction isJwtExpired(jwtString, skew) {\n  if (skew === undefined) {\n    skew = 60; // give a minute of leeway to allow clock skew\n  }\n  var claims = parseJwtClaims(jwtString);\n  var expires = 0;\n  var now = Math.floor(Date.now() / 1000); // UTC timestamp now\n\n  if (claims && claims.exp) {\n    expires = claims.exp;\n  }\n\n  if ((expires - now) < skew) {\n    return true;\n  }\n\n  return false;\n\n}\n\nexport default {\n  parseJwtIssuer,\n  parseJwtClaims,\n  isJwtExpired\n}","import jsuri from 'jsuri';\nimport jwtUtil from 'utils/jwt';\n\nfunction isJwtExpired(urlStr) {\n  var jwtStr = _getJwt(urlStr);\n  return jwtUtil.isJwtExpired(jwtStr);\n}\n\nfunction _getJwt(urlStr) {\n  var url = new jsuri(urlStr);\n  return url.getQueryParamValue('jwt');\n}\n\nfunction hasJwt(url) {\n  var jwt = _getJwt(url);\n  return (jwt && _getJwt(url).length !== 0);\n\n}\n\nmodule.exports = {\n  hasJwt,\n  isJwtExpired\n}","import _ from '../underscore';\n\nfunction sanitizeTriggers(triggers) {\n  var onTriggers;\n  if(_.isArray(triggers)) {\n    onTriggers = triggers.join(' ');\n  } else if (_.isString(triggers)) {\n    onTriggers = triggers.trim();\n  }\n  return onTriggers;\n}\n\nfunction uniqueId(){\n  return 'webitem-' + Math.floor(Math.random() * 1000000000).toString(16);\n}\n\n// LEGACY: get addon key by webitem for p2\nfunction getExtensionKey($target){\n  var cssClass = $target.attr('class');\n  var m = cssClass ? cssClass.match(/ap-plugin-key-([^\\s]*)/) : null;\n  return _.isArray(m) ? m[1] : false;\n}\n\n// LEGACY: get module key by webitem for p2\nfunction getKey($target){\n  var cssClass = $target.attr('class');\n  var m = cssClass ? cssClass.match(/ap-module-key-([^\\s]*)/) : null;\n  return _.isArray(m) ? m[1] : false;\n}\n\n// LEGACY - method for handling webitem options for p2\nfunction getOptionsForWebItem($target) {\n  var moduleKey = getKey($target);\n  var type = $target.hasClass('ap-inline-dialog') ? 'inlineDialog' : 'dialog';\n  return window._AP[type + 'Options'][moduleKey] || {};\n}\n\n\nmodule.exports = {\n  sanitizeTriggers,\n  uniqueId,\n  getExtensionKey,\n  getKey,\n  getOptionsForWebItem\n};","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import XDMRPC from './xdmrpc';\nimport Utils from '../common/util';\n\nclass Connect {\n\n  constructor() {\n    this._xdm = new XDMRPC();\n  }\n\n  /**\n   * Send a message to iframes matching the targetSpec. This message is added to\n   *  a message queue for delivery to ensure the message is received if an iframe \n   *  has not yet loaded\n   * \n   * @param type The name of the event type\n   * @param targetSpec The spec to match against extensions when sending this event\n   * @param event The event payload\n   * @param callback A callback to be executed when the remote iframe calls its callback\n   */\n  dispatch(type, targetSpec, event, callback) {\n    this._xdm.queueEvent(type, targetSpec, event, callback);\n    return this.getExtensions(targetSpec);\n  }\n  \n  /**\n   * Send a message to iframes matching the targetSpec immediately. This message will \n   *  only be sent to iframes that are already open, and will not be delivered if none\n   *  are currently open.\n   * \n   * @param type The name of the event type\n   * @param targetSpec The spec to match against extensions when sending this event\n   * @param event The event payload\n   */\n  broadcast(type, targetSpec, event) {\n    this._xdm.dispatch(type, targetSpec, event, null, null);\n    return this.getExtensions(targetSpec);    \n  }\n\n  _createId(extension) {\n    if(!extension.addon_key || !extension.key){\n      throw Error('Extensions require addon_key and key');\n    }\n    return extension.addon_key + '__' + extension.key + '__' + Utils.randomString();\n  }\n  /**\n  * Creates a new iframed module, without actually creating the DOM element.\n  * The iframe attributes are passed to the 'setupCallback', which is responsible for creating\n  * the DOM element and returning the window reference.\n  *\n  * @param extension The extension definition. Example:\n  *   {\n  *     addon_key: 'my-addon',\n  *     key: 'my-module',\n  *     url: 'https://example.com/my-module',\n  *     options: { autoresize: false }\n  *   }\n  *\n  * @param initCallback The optional initCallback is called when the bridge between host and iframe is established.\n  **/\n  create(extension, initCallback) {\n    let extension_id = this.registerExtension(extension, initCallback);\n\n    let data = {\n      extension_id: extension_id,\n      api: this._xdm.getApiSpec(),\n      origin: Utils.locationOrigin(),\n      options: extension.options || {}\n    };\n\n    return {\n      id: extension_id,\n      name: JSON.stringify(data),\n      src: extension.url\n    };\n  }\n\n  registerRequestNotifier(callback) {\n    this._xdm.registerRequestNotifier(callback);\n  }\n\n  registerExtension(extension, initCallback) {\n    let extension_id = this._createId(extension);\n    this._xdm.registerExtension(extension_id, {\n      extension: extension,\n      initCallback: initCallback\n    });\n    return extension_id;\n  }\n\n  registerKeyListener(extension_id, key, modifiers, callback) {\n    this._xdm.registerKeyListener(extension_id, key, modifiers, callback);\n  }\n\n  unregisterKeyListener(extension_id, key, modifiers, callback) {\n   this._xdm.unregisterKeyListener(extension_id, key, modifiers, callback);\n  }\n\n  defineModule(moduleName, module) {\n    this._xdm.defineAPIModule(module, moduleName);\n  }\n\n  defineGlobals(module) {\n    this._xdm.defineAPIModule(module);\n  }\n\n  getExtensions(filter) {\n    return this._xdm.getRegisteredExtensions(filter);\n  }\n\n  unregisterExtension(filter) {\n    return this._xdm.unregisterExtension(filter);\n  }\n\n}\n\nmodule.exports = new Connect();","import Util from './util';\nclass PostMessage {\n\n  constructor(data) {\n    let d = data || {};\n    this._registerListener(d.listenOn);\n  }\n\n // listen for postMessage events (defaults to window).\n  _registerListener(listenOn) {\n    if(!listenOn || !listenOn.addEventListener) {\n      listenOn = window;\n    }\n    listenOn.addEventListener(\"message\", Util._bind(this, this._receiveMessage), false);\n  }\n\n  _receiveMessage (event) {\n    let extensionId = event.data.eid,\n    reg;\n\n    if(extensionId && this._registeredExtensions){\n      reg = this._registeredExtensions[extensionId];\n    }\n\n    if (!this._checkOrigin(event, reg)) {\n      return false;\n    }\n\n    var handler = this._messageHandlers[event.data.type];\n    if (handler) {\n      handler.call(this, event, reg);\n    }\n  }\n\n}\n\nmodule.exports = PostMessage;","const LOG_PREFIX = \"[Simple-XDM] \";\n\nclass Util {\n\n  locationOrigin() {\n    if (!window.location.origin) {\n      return window.location.protocol + \"//\" + window.location.hostname + ( window.location.port ? ':' + window.location.port : '' );\n    } else {\n      return window.location.origin;\n    }\n  }\n\n  randomString() {\n    return Math.floor(Math.random() * 1000000000).toString(16);\n  }\n\n  isString(str) {\n    return typeof str === \"string\" || str instanceof String;\n  }\n\n  argumentsToArray(arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n  }\n\n  hasCallback(args) {\n    var length = args.length;\n    return length > 0 && typeof args[length - 1] === 'function';\n  }\n\n  error(msg) {\n      if (window.console) {\n          console.error(LOG_PREFIX + msg);\n      }\n  }\n\n  warn(msg) {\n      if (window.console) {\n          console.warn(LOG_PREFIX + msg);\n      }\n  }\n\n  _bind(thisp, fn){\n    if(Function.prototype.bind) {\n      return fn.bind(thisp);\n    }\n    return function () {\n      return fn.apply(thisp, arguments);\n    };\n  }\n\n  each(o, it) {\n    var l;\n    var k;\n    if (o) {\n      l = o.length;\n      if (l != null && typeof o !== 'function') {\n        k = 0;\n        while (k < l) {\n          if (it.call(o[k], k, o[k]) === false){\n            break;\n          }\n          k += 1;\n        }\n      } else {\n        for (k in o) {\n          if (o.hasOwnProperty(k)) {\n            if (it.call(o[k], k, o[k]) === false){\n              break;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  extend(dest) {\n    var args = arguments;\n    var srcs = [].slice.call(args, 1, args.length);\n    srcs.forEach(function(source) {\n      if(typeof source === \"object\") {\n        Object.getOwnPropertyNames(source).forEach(function (name) {\n          dest[name] = source[name];\n        });\n      }\n    });\n    return dest;\n  }\n\n}\n\nmodule.exports = new Util();","/**\n* Postmessage format:\n*\n* Initialization\n* --------------\n* {\n*   type: 'init',\n*   eid: 'my-addon__my-module-xyz'  // the extension identifier, unique across iframes\n* }\n*\n* Request\n* -------\n* {\n*   type: 'req',\n*   eid: 'my-addon__my-module-xyz',  // the extension identifier, unique for iframe\n*   mid: 'xyz',  // a unique message identifier, required for callbacks\n*   mod: 'cookie',  // the module name\n*   fn: 'read',  // the method name\n*   args: [arguments]  // the method arguments\n* }\n*\n* Response\n* --------\n* {\n*   type: 'resp'\n*   eid: 'my-addon__my-module-xyz',  // the extension identifier, unique for iframe\n*   mid: 'xyz',  // a unique message identifier, obtained from the request\n*   args: [arguments]  // the callback arguments\n* }\n*\n* Event\n* -----\n* {\n*   type: 'evt',\n*   etyp: 'some-event',\n*   evnt: { ... }  // the event data\n*   mid: 'xyz', // a unique message identifier for the event\n* }\n**/\n\nimport Utils from '../common/util';\nimport PostMessage from '../common/postmessage';\n\nlet VALID_EVENT_TIME_MS = 30000; //30 seconds\n\nclass XDMRPC extends PostMessage {\n\n  constructor(config) {\n    config = config || {};\n    super(config);\n    this._registeredExtensions = config.extensions || {};\n    this._registeredAPIModules = {};\n    this._pendingCallbacks = {};\n    this._keycodeCallbacks = {};\n    this._pendingEvents = {};\n    this._messageHandlers = {\n      init: this._handleInit,\n      req: this._handleRequest,\n      resp: this._handleResponse,\n      event_query: this._handleEventQuery,\n      broadcast: this._handleBroadcast,\n      key_listen: this._handleKeyListen\n    };\n  }\n\n  _handleInit(event, reg) {\n    this._registeredExtensions[reg.extension_id].source = event.source;\n    if (reg.initCallback) {\n      reg.initCallback(event.data.eid);\n      delete reg.initCallback;\n    }\n  }\n\n  _handleResponse(event) {\n    var data = event.data;\n    var pendingCallback = this._pendingCallbacks[data.mid];\n    if (pendingCallback) {\n      delete this._pendingCallbacks[data.mid];\n      pendingCallback.apply(window, data.args);\n    }\n  }\n\n  registerRequestNotifier(cb) {\n    this._registeredRequestNotifier = cb;\n  }\n\n  _handleRequest(event, reg) {\n    function sendResponse() {\n      var args = Utils.argumentsToArray(arguments);\n      event.source.postMessage({\n        mid: event.data.mid,\n        type: 'resp',\n        args: args\n      }, reg.extension.url);\n    }\n\n    var data = event.data;\n    var module = this._registeredAPIModules[data.mod];\n    if (module) {\n      var method = module[data.fn];\n      if (method) {\n        var methodArgs = data.args;\n        sendResponse._context = this.getRegisteredExtensions(reg.extension)[0];\n        methodArgs.push(sendResponse);\n        method.apply(module, methodArgs);\n        if(this._registeredRequestNotifier) {\n          this._registeredRequestNotifier.call(null, {\n            module: data.mod,\n            fn: data.fn,\n            type: data.type,\n            addon_key: reg.extension.addon_key,\n            key: reg.extension.key,\n            extension_id: reg.extension_id\n          });\n        }\n      }\n    }\n  }\n\n  _handleBroadcast(event, reg) {\n    var event_data = event.data;\n    var targetSpec = r => r.extension.addon_key === reg.extension.addon_key && r.extension_id !== reg.extension_id;\n    this.dispatch(event_data.etyp, targetSpec, event_data.evnt, null, null);\n  }\n\n  _handleKeyListen(event, reg) {\n    var eventData = event.data;\n    var keycodeEntry = this._keycodeKey(eventData.keycode, eventData.modifiers, reg.extension_id);\n    var listeners = this._keycodeCallbacks[keycodeEntry];\n    if(listeners) {\n      listeners.forEach((listener) => {\n        listener.call(null, {\n          addon_key: reg.extension.addon_key,\n          key: reg.extension.key,\n          extension_id: reg.extension_id,\n          keycode: eventData.keycode,\n          modifiers: eventData.modifiers\n        });\n      }, this);\n    }\n  }\n\n  defineAPIModule(module, moduleName){\n    if(moduleName){\n      this._registeredAPIModules[moduleName] = module;\n    } else {\n      this._registeredAPIModules._globals = Utils.extend({}, this._registeredAPIModules._globals, module);\n    }\n    return this._registeredAPIModules;\n  }\n\n  _fullKey(targetSpec){\n    var key = targetSpec.addon_key || 'global';\n    if(targetSpec.key){\n      key = `${key}@@${targetSpec.key}`;\n    }\n\n    return key;\n  }\n\n  queueEvent(type, targetSpec, event, callback) {\n    var loaded_frame,\n    targets = this._findRegistrations(targetSpec);\n\n    loaded_frame = targets.some((target) => {\n      return target.registered_events !== undefined;\n    }, this);\n\n    if(loaded_frame){\n      this.dispatch(type, targetSpec, event, callback);\n    } else {\n      this._pendingEvents[this._fullKey(targetSpec)] = {\n        type,\n        targetSpec,\n        event,\n        callback,\n        time: new Date().getTime(),\n        uid: Utils.randomString()\n      };\n    }\n  }\n\n  _handleEventQuery(message, extension) {\n    let executed = {};\n    let now = new Date().getTime();\n    let keys = Object.keys(this._pendingEvents);\n    keys.forEach((index) => {\n      let element = this._pendingEvents[index];\n      let eventIsValid = (now - element.time) <= VALID_EVENT_TIME_MS;\n      let isSameTarget = !element.targetSpec || this._findRegistrations(element.targetSpec).length !== 0;\n\n      if (eventIsValid && isSameTarget) {\n        executed[index] = element;\n        element.targetSpec = element.targetSpec || {};\n        element.targetSpec.addon_key = extension.extension.addon_key;\n        element.targetSpec.key = extension.extension.key;\n        this.dispatch(element.type, element.targetSpec, element.event, element.callback, message.source);\n      } else if (!eventIsValid) {\n        delete this._pendingEvents[index];\n      }\n    });\n\n    this._registeredExtensions[extension.extension_id].registered_events = message.data.args;\n\n    return executed;\n  }\n\n  dispatch(type, targetSpec, event, callback, source) {\n    function sendEvent(reg, evnt) {\n      if (reg.source) {\n        var mid;\n        if (callback) {\n          mid = Utils.randomString();\n          this._pendingCallbacks[mid] = callback;\n        }\n\n        reg.source.postMessage({\n          type: 'evt',\n          mid: mid,\n          etyp: type,\n          evnt: evnt\n        }, reg.extension.url);\n      } else {\n        throw \"Cannot send post message without a source\";\n      }\n    }\n\n    var registrations = this._findRegistrations(targetSpec || {});\n    registrations.forEach(function (reg) {\n      if(source){\n        reg.source = source;\n      }\n      Utils._bind(this, sendEvent)(reg, event);\n    }, this);\n  }\n\n  _findRegistrations(targetSpec) {\n    if(this._registeredExtensions.length === 0){\n      Utils.error('no registered extensions', this._registeredExtensions);\n      return [];\n    }\n    var keys = Object.getOwnPropertyNames(targetSpec);\n    var registrations = Object.getOwnPropertyNames(this._registeredExtensions).map((key) => {\n      return this._registeredExtensions[key];\n    });\n\n    if (targetSpec instanceof Function) {\n      return registrations.filter(targetSpec);\n    } else {\n      return registrations.filter(function (reg) {\n        return keys.every(function (key) {\n          return reg.extension[key] === targetSpec[key];\n        });\n      });\n    }\n  }\n\n  registerExtension(extension_id, data) {\n    // delete duplicate registrations\n    if(data.extension.addon_key && data.extension.key){\n      let existingView = this._findRegistrations({\n        addon_key: data.extension.addon_key,\n        key: data.extension.key\n      });\n      if(existingView.length !== 0){\n        delete this._registeredExtensions[existingView[0].extension_id];\n      }\n    }\n    data.extension_id = extension_id;\n    this._registeredExtensions[extension_id] = data;\n  }\n\n  _keycodeKey(key, modifiers, extension_id) {\n    var code = key;\n\n    if(modifiers) {\n      if(typeof modifiers === \"string\") {\n        modifiers = [modifiers];\n      }\n      modifiers.sort();\n      modifiers.forEach((modifier) => {\n        code += '$$' + modifier;\n      }, this);\n    }\n\n    return code + '__' + extension_id;\n  }\n\n  registerKeyListener(extension_id, key, modifiers, callback) {\n    if(typeof modifiers === \"string\") {\n      modifiers = [modifiers];\n    }\n    var extension = this._registeredExtensions[extension_id];\n    var keycodeEntry = this._keycodeKey(key, modifiers, extension_id);\n    if(!this._keycodeCallbacks[keycodeEntry]) {\n      this._keycodeCallbacks[keycodeEntry] = [];\n      extension.source.postMessage({\n        type: 'key_listen',\n        keycode: key,\n        modifiers: modifiers,\n        action: 'add'\n      }, extension.source.location.href);\n    }\n    this._keycodeCallbacks[keycodeEntry].push(callback);\n  }\n\n  unregisterKeyListener(extension_id, key, modifiers, callback) {\n    var keycodeEntry = this._keycodeKey(key, modifiers, extension_id);\n    var potentialCallbacks = this._keycodeCallbacks[keycodeEntry];\n    var extension = this._registeredExtensions[extension_id];\n\n    if(potentialCallbacks) {\n      if(callback) {\n        var index = potentialCallbacks.indexOf(callback);\n         this._keycodeCallbacks[keycodeEntry].splice(index, 1);\n      } else {\n        delete this._keycodeCallbacks[keycodeEntry];\n      }\n\n      extension.source.postMessage({\n        type: 'key_listen',\n        keycode: key,\n        modifiers: modifiers,\n        action: 'remove'\n      }, extension.source.location.href);\n    }\n  }\n\n  getApiSpec() {\n    let that = this;\n    function createModule(moduleName) {\n      var module = that._registeredAPIModules[moduleName];\n      if(!module){\n        throw new Error(\"unregistered API module: \" + moduleName);\n      }\n      return Object.getOwnPropertyNames(module).reduce((accumulator, functionName) => {\n          if (typeof module[functionName] === 'function') {\n              accumulator[functionName] = {}; // could hold function metadata, empty for now\n          }\n          return accumulator;\n      }, {});\n    }\n    return Object.getOwnPropertyNames(this._registeredAPIModules).reduce((accumulator, moduleName) => {\n        accumulator[moduleName] = createModule(moduleName);\n        return accumulator;\n    }, {});\n  }\n\n\n  // validate origin of postMessage\n  _checkOrigin(event, reg) {\n    let no_source_types = ['init', 'event_query'];\n    let isNoSourceType = reg && !reg.source && no_source_types.indexOf(event.data.type) > -1;\n    let sourceTypeMatches = reg && event.source === reg.source;\n    let hasExtensionUrl = reg && reg.extension.url.indexOf(event.origin) === 0;\n    let isValidOrigin = hasExtensionUrl && (isNoSourceType || sourceTypeMatches);\n    if(!isValidOrigin) {\n        Utils.warn(\"Failed to validate origin: \" + event.origin);\n    }\n    return isValidOrigin;\n  }\n\n  getRegisteredExtensions(filter) {\n    if(filter) {\n      return this._findRegistrations(filter);\n    }\n    return this._registeredExtensions;\n  }\n\n  unregisterExtension(filter) {\n    let registrations = this._findRegistrations(filter);\n    if(registrations.length !== 0){\n      registrations.forEach(function(registration) {\n        let keys = Object.keys(this._pendingEvents);\n        keys.forEach((index) => {\n          let element = this._pendingEvents[index];\n          let targetSpec = element.targetSpec || {};\n\n          if (targetSpec.addon_key === registration.extension.addon_key) {\n            delete this._pendingEvents[index];\n          }\n        });\n\n        delete this._registeredExtensions[registration.extension_id];\n      }, this);\n    }\n  }\n\n}\n\nmodule.exports = XDMRPC;\n"]}